<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>5.7多实例</title>
    <url>/blog/2021/10/31/5-7%E5%A4%9A%E5%AE%9E%E4%BE%8B/</url>
    <content><![CDATA[<h1 id="多实例安装（基于5-7版本-）"><a href="#多实例安装（基于5-7版本-）" class="headerlink" title="多实例安装（基于5.7版本 ）"></a>多实例安装（基于5.7版本 ）</h1><p>获取软件包:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]#  wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解压并做超链接</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mv mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz  &#x2F;app&#x2F;soft&#x2F;
[root@localhost soft]# tar xf mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz
[root@localhost soft]# ln -s mysql-5.7.36-linux-glibc2.12-x86_64 mysql5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>创建数据存储目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost soft]#  mkdir -p &#x2F;data&#x2F;mysql5_data&#x2F;&#123;data,logs&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建 主配置 文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5_data]# vim my.cnf 
[mysqld]
user &#x3D; mysql
port &#x3D; 3308
socket&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;mysql.sock
basedir&#x3D;&#x2F;app&#x2F;soft&#x2F;mysql5&#x2F;
datadir&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;data
log-error&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;logs&#x2F;error.log
[mysql]
prompt &#x3D; &quot;\\u@\\d*\\h \\R:\\m:\\s &gt;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建用户，修改存放数据目录的权限及安装目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5_data]# useradd mysql -s &#x2F;sbin&#x2F;nologin
[root@localhost mysql5_data]# chown mysql:mysql -R &#x2F;my_data&#x2F;
[root@localhost mysql5_data]# chown mysql:mysql -R mysql5&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>初始化：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysqld --user&#x3D;mysql --basedir&#x3D;&#x2F;app&#x2F;soft&#x2F;mysql5 --datadir&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;data --initialize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><font color="red">注意：</font></p>
<blockquote>
<p>如果初始化成功之后再进行下一步；如果不确定执行是否成功 ；可以使用echo $? </p>
<p>0  为执行成功；</p>
<p>非0 为执行不成功；需要重新初始化执行；</p>
</blockquote>
<p>启动数据库：（两种方式）</p>
<ul>
<li><p>使用mysqld 启动</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# &#x2F;bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;my.cnf --user&#x3D;mysql &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>使用mysqld_safe</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysqld_safe --defaults-file&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;my.cnf --user&#x3D;mysql &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解释：</p>
<blockquote>
<p>mysqld  开启 之后只有一个进程；</p>
<p>mysqld_safe：开启之后有两个进程；</p>
<p>他们之间的关系是mysqld_safe是mysqld 守护进程。 </p>
</blockquote>
</li>
</ul>
<p>连接数据库 ：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysql -S &#x2F;data&#x2F;mysql5_data&#x2F;mysql.sock -P 3308 -u root -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p> 密码会在初始化的时候随机生成；第一次登录需要，登录之后在修改密码</p>
</blockquote>
<h2 id="安装第二个-实例"><a href="#安装第二个-实例" class="headerlink" title="安装第二个 实例"></a>安装第二个 实例</h2><p>创建 数据存储目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost data]# mkdir -p my_data2&#x2F;&#123;data,logs&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">root@localhost data]#  chown -R mysql:mysql my_data2&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>创建my.cnf或者修改原有的配置（添加一下修改一下标签就好）</p>
<p>注意： 我的my.cnf是独立使用的</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5_data2]# vim my.cnf 
[mysqld]
user &#x3D; mysql
port &#x3D; 3307
socket&#x3D;&#x2F;data&#x2F;mysql5_data2&#x2F;mysql.sock
basedir&#x3D;&#x2F;app&#x2F;soft&#x2F;mysql5&#x2F;
datadir&#x3D;&#x2F;data&#x2F;mysql5_data2&#x2F;data
log-error&#x3D;&#x2F;data&#x2F;mysql5_data2&#x2F;logs&#x2F;error.log
[mysql]
prompt &#x3D; &quot;\\u@\\d*\\h \\R:\\m:\\s &gt;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>初始化 ：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysqld --user&#x3D;mysql --basedir&#x3D;&#x2F;app&#x2F;soft&#x2F;mysql5 --datadir&#x3D;&#x2F;data&#x2F;mysql5_data2&#x2F;data --initialize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动第二个实例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysqld bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;data&#x2F;mysql5_data2&#x2F;my.cnf --user&#x3D;mysql &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>测试：连接3307端口实例</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost mysql5]# bin&#x2F;mysql -S &#x2F;data&#x2F;mysql5_data2&#x2F;mysql.sock -P3307 -uroot -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>好了现在多实例就创建完成了</p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible</title>
    <url>/blog/2021/07/18/Ansible/</url>
    <content><![CDATA[<p><img src="https://www.openvirtualization.pro/wp-content/uploads/2019/01/GettingStartedWithAnsible-1200x780.png" class="lazyload placeholder" data-srcset="https://www.openvirtualization.pro/wp-content/uploads/2019/01/GettingStartedWithAnsible-1200x780.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<span id="more"></span>
<h4 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h4><h6 id="简介"><a href="#简介" class="headerlink" title="*简介"></a>*<em>简介</em></h6><p>Ansible 安装使用非常简单，而且基于上千个插件和模块，实现各种软件、平台、版本的管理，支持虚拟容器多层级的部署。</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASsAAACoCAMAAACPKThEAAAAzFBMVEX////MAAAAAADJAADNAAD09PR6enr6+vqioqKnp6fPz8/f39/QAABGRkadnZ3Dw8M7OzvW1tYUFBS9vb2Wlpbm5ubt7e1NTU1nZ2dWVla1tbU9PT321dX+9/f87+/lior64+OBgYFycnIvLy8jIyONjY2AgIDnk5PSJiZra2snJyf0zMztrKzwuLjWQUEVFRXcXFzifHxfX1/QHh7YTk7gbG3pnZ3ywsL43d3wtLTZNjbYSkrrpqbkhYXVOzvhd3fbWVnfZ2fWJSTVFhbtTysUAAAQWklEQVR4nO2dCXuiOhSGEUQUF9ytuJS6tLU6XWxtO22nm///P00SlpwEFwhWxfo997lVQQZek5OzJCBJRx111FFHHXXUUUcdddRRRx111FFHxVHd9nhycXo3+7r9/Lz9mv27ePwztjq7Pqt9U/f577/Py2Qyl2CVTCbn718XT0ditjrji9v7ZGKVlNzLbPK86xPdtazJV2I1J0+5l7vx721e3ckn3+lWK3n5Md71Se9CnfEsHChH3xfWrk99y+pM3gN2Pb9ys9/UuLoXc1FQtl7/7PoStqTIpJCS17+BVucxOilC6/Xge+Kfl42Qwsp9Wbu+mp/U862wRV9I6+JwHa5HIS9hld4PtCNaDxttVLZyp9qur+sH9LbxRmXr/eACxc7HDzQqW7m/u764zep5c8OfX8m7Q+qHT5vxqZbqobvrK9yYNj/+8fo+FKN1+mOmimp+GM7Dx8+TQso97fo6N6DZVlAdxHD4tSVUCFbcUw/balUEVrxb1nZslQcrzjbrdKuoEKz2rq9YWJMtOAus5taur1lQT1tHlUi8xDOjZf1wYLNYX7u+bBF1IoTLCvlPTBe7vnABiQ+ByvVbu/33QZBWLn7Rzl9hY6Xc2Uc4FYR1H7ekgyWcWlA+3WN8CsKKm8l6EEWVULw+NBY9xGSXVx5ab8KoEu/0KK+Ch8hZO7vw8BLvgQnljR5mIjoYxqkX3gqjYixzR9hDi09gOBZ32N1B0NadaMOKjfuuRSnaMInzZ2HocfFIJxFQvbKHEnUbErl4NKxOhKqNwuU2n4RDnbvFJ7dnehRHlbjkmkPnUvRIsfAbxAcv1Kx8ZubioBtWlGaVtPijWcKscjEIC6M0qwU+5EwY1un2rz2k/kRJhi5IpwgHhYm5bygspTNElaz93sy4SuuSVLdfmrrKfquCNpfQXw3vV5e8r5IPpXo6Q49Sl2oZM/hEFNEYDuvaO0rX8l5eCx/OF0IPZVcNQqvlvZeHkqS7rwdD5nLz6KMCpoK36fZnWfx6il/pMlBJq/aG6aCo2hGaFQgF32beS+GgMPHCn1wVXFYNvW8wrEr0XbEOvoX3SnOsht4xWFa1Sr6aCdqw7sRRQWv8Ovded4UNYJKvgBFW5TK5rLNVrOTRGlZ9slfax0oamgUzIKpOlGZFR/k2bGP/NuY2VAkjTU3hpuNQMNU6luqw0rNmEf/NrmTlAMqjl6qu6xX8poJeaJJm6AFRRStz0WaAYmZqu56FD8hb96rTnvClXjkUKioBJTmsVMcWZVhWVbRXlrI6l+WbFmlHRDW3Q4bSlzgp5cE7SvcepkelT+FjcqkZp11pZ06bcPtgj7KqOx+fsaw8EVbqlSy30nbPFWa1oVAQm3Plw3v7R7gTfrCnh1nd9PsDfGmF5axG3kdLWOE+18OA+po4qyhdEISCxO+g1l08KJyzQxIYBxsaoDBiWZ2sYzXFfZf4EoY4qwjTYkAo2LY/ePQ+EA4KuZGQskppLoWhaZo6y6pFe5e717RQLQxdVgTNSaroIRVi9S3OCoSCTjaUukfWhlJ+mNXUyHstqeEZa4+VOx6Cgd8dB1WXVYY2s3JdlNVzhJIEDQWxZScfUesuHBReM+dn23bD60uEQknHyjqMKkb1hrtyn88AO6UpyipCQlShQ5brqCvUdx8Ld0LGa3B8Btywmi4FR1PWFwXDoI8V8R2a0+a0LztxjgirCBMeQQPwAkDQLd9FWTFeg8OKNCyDZXXCsDqBYwLPCtutFt5AXNCsICvh8Qq66W2vDQHr/ibasBiDha8yhf5iq9yXmNh5CqKVPBul4L1A7KwN3HZHPqhKTksLx6or7AclFBoKgjrXJT30veCBH+AJZisGScegv0YFNR3d8IQ8cJW80EswbsZCe1UwCA1vVsmfSt3bortbwq0JEveuQCgIqQAjJlopvFx0onugCNlj6gfBFAwYHJ9FZ2NZOwARQOLp3k96ECa1B6y7aA4x0sw17ccW2wlnMEEo2GZ4A2deNCj0zy+q9XrAK5fqvV6FvsuMvKSoOeqXy1dTL22cGdnePvq+rVTVc2SNUY8zc6VRj2qENlbSYMjQhIfBe/rzcXaJBomi00//+VgV2EEry7ztufFwlg6SVfuTFPHqWT+slfWOCTJehJ4MVZP0wqhKfxPhiUQKrbjw4x2w7oJB4UzihV1RkJ7CrGgaNCUXCZk6cjQbmYpZyHueaUouu6waoxOkJtp0VV/Oqkn2wprWJdNs6DQTLxzhAKvEJ9eVW4pR7OC+pDtikyfZK8DKyRcAVkOPp37VV3lWTgPRUm6QvZBVCb5XzyrntJs+CaKCVUG/yaMcv4Qa1pxnVZWvDNjrCKuiawVcVi254e5Qr7mbPFae5emTXPQSVmw2WSuBWtpfUVZ0qGr7cID+KVYp5CfMaEU5pZWJu+2xOqc5GIeVeiOf85AXsUrJN2pAVoxEI2fQSz78TQekAIWCQoUr1ZdwhzuxAzqXlXHiXarDCgUy059kdSGGCk4QXWC/gT8hFhRa7FkO5YGGo17PmGBWKPhtMKykJrBhK1gV7YRFaFaCC+Dm8If/k/Tx+PQ2dkViKH46yQBHz2qZJj6z2FRXXVPusqpQX2EBK3fwH7ov19t2VmJlVHaCqGS9+GDRWZEiQWGSvRuBbv/cPVLzoqy0vJ0+9liRnER5CAEAVqMq1rDoDZYLWZ2lkQoLW5dgyZkrDnd4m6VQb7Id/fjnchn/AZ2QsMIAegwryRzY+RmvcQFW1E2VVrCy5RsjxFm9+o7Dh+BgFrfIeiYmIFQH9rmjTuimPm1WuB0ZDCtJM7EfKg9c4wRY5adNpEZZlvul5az6LaR+VVogIVb8BFGs8T0bFNKQTiQoZNqVZ3FRJ9QYVmqRRDeAFd42HDjpQZaV4dJ046Ot2Ct+gihR95VhQvN1nfApP7bs1SP5UInYLYNhhS+uyrNCCKtOVnShbcdfOl/KasU4+E8AlX+CqMMdwlLo5YYPCplxUEO+QbqAVfXKpS4rHBtnfawI1YG6jBUKLsn+W/GvrCUHg44tGCqt0P8Aw6rCBP8ay6o+QM6SnxW2ZKWlrJAzWhdgJbC2C4aCd2wTe76kTQhY99BBIeO3I/+8VbTVd6/YY4VJVs78rCrOVW+SlUA8CFIu3Xtlxtiu7i0t6FDrHrpSCOPBOo77NCI8Eo44VtJUbvX8rMxV7aop1gcF8gxgreBESSjXFnNAGgiA6mHYoBDmGUw4NqWcAjtgVSvLZTcn0/ASKM0V9kp3RsmwrMLnr2AoiBeyKtxdrLzCELDuYYNCWMhpOhkU92JMjhWZqUBYVbBfRaCpXhLCx0pTKwOHflhWAnlRaktcl/yROeTzu00GTMYKGxTSZCEuDwPHUL2y417ICteYCas6njY06A2HvRtn/hHDqp/HapU9fwKxauU9qTarovdBi3dIQzs/MBR0nQTlgzFaHac2BALsBXmbVQL59jT746dsP5JhlfXmn5l9d7hMOTm63qJ8u+OkVZkBti7x+fYUxyp8fon2LLqIR3m1mIPaEQ+s4Yf7N0A3rxQy8MjZQgGjU9MFQNDwphFrxrBZbE3pRqNgz8aup12Z3rZSIQ2Ed6vBTwp8fif0eA5CQZBnV+5Zo2VHPCAhGG6J/p6u5g3pjCrg1l7s9b8xh7VwxAMSzX/D/CT7WncOOZ8BhIJcv1Lu2CgRGTMwGSvU6qj7PV2fGm79Gqg6+JJ4Cndz1QlyJyzvXZibp/hSPr6quxZoMhDZSQ89h325wq0Gsbzv+f0A3mi1L8FkrDDTR/mFcSazfETCI19h/YVpU+xe6H6fXlxhbssAqqSLlyexExG6D9/0TfBBJMmb9qmTK/ZkyBlprep43p9Uyw/X7hlYYSYVAWO9eGTjEvHSP3rZIYJCruJVkxs2myyZu1iT1IxczWJ6JUPHjSZbUiuGKpUq5J2UNQy0o6bLzSzqf2RHSTeIq16q1e2viCnMgjgQCi7xmJRb9kLBu8CzTPgKfVrWi6S61Rqg/+X7ZCII8uZxtV3GIWBDxhMZcGFiqjlL3wq295lHoFHrqjdt11IdXCGXPs+tywyuEMvCYSi4rDyjfC+7rWPgoJCfJVOU0fXjJtW6slmVUvIoraMPp2YKl0+b8kjHsxSMJvbmjaFRKcq1elVupU2b1VQ+N5uILgqRzo0TeWE2PZC+ArNK0lbSWbHXkrszBV5TyM1Uy8pnqJEMKSsNGWzUJ7XyjYQxZBGrulQvFyVnNxVz0iXVtldoXCjhV+rVlaoOkKGvO6VUEQW+mRoIhlcuPFWWLPAOGBTykxmGsq5pxSvIith20mKkDGpKTVlDKBo2VrtIiFjVScUes6oQczeSs9oAYdJu8r5TC6pu4FQD6F0rYxblc+GtA/yTRBaKW5ev9eUbvCxV97MaQVYDh5UpTyuow/0Mq8BL/cBU6jWxsPKy0GgFmz7KFdR0udHr9U6wac7LGJ3LSpMHhECJZXWOExEmYUX7YA9/cYD6YFRWAfPIsCq4tjslF90SOlClkO+CPbuY15JV1LuGpaFM7FVKL6G3PX2IjQ9gdY5GzbOSOcD2qlzUDbv1IbuunyBbFp1VwE4IFtcGMdMLCmOBkmXc/EfVKQ5WZTSmXZGaMjLPNzg/quLcXrGGfQacis/brFS8vKSIu+wJXoVSwz2xVrT9CRXPrNHA3KTwCrQkB1YFg9xSgPe0sAIEhUluFFSdeE7Fq7o006yXyGrADF5CIekZsvKhRtZV4O1k/YSRyar43hZ4b+SS4o2akSHJ4WzN2VNYgSbfwZpdoGyU4n9gUIBK4Tf/nX1TgKnVsCoYMMup+AK7AEHhI/+VfVOAiiqoCoaYUsUbrbUltv2/UVGApfQgSAtxUw+u1LreunOL6PdRa6dCit5BlDdaa1ysfc0eQ611G+AMg1ArkpQ5Y7TWLP+55U9sH7WmYcFQMPSkRmC01hRVc7F4atW6hgViltCTZUGpdc1UrJjc5nd17euT7ihwuybPaK2JpuJgrbBWj1Cfp55E1t0r8wur02mvu8NIHO4CSbT6N1eoBFjhJ1HMlXWPo5jvvW/lSfweextSjO523/7xhzOu1vX6U9wfbfvhVKxi9qiqn3yW7FrF5YbkjnbZC/3LVvZcgqsJN6B4eOyMIjxzIpIWpuf3XOL3UI2mGKRi/BrvxGTFzljZetvB8wdj+7DG7XtZMfOsoLb5FF6sZJwfWyx+e14hVDEKA/3qRLn1fWhUe1/kWq2O6B0cfx8qvHZ5W6hiFgUu0pa6YfxbFVZnG6NhzJ9FTxXlIRQBUe3pEiUBvf1wuPMSv9TCcj39aCC9eE5pbGWJP5h3nXIHMAByOv2hfjg/HFNFNY7w1IClSn4dVv9z1b3beJJmfiiugl/jzZZ3krPDbFSOHjc3ICavI90XOgayPjbUEeexTsAElDXbwIh4/7ini743rXZUWvPHgzZUrKxTcbuVvP4NvQ+qO3kXMly52aFb9IV6Pr0MiSv3MPlFnY9T+/QlqOlK5j7frF2f745l/Z1dJpIrJzUmE7nr06ff26IYWU+nt5e5RS0smZu/z97Gv8RBCKzu89Pk9GP28PI9R7p8v53dPU7G1hHTUUcF0X8hPGkCTEtL3gAAAABJRU5ErkJggg==" alt="What is Dell Technologies PowerStore – Part 16, Automation With Ansible |  Itzikr&#39;s Blog"></p>
<p><strong>Ansible自动化工具原理</strong></p>
<p>Ansible 是一款极为灵活的开源工具套件，能够大大简化UNIX管理元的自动化配置管理与流程控制方式，他利用推送方式对客户系统加以配置，这样所有工作都可在服务器端完成。命令行机制同样非常强大，允许大家利用商业许可WEB UI 实现授权管理与配置，通过ansible进行管理的服务。</p>
<p>Ansible与2015年被Red Hat公司以1.5亿美元收购；</p>
<p><strong>Ansible 自动运维管理工具优点：</strong></p>
<ul>
<li>轻量级，更新时只需要在操作机上进行一次更新即可；</li>
</ul>
<ul>
<li><p>采用SSH协议；</p>
</li>
<li><p>不需要客户端安装agent；</p>
</li>
<li><p>批量任务执行可以写成脚本，而且不用分发到远程客户端；</p>
</li>
<li><p>使用python编写，维护更简单；</p>
</li>
<li><p>支持sudo普通用户命令；</p>
</li>
<li><p>去中心化管理。</p>
</li>
</ul>
<p>Ansible 自动化管理工具原理拓补图：</p>
<p><img src="https://www.whizlabs.com/blog/wp-content/uploads/2019/09/ansible_architecture.png" class="lazyload placeholder" data-srcset="https://www.whizlabs.com/blog/wp-content/uploads/2019/09/ansible_architecture.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Ansible Tutorial - A Quick Introduction - Whizlabs Blog"></p>
]]></content>
      <categories>
        <category>自动化</category>
      </categories>
      <tags>
        <tag>自动化</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache</title>
    <url>/blog/2021/07/16/Apache/</url>
    <content><![CDATA[<p><img src="https://www.apache.org/img/asf-estd-1999-logo.jpg" class="lazyload placeholder" data-srcset="https://www.apache.org/img/asf-estd-1999-logo.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<span id="more"></span>
<h1 id="Apache-web服务器"><a href="#Apache-web服务器" class="headerlink" title="Apache web服务器"></a>Apache web服务器</h1><h2 id="什么是Web服务器"><a href="#什么是Web服务器" class="headerlink" title="什么是Web服务器"></a>什么是Web服务器</h2><p>&#160; &#160; &#160;万维网(world wide web, WWW)服务器，也成为Web服务器，主要功能是提供网上浏览服务，<br>WWW是internet的多媒体信息查询工具，是Inernet上飞速发展的服务，也是目应用最广泛的服务，正是因为有了WWW软件，才使得近年来internet迅速发展。<br>&#160; &#160; &#160;目前主流的Web服务器软件包括Apache | Nginx | Lighttpd | IIS | Resin | Tomcat |WebLogic|Jetty等。<br>首先先介绍Apache web服务器发展历史、工作模式、虚拟主机、配置文件等内容；</p>
<h2 id="Apache-web-服务器"><a href="#Apache-web-服务器" class="headerlink" title="Apache web 服务器"></a>Apache web 服务器</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>&#160; &#160; &#160;Apache HTTP server是Apache软件基金会的一个开源的网站服务器，可以运行在几乎所有广泛使用的计算机平台上，由于其跨平台和安全性被广泛使用，是目前最流行的Web服务器软件之一<br>。<br>&#160; &#160; &#160;Apache服务器是一个多模块化的服务器，经过多次修改，成为目前世界使用排名第一的Web服务器软件。Apache取自”a patchy server”的读音，即充满补丁的服务器，因为Apache基于GPL发布，大量开发者不断为Apache贡献新的代码、功能、新的特性、修改原来的缺陷。<br>Apache服务器的特点是使用简单、速度快、性能稳定，可以作为负载均衡及代理服务器来使用。</p>
<h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><p>&#160; &#160; &#160; &#160;Apache就向汽车一样都有发动机引擎，不同的引擎，对车子运行效率也不一样，同样Apache也是有类似工作引擎或者处理请求的模块，称之为多路处理模块（multi-proceessing modules,MPM）Apache web服务器有三种处理模块：Profork MPM | Worker MPM | Event MPM 工作模式；</p>
<ul>
<li>Event MPM 工作模式：<br>&#160; &#160; &#160;不支持HTTPS方式，所以Event MPM很少使用；</li>
<li>Profork MPM工作模式：<br>&#160; &#160; &#160; 控制进程master在最初建立“StartServers”个进程后，为了满足MinSpareServers设置的最小空闲进程，所以需创建一个空闲进程，等待一秒钟，继续创建两个，再等待一秒钟，继续创建四个 ，依次按照递增指数级创建进程数，最多每秒 同时创建32个空闲进程，直到满足至少有MinSpareServers设置的值为止。<br>&#160; &#160; &#160; Apache的预派生模式(Prefork),基于预派生模式不必在请求到来时再产生新的进程，从而减小了系统开销以增加性能，不过由于Prefrok MPM引擎是基于多进程方式提供对外服务，每个进程占内存也相对较高。</li>
<li>Worker MPM工作模式:<br>&#160; &#160; &#160;控制进程master在最初建立“StartServers”个进程，每个进程会创建ThreadsPerChild设置的线程数，多个线程共享该进程内存空间，同时每个进程独立地处理用户的HTTP请求。为了不在请求到来时再生成线程，Worker MPM也可以设置最大最小空闲线程。</li>
</ul>
<h4 id="Profork-MPM与Worker-MPM引擎区别如下："><a href="#Profork-MPM与Worker-MPM引擎区别如下：" class="headerlink" title="Profork MPM与Worker MPM引擎区别如下："></a>Profork MPM与Worker MPM引擎区别如下：</h4><ul>
<li>Profork MPM 模式：使用多个进程，每个进程只有一个线程，每个进程在某个确定的时间只能维持一个连接，优点是稳定，当内存开销较高；</li>
<li>Worker MPM模式：使用多个进程，每个进程包含多个进程，每个线程在某个确定的时间只能维持一个连接，内存占有量比较小，适合大并发、高流量的Web服务器。Worker MPM缺点是一个线程奔溃，整个进程就会 连同其任何线程一起挂掉。</li>
</ul>
<h2 id="Apache-Web服务器搭建"><a href="#Apache-Web服务器搭建" class="headerlink" title="Apache Web服务器搭建"></a>Apache Web服务器搭建</h2><h3 id="Apache官网获取安装"><a href="#Apache官网获取安装" class="headerlink" title="Apache官网获取安装"></a>Apache官网获取安装</h3><p>下载<a href="http://httpd.apache.org/">适合您</a>的版本</p>
<h4 id="搭建Apache-web服务器"><a href="#搭建Apache-web服务器" class="headerlink" title="搭建Apache web服务器"></a>搭建Apache web服务器</h4><h5 id="一、部署web站点"><a href="#一、部署web站点" class="headerlink" title="一、部署web站点"></a>一、部署web站点</h5><p>(1)安装依赖</p>
<pre class="line-numbers language-none"><code class="language-none"># yum -y install wget make gcc gcc-c++ pcre openssl openssl-devel zlib unzip  
# yum -y install cmake ncurses-devel libjpeg libjpeg-devel libpng libpng-devel libxml2
# yum -y install libxml2-devel curl-devel libtool libtool-ltdl libtool-ltdl-devel libevent libevent-devel
# yum -y install zlib-static zlib-devel autoconf pcre-devel gd perl  expat-devel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>创建存放文件夹</p>
<pre class="line-numbers language-none"><code class="language-none"># mkdir -p &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;&#123;apr,apr-util,http&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>(2)获取软件包</p>
<pre class="line-numbers language-none"><code class="language-none"># wget  https:&#x2F;&#x2F;mirror.bit.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;apr-1.7.0.tar.gz
# wget  https:&#x2F;&#x2F;mirror.bit.edu.cn&#x2F;apache&#x2F;&#x2F;apr&#x2F;apr-util-1.6.1.tar.gz
# wget https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;&#x2F;httpd&#x2F;httpd-2.4.46.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>(3)安装apr</p>
<pre class="line-numbers language-none"><code class="language-none"># cd &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr
# tar xf apr-1.7.0.tar.gz &amp;&amp; cd apr-1.7.0
# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr
# make
# make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(4)安装apr-util</p>
<pre class="line-numbers language-none"><code class="language-none"># cd &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr-util
# tar xf apr-util-* &amp;&amp; cd apr-util-*
# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr&#x2F;apr-util  --with-apr&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr &amp;&amp; make  &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>(5)安装apache</p>
<pre class="line-numbers language-none"><code class="language-none"># cd &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;http
# tar xf httpd-* &amp;&amp; cd httpd-*
# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;http \
--sysconfdir&#x3D;&#x2F;etc&#x2F;httpd&#x2F; \
--with-include-apr \
--disable-userdir \
--enable-headers \
--with-mpm&#x3D;worker \
--enable-modules&#x3D;most \
--enable-so \
--enable-deflate \
--enable-defate&#x3D;shared \
--enable-expires-shared \
--enable-rewrite&#x3D;shared \
--enable-static-support \
--with-apr&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr&#x2F; \
--with-apr-util&#x3D;&#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apr&#x2F;apr-util \
--with-ssl \
--with-z  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>(6)编译并安装</p>
<pre class="line-numbers language-none"><code class="language-none"># make
# make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>(7)启动服务进程</p>
<pre class="line-numbers language-none"><code class="language-none"># &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;apache&#x2F;bin&#x2F;apachectl start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（8）添加防火墙规则</p>
<pre class="line-numbers language-none"><code class="language-none"># firewall-cmd --permanent --add-port&#x3D;80&#x2F;tcp --zone&#x3D;public
#	firewalld-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（9）启动Apache</p>
<pre class="line-numbers language-none"><code class="language-none"># &#x2F;usr&#x2F;local&#x2F;apache1&#x2F;http&#x2F;bin&#x2F;apachectl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（10）查看端口号是否开启 Apache默认端口是80</p>
<pre class="line-numbers language-none"><code class="language-none"># ss -luntp | grep 80<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（11）测试<br>    你现在应该就可以通过浏览器访问 <a href="http://server-ip/">http://server-ip/</a></p>
<h4 id="Apache虚拟主机应用"><a href="#Apache虚拟主机应用" class="headerlink" title="Apache虚拟主机应用"></a>Apache虚拟主机应用</h4><p>一台web服务器发布单个网站非常浪费资源，所以一台web服务器上会发布多个网站，在一台服务器上发布多个网站，也称之为部署多个虚拟主机，web虚拟主机配置方法有三种：</p>
<ol>
<li>基于单个IP地址多个socket端口；</li>
<li>基于多个IP地址一个端口；</li>
<li>基于单个IP地址一个端口不同域名。</li>
</ol>
<p>启动基于同一端口不同域名的方式在企业中得到广泛应用，以下为基于一个端口不同域名，在一台Apache web服务器上部署多个网站，步骤如下：</p>
<ul>
<li>修改虚拟主机配置文件</li>
</ul>
<h4 id="Apache常用目录解释"><a href="#Apache常用目录解释" class="headerlink" title="Apache常用目录解释"></a>Apache常用目录解释</h4><p>Apache可以基于源码安装、YUM安装，不同方法安装，所属的路径有所不同，以下为Apache常用路径的功能用途：</p>
]]></content>
      <categories>
        <category>web服务</category>
      </categories>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker初始</title>
    <url>/blog/2021/12/04/Docker%E5%88%9D%E5%A7%8B/</url>
    <content><![CDATA[<h1 id="Docker简介"><a href="#Docker简介" class="headerlink" title="Docker简介"></a>Docker简介</h1><p>docker 对外宣称的作用是”Build,Ship and Run Any App,Anywhere“,即通过对应的封装（Packaging)、分发(Distribution)、部署(Deployment)、运行(Runtime)生命周期进行管理，达到应用组件级别的”一次封装，到处运行“。这里的组件，既可以是一个web应用、一个编译环境，也可以是一台数据库平台服务，甚至是一个操作系统或集群。</p>
<p>基于Linux平台上的多项开源技术，docker提供了高效、敏捷和轻量级的容器方案，并支持部署到本地环境和多种主流云平台。可以说docker首次为应用的开发、运行和部署提供了”一站式“的实用解决方案。</p>
<img src="https://www.docker.com/sites/default/files/d8/styles/role_icon/public/2019-07/vertical-logo-monochromatic.png?itok=erja9lKc" class="lazyload placeholder" data-srcset="https://www.docker.com/sites/default/files/d8/styles/role_icon/public/2019-07/vertical-logo-monochromatic.png?itok=erja9lKc" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img" style="zoom:33%;">

<h2 id="Container-发展历史"><a href="#Container-发展历史" class="headerlink" title="Container 发展历史"></a><strong>Container 发展历史</strong></h2><p>LXC(Linux Containers)</p>
<ul>
<li><input disabled type="checkbox"> 1979 年，Unix v7 系统支持 chroot，为应用构建一个独立的虚拟文件系统视图。</li>
<li><input disabled type="checkbox"> 1999 年，FreeBSD 4.0 支持 jail，第一个商用化的 OS 虚拟化技术。</li>
<li><input disabled type="checkbox"> 2004 年，Solaris 10 支持 Solaris Zone，第二个商用化的 OS 虚拟化技术。</li>
<li><input disabled type="checkbox"> 2005 年，OpenVZ 发布，非常重要的 Linux OS 虚拟化技术先行者。</li>
<li><input disabled type="checkbox"> 2004 年 ~ 2007 年，Google 内部大规模使用 Cgroups 等的 OS 虚拟化技术。</li>
<li><input disabled type="checkbox"> 2006 年，Google 开源内部使用的 process container 技术，后续更名为 cgroup。</li>
<li><input disabled type="checkbox"> 2008 年，Cgroups 进入了 Linux 内核主线。</li>
<li><input disabled type="checkbox"> 2008 年，LXC（Linux Container）项目具备了 Linux 容器的雏型。</li>
<li><input disabled type="checkbox"> 2011 年，CloudFoundry 开发 Warden 系统，一个完整的容器管理系统雏型。</li>
<li><input disabled type="checkbox"> 2013 年，Google 通过 Let Me Contain That For You (LMCTFY) 开源内部容器系统。</li>
<li><input disabled type="checkbox"> 2013 年，Docker 项目正式发布，让 Linux 容器技术逐步席卷天下。</li>
<li><input disabled type="checkbox"> 2014 年，Kubernetes 项目正式发布，容器技术开始和编排系统起头并进。</li>
<li><input disabled type="checkbox"> 2015 年，由 Google，Redhat、Microsoft 及一些大型云厂商共同创立了 CNCF，云原生浪潮启动。</li>
<li><input disabled type="checkbox"> 2016 年 - 2017 年，容器生态开始模块化、规范化。CNCF 接受 Containerd、rkt项目，OCI 发布 1.0，CRI/CNI 得到广泛支持。</li>
<li><input disabled type="checkbox"> 2017 年 - 2018 年，容器服务商业化。AWS ECS，Google EKS，Alibaba ACK/ASK/ECI，华为 CCI，Oracle Container Engine for Kubernetes；VMware，Redhat 和 Rancher 开始提供基于 Kubernetes 的商业服务产品。</li>
<li><input disabled type="checkbox"> 2017 年 - 2019 年，容器引擎技术飞速发展，新技术不断涌现。2017 年底 Kata Containers 社区成立，2018 年 5 月 Google 开源 gVisor 代码，2018 年 11 月 AWS 开源 firecracker，阿里云发布安全沙箱 1.0。</li>
<li><input disabled type="checkbox"> 2020 年 - 202x 年，容器引擎技术升级，Kata Containers 开始 2.0 架构，阿里云发布沙箱容器 2.0….</li>
</ul>
<h2 id="docker优点"><a href="#docker优点" class="headerlink" title="docker优点"></a><strong>docker优点</strong></h2><p>Docker 是开发人员和系统管理员使用容器开发，部署和运行应用程序的平台。使用Linux容器部署应用程序称为容器化。<br>容器化越来越受欢迎，因为容器是：<br>    1、灵活：即使是最复杂的应用也可以集装箱化<br>    2、轻量级：容器利用并共享主机内核<br>    3、可互换：您可以即时部署更新和升级<br>    4、便携带：您可以在本地构建，部署到云，并在任何地方运行。<br>    5、可扩展：您可以增加并自动分发容器副本<br>    6、可堆叠：您可以垂直和即时堆叠服务</p>
<h2 id="docker架构"><a href="#docker架构" class="headerlink" title="docker架构"></a><strong>docker架构</strong></h2><p><img src="https://lh3.googleusercontent.com/proxy/VkcBhgL489Gb-86DtTKhEDUuOE0YzTuut7K5jv2Emnkb8tBeiennaQUIdnFwfPLQo7v2u-WEV6Qy06hWstYizYgIFkDgir0dc5K7o0rYeOUWthBllodY5Sag_iW0VNvyp5s" class="lazyload placeholder" data-srcset="https://lh3.googleusercontent.com/proxy/VkcBhgL489Gb-86DtTKhEDUuOE0YzTuut7K5jv2Emnkb8tBeiennaQUIdnFwfPLQo7v2u-WEV6Qy06hWstYizYgIFkDgir0dc5K7o0rYeOUWthBllodY5Sag_iW0VNvyp5s" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="架构">)</p>
<p>Docker 使用客户端-服务器 (C/S) 架构模式，使用远程API来管理和创建Docker容器。Docker 容器通过 Docker 镜像来创建。容器与镜像的关系类似于面向对象编程中的对象与类。<br>Docker采用 C/S架构 Docker daemon 作为服务端接受来自客户的请求，并处理这些请求（创建、运行、分发容器）。 客户端和服务端既可以运行在一个机器上，也可通过 socket 或者RESTful API 来进行通信。<br>Docker daemon 一般在宿主主机后台运行，等待接收来自客户端的消息。 Docker 客户端则为用户提供一系列可执行命令，用户用这些命令实现跟 Docker daemon 交互。</p>
<h2 id="docker-核心概念"><a href="#docker-核心概念" class="headerlink" title="docker 核心概念"></a>docker 核心概念</h2><h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a><strong>核心概念</strong></h3><p>docker大部分的操作围绕着三个概念：镜像、容器和仓库。</p>
<ul>
<li><p>镜像</p>
<p>docker 镜像类似于虚拟机镜像，可以将他理解为一个制度模板。</p>
</li>
<li><p>容器</p>
<p>docker 容器类似于一个轻量级的沙箱，docker利用容器来运行和隔离应用。</p>
</li>
<li><p>仓库</p>
<p>docker 仓库类似于代码仓库，是docker集中存放镜像文件的场所。</p>
<ul>
<li><p>公开仓库（public）</p>
</li>
<li><p>私有仓库（Private）</p>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Container</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Grafana</title>
    <url>/blog/2021/07/21/Grafana/</url>
    <content><![CDATA[<p><font size="6" color="green">Grafana</font></p>
<span id="more"></span>

<h2 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h2><p><font size="4" color="Crimson">官方帮助手册 <a href="https://grafana.com/docs/grafana/latest/installation/rpm/">这儿</a></font></p>
<h3 id="什么是Grafana"><a href="#什么是Grafana" class="headerlink" title="什么是Grafana"></a>什么是Grafana</h3><p>Grafana是开源的可视化和分析软件。它使您可以查询，可视化，警报和浏览指标，无论它们存储在哪里。用简单的英语，它为您提供了将时间序列数据库（TSDB）数据转换为精美的图形和可视化效果的工具。</p>
<h3 id="检索指标和日志"><a href="#检索指标和日志" class="headerlink" title="检索指标和日志"></a>检索指标和日志</h3><p>通过临时查询和动态明细浏览数据。拆分视图并排比较不同的时间范围，查询和数据源</p>
<h3 id="通讯"><a href="#通讯" class="headerlink" title="通讯"></a>通讯</h3><p>如果您正在使用Grafana警报，则可以通过许多不同的警报通知程序发送警报，包括电子邮件、SMS等方式；<br>警报挂钩可让您通过一些代码来创建不同的通知程序，以可视方式定义最重要指标的警报规则。</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>使用来自不同数据源的丰富事件注释图形。将鼠标悬停在事件上可以常看完整的事件元数据和标签。</p>
<h3 id="仪表盘变量"><a href="#仪表盘变量" class="headerlink" title="仪表盘变量"></a>仪表盘变量</h3><p>模板变量允许您创建仪表板，这些仪表板可用于许多不同的用例，值不是用这些模板硬编码的，因此例如，如果您有生产服务器和测试服务器，则可以为这两者使用相同的仪表板。</p>
<h3 id="配置Grafana"><a href="#配置Grafana" class="headerlink" title="配置Grafana"></a>配置Grafana</h3><p>配置涵盖配置文件和环境变量，您可以设置默认端口，日志记录级别，电子邮件IP地址，安全性等；</p>
<h3 id="导入仪表板和插件"><a href="#导入仪表板和插件" class="headerlink" title="导入仪表板和插件"></a>导入仪表板和插件</h3><p>在官方库中里有数百个仪表板和插件，由于社区成员的热情和动力，每周都会增加新成员。</p>
<h2 id="安装Grafana"><a href="#安装Grafana" class="headerlink" title="安装Grafana"></a>安装Grafana</h2><h3 id="要求："><a href="#要求：" class="headerlink" title="要求："></a>要求：</h3><p>Grafana的最低硬件和软件（配置）<br>要运行Grafana,您必须具有受支持的操作系统，满足或大于最低要求的硬件，受支持的数据库和受支持的浏览器。</p>
<h4 id="支持的操作系统"><a href="#支持的操作系统" class="headerlink" title="支持的操作系统"></a>支持的操作系统</h4><p>Grafana安装支持一下操作系统：</p>
<ul>
<li>Debian/Ubuntu</li>
<li>基于RPM的Linux（CentOS,Fedora,OpenSuse,RedHat）</li>
<li>苹果系统</li>
<li>Windows</li>
</ul>
<h4 id="硬件的要求"><a href="#硬件的要求" class="headerlink" title="硬件的要求"></a>硬件的要求</h4><p>Grafana不会使用大量资源，并且字使用内存和CPU时非常轻巧。<br>建议最小内存：255MB 建议最小CPU：1<br>某些功能可以能需要更多的内存或者CPU。功能需要跟多资源，包括</p>
<ul>
<li>服务器端图像渲染</li>
<li>报警</li>
<li>数据源代理</li>
</ul>
<h4 id="支持的数据库"><a href="#支持的数据库" class="headerlink" title="支持的数据库"></a>支持的数据库</h4><p>Grafana需要一个数据库来存储其配置数据，例如用户，数据源和仪表板，确切的要求取决于Grafana安装的大小和使用的功能<br>Grafana支持以下数据库：</p>
<ul>
<li>SQLite</li>
<li>MySQL</li>
<li>PostgreSQL<br>默认情况下，Grafana随SQLite一起安装并使用SQLite，SQLite是存储Grafana安装位置中的嵌入式数据库。<h4 id="支持的浏览器"><a href="#支持的浏览器" class="headerlink" title="支持的浏览器"></a>支持的浏览器</h4></li>
<li>chrome/Chromium</li>
<li>Firefox</li>
<li>Safari</li>
<li>Microsofr Edge</li>
<li>Internet Explorer 11 is only fully supported in Grafana versions prior v6.0.</li>
</ul>
<h2 id="基于RPM的Linux（CentOS-Fedora-OpenSuse-RedHat）安装"><a href="#基于RPM的Linux（CentOS-Fedora-OpenSuse-RedHat）安装" class="headerlink" title="基于RPM的Linux（CentOS,Fedora,OpenSuse,RedHat）安装"></a>基于RPM的Linux（CentOS,Fedora,OpenSuse,RedHat）安装</h2><h3 id="现在并安装"><a href="#现在并安装" class="headerlink" title="现在并安装"></a>现在并安装</h3><p>您可以使用YUM仓库中安装Grafana，可以手动使用YUM，手动使用RPM或者下载二进制.tar.gz文件。</p>
<h3 id="使用YUM手动安装"><a href="#使用YUM手动安装" class="headerlink" title="使用YUM手动安装"></a><font size="4">使用YUM手动安装</font></h3><p>如果使用YUM手动安装，则需要为每个新版本手动更新Grafana。要为您的Grafana安装启用自动更新，请按照以下说明通过我们的YUM存储库进行安装。<br></p>
<h3 id="点击这儿官网下载适合您的平台"><a href="#点击这儿官网下载适合您的平台" class="headerlink" title="点击这儿官网下载适合您的平台"></a><font size="4" color="Crimson">点击<a href="https://grafana.com/grafana/download">这儿官网</a>下载适合您的平台</font></h3><p>下载软件包并安装</p>
<pre class="line-numbers language-none"><code class="language-none"># wget https:&#x2F;&#x2F;dl.grafana.com&#x2F;oss&#x2F;release&#x2F;grafana-7.3.6-1.x86_64.rpm
# sudo yum install grafana-7.3.6-1.x86_64.rpm -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>启动服务并开机自启</p>
<pre class="line-numbers language-none"><code class="language-none"># systemctl enable grafana-server  --now<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看服务服务是否正常运行，端口号默认3000</p>
<pre class="line-numbers language-none"><code class="language-none"># ss -luntp| grep grafana
# systemctl status grafana-server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>添加防火墙规则</p>
<pre class="line-numbers language-none"><code class="language-none"># firewall-cmd --permanent --add-port&#x3D;3000&#x2F;tcp
# firewall-cmd --reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Grafana应该就可以开始访问了。您还应该能够在http：//server-ip:3000上浏览到有关其自身的状态页面<br><img src="/blog/.io//16080440023584/16086214757835.jpg" class="lazyload placeholder" data-srcset="/blog/.io//16080440023584/16086214757835.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg">默认登录用户名（admin）密码（admin）</p>
<h2 id="选择您的配置选项"><a href="#选择您的配置选项" class="headerlink" title="选择您的配置选项"></a>选择您的配置选项</h2><ul>
<li>Grafana后端在其配置文件（通常在Linux系统上位于/etc/grafana/grafana.ini中)<br>在此配置文件中，您可以更改默认管理员密码，http端口，grafana数据库（sqlite3，mysql，postgres），身份验证选项（google，github，ldap，auth proxy）以及许多其他选项。</li>
<li>启动您的grafana服务器。用您的管理员用户登录（默认为admin / admin）。打开侧面菜单（单击顶部菜单中的Grafana图标），转到数据源，然后添加数据源。</li>
</ul>
<h3 id="更改Grafana密码"><a href="#更改Grafana密码" class="headerlink" title="更改Grafana密码"></a><font color="Crimson">更改Grafana密码</font></h3><ul>
<li>将鼠标悬停在屏幕左下角的用户图标上。</li>
<li>点击更改密码。Grafana将打开“更改密码”选项卡。</li>
<li>输入您的旧密码以授权更改。</li>
<li>输入新密码，然后确认密码。</li>
<li>点击更改密码。</li>
</ul>
]]></content>
      <categories>
        <category>监控系统</category>
      </categories>
      <tags>
        <tag>Grafana</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux发展历史</title>
    <url>/blog/2022/03/22/Linux%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2-0/</url>
    <content><![CDATA[<h3 id="一、Linux发展及历史"><a href="#一、Linux发展及历史" class="headerlink" title="一、Linux发展及历史"></a>一、Linux发展及历史</h3><h4 id="Linux与开源软件"><a href="#Linux与开源软件" class="headerlink" title="Linux与开源软件"></a>Linux与开源软件</h4><p>Linux 是一种自由和开放源代码的类UNIX操作系统，该操作系统由（林纳斯.托瓦兹）在1991年首次发布，再加上用户空间的应用程序，就成为Linux操作系统。Linux只是操作系统内核本身，但通常采用Linux内核 来表示，Linux完整操作系统包括GUI组件和许多其他实用工具。<br>GNU通用公共许可协议（GNU Grneral Public License,GNU GPL或GPL），是一个广泛使用的自由软件许可协议条款，最初由理查德.斯托曼为GNU计划而拟写，GPL给出了计算机程序自由软件的定义，任何基于GPL软件开发衍生的产品在发布时必须采用GPL许可证方式，且必须公开源代码。<br>Linux 是自由软件和开放源代码软件中最著名的例子，只要遵循GNU  GPL，任何人和机构都可以自由地使用Linux的所有底层源代码，也可以自由地修改和再发布，随着Linux操作系统飞速发展，因此Linux也成为开源软件的代名词</p>
<h4 id="Linux在服务领域的发展"><a href="#Linux在服务领域的发展" class="headerlink" title="Linux在服务领域的发展"></a>Linux在服务领域的发展</h4><p>Linux服务器操作系统在整个服务器操作系统市场格局中占据了越来越多的市场份额，已经形成了大规模市场应用的局面，并保持着快速的增长率，尤其在政府、金融、农业、交通、电信等国家关键领域。<br>据权威部门统计，目前Linux在服务器行业领域已经占据99%的市场份额。</p>
<p>![image-20210119230838160](/Users/abbott/Library/Application Support/typora-user-images/image-20210119230838160.png)</p>
<h4 id="Linux在桌面领域的发展"><a href="#Linux在桌面领域的发展" class="headerlink" title="Linux在桌面领域的发展"></a>Linux在桌面领域的发展</h4><p>​     Linux 桌面操作系统的发展趋势非常迅猛，国内如：中标麒麟Linux、红旗Linux、深度Linux等系统厂商都推出的Linux桌面操作系统，目前已经在政府、企业、OEM等领域得到了广泛应用。 SUSE、Ubuntu也相继推出了基于Linux的桌面系统，特别是Ubuntu Linux，已经积累了大量社区用户，但是，，从系统的整体功能性能来看，Linux桌面系统与Windows系列相比还有一定的差距，主要表现系统易用性、系统管理、软硬件兼容性、软件的丰富程度等方面，</p>
<h4 id="Linux在云计算-大数据的发展"><a href="#Linux在云计算-大数据的发展" class="headerlink" title="Linux在云计算/大数据的发展"></a>Linux在云计算/大数据的发展</h4><p>互联网产业的迅速发展，促使云计算、大数据产业的形成并快速发展，云计算、大数据作为一个基于开源软件的平台，Linux占据了核心优势。目前Linux已开始取代UNIX成为最受青睐的云计算、大数据平台操作系统</p>
<h4 id="Linux在移动嵌入式领域的发展"><a href="#Linux在移动嵌入式领域的发展" class="headerlink" title="Linux在移动嵌入式领域的发展"></a>Linux在移动嵌入式领域的发展</h4><p>Linux的成本、强大定制功能以及良好的可移植性，使得Linux在嵌入式系统方面得到广泛应用，目前Linux已广泛应用于手机、平板电脑、路由器、电视和电子游戏机等领域；</p>
<p>此外，思科公司在网络防火墙和路由器中也使用了定制的Linux，阿里云也开发了一套基于Linux的操作系统能够“YunOS”,可用于智能手机、平板电脑和网络电视，常见的数字视频、录像机、舞台灯光控制系统等都在逐步采用定制版本的Linux来实现，而这一切均归于Linux与开源的力量。</p>
<h4 id="选择适合自己的Linux发行版"><a href="#选择适合自己的Linux发行版" class="headerlink" title="选择适合自己的Linux发行版"></a>选择适合自己的Linux发行版</h4><p>Linux的发行版本太多了，以至于谁也不可能给出一个准确的数字，但是有一点可以肯定，Linux正在变得越来越流行。面对这么多的Linux发行版，打算从其他系统转到Linux系统来的初学者可能会感到困惑，即便是忠实的Linux用户也没有时间和精力去挨个尝试。因此，初学者在学习Linux之前，需要有一个明确的方向，选择一个适合自己的Linux系统至关重要。下面介绍Linux发行版</p>
<h5 id="常见的Linux发行版"><a href="#常见的Linux发行版" class="headerlink" title="==常见的Linux发行版=="></a>==常见的Linux发行版==</h5><p><strong>1、Redhat Linux</strong></p>
<p>目前Red Hat分为两个系统：由Red Hat公司提供收费技术支持和更新的Red Hat Enterprise Linux 版。以及由社区开发的免费的Fedora Core.  rhel</p>
<p><strong>2、Fedora Core</strong>    称之为 pc </p>
<p>Fedora Core（FC）被Redhat公司定位为新技术的测试平台，许多新技术都会在FC中检验。如果这些新技术稳定，Redhat公司会考虑加入到Redhat Enterprise Linux中。</p>
<p>3、Red Hat Enterprise Linux(RHEL,Redhat的企业版Linux)Redhat现在主要做服务器版的Linux开发，在版本上注重性能和稳定性，以及对硬件的支持，由于企业版操作系统的开发周期较长，注重性能、稳定性和服务端软件支持，因此版本更新相对较缓慢。</p>
<p><strong>4、CentOS</strong>  </p>
<p>CentOS全名为“社区企业操作系统”（community Enterprise Operating System）它由来自于RHEL依照开放源代码规定发布的源代码编译而成，由于RHEL是商业产品，因此必须将Redhat的所有logo改成自己的CentOS标识，这就产生了CentOS操作系统。两者的不同在于CentOS并不包含封闭源代码软件。因此CentOS不但可以自由使用，而且能享受CentOS提供的长期免费升级和更新服务。</p>
<p><strong>5、SUSE Linux</strong></p>
<p>SUSE 是德国最著名的Linux发行版，也享有很高的声誉，不过命运相当坎坷。2003年11月4日，Novell公司对外宣布收购SUSE。2004年1月，该收购顺利完成，Novell同时将SUSE Linux改为openSUSE社区项目。2010年Attachmate公司收购了Novell公司，在被收购后SUSE Linux发展受阻，而就在3年后，SUSE官方宣布并开源为SUSE的发展之本，仍将持续贡献开源，SUSE仍将全力支持openSUSE。</p>
<p><strong>6、Ubuntu Linux</strong></p>
<p>Ubuntu 是一个以桌面应用为主的Linux操作系统，基于Debian GNU/linux，Ubuntu旨在为一般用户提供一个主要自由软件构建而成的最新的同时又相当稳定的操作系统。Ubuntu具有庞大的社区力量，用户可以方便地从社区获得帮助。</p>
<h4 id="用第三方软件技术帮助学习Linux"><a href="#用第三方软件技术帮助学习Linux" class="headerlink" title="用第三方软件技术帮助学习Linux"></a>用第三方软件技术帮助学习Linux</h4><h5 id="虚拟机技术"><a href="#虚拟机技术" class="headerlink" title="虚拟机技术"></a>虚拟机技术</h5><p>虚拟机（Virtual Machine）指通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离中的完整计算机系统。</p>
<p>虚拟机会生成现有操作系统的全新的独立虚拟镜像，它与真实系统具有完全一样的功能，进入虚拟机后，所有操作豆子啊这个全新的独立虚拟系统里面进行，可以独立安装、运行软件，保存数据，拥有自己的独立桌面，还不会对真实的系统产生任何影响，而且能够在现有系统与虚拟机之间灵活切换。</p>
<h5 id="使用虚拟技术的好处"><a href="#使用虚拟技术的好处" class="headerlink" title="使用虚拟技术的好处"></a>使用虚拟技术的好处</h5><p>使用虚拟技术的好处有以下3个：</p>
<ul>
<li><p>节省成本</p>
<p>​    如果要在一台计算机安装Linux和Windows系统，而不用虚拟机，有两个办法，一是安装多个硬盘，每个硬盘安装一个操作系统；这个方法缺点是费用比较昂贵。而是一个硬盘上安装双系统，这个方法是不够安全，因为系统盘的MBR是操作系统的必争之地，Windows更是霸道，每次重新安装系统都要重写系统的MBR，这样，几个操作系统可能会同时崩溃，而使用虚拟机软件即省钱又安全，因此对于新手来说，利用虚拟机学习Linux简直再好不过了。</p>
</li>
<li><p>安全便捷</p>
<p>​    在虚拟机上安装Linux系统，不同担心会格式化掉自己的硬盘，甚至可以随意对虚拟机系统进行任何设置和更改操作，可以格式化虚拟机系统的任何操作都是对软件的操作。</p>
</li>
<li><p>简单高效</p>
<p>​    利用虚拟机模拟出来的Linux系统和真实的Linux系统是一模一样，现在各个公司专门的Linux服务器是不会让新手随意操作的，而共测试的Linux服务器一般又很紧缺，如果在自己的电脑上安装虚拟Linux系统，就可以随意地学习测试，而不受任何环境影响。</p>
</li>
</ul>
<h4 id="虚拟软件的运行环境和硬件需求"><a href="#虚拟软件的运行环境和硬件需求" class="headerlink" title="虚拟软件的运行环境和硬件需求"></a>虚拟软件的运行环境和硬件需求</h4><p><strong>1、运行环境</strong></p>
<p>​    流行的虚拟机软件有VMware、VirtualBox，他们都有Windows和Linux两个版本，也就是说，他们可以安装在Windows和Linux两个平台下，在Windows平台下可以虚拟出Windows、Linux、Unix等多个操作系统，同理，在Linux平台上也可以虚拟出Windows、Linux、Unix等多个计算机。</p>
<p><strong>2、硬件需求</strong></p>
<p>   虚拟软件是将两台以上计算机的任务集成到一台计算机上，因此对硬件的要求比较高，主要涉及的是内存、硬盘和CPU。内存要足够大，因为每个虚拟机都会占用一定的内存资源，内存的大小等于各个虚拟系统的总和，可喜的是，现在内存已经很便宜，因此就不是问题了。同样，硬盘空间也是每个虚拟机都要占用的，CPU现在都发展到了一个多核阶段，硬盘也不是问题。</p>
<h5 id="虚拟软件的安装及介绍"><a href="#虚拟软件的安装及介绍" class="headerlink" title="虚拟软件的安装及介绍"></a>虚拟软件的安装及介绍</h5><ol>
<li><p>VirtualBox虚拟机概述</p>
<p><strong>Oracle VirtualBox</strong>是由<a href="https://zh.wikipedia.org/wiki/%E5%BE%B7%E5%9C%8B">德国</a>InnoTek软件公司出品的<a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E6%A9%9F%E5%99%A8">虚拟机</a><a href="https://zh.wikipedia.org/wiki/%E8%BB%9F%E9%AB%94">软件</a>，现在则由<a href="https://zh.wikipedia.org/wiki/%E7%94%B2%E9%AA%A8%E6%96%87%E5%85%AC%E5%8F%B8">甲骨文公司</a>进行开发，是甲骨文公司xVM<a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E5%8C%96">虚拟化</a>平台技术的一部分。它提供用户在<a href="https://zh.wikipedia.org/wiki/32%E4%BD%8D%E5%85%83">32位</a>或<a href="https://zh.wikipedia.org/wiki/64%E4%BD%8D%E5%85%83">64位</a>的<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Windows</a>、<a href="https://zh.wikipedia.org/wiki/Solaris">Solaris</a>及<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a> <a href="https://zh.wikipedia.org/wiki/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1">操作系统</a>上虚拟其它<a href="https://zh.wikipedia.org/wiki/X86">x86</a>的操作系统。用户可以在VirtualBox上安装并且运行<a href="https://zh.wikipedia.org/wiki/Solaris">Solaris</a>、<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Windows</a>、<a href="https://zh.wikipedia.org/wiki/DOS">DOS</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a>、<a href="https://zh.wikipedia.org/wiki/OS/2">OS/2 Warp</a>、<a href="https://zh.wikipedia.org/wiki/OpenBSD">OpenBSD</a>及<a href="https://zh.wikipedia.org/wiki/FreeBSD">FreeBSD</a>等系统作为客户端操作系统与同性质的<a href="https://zh.wikipedia.org/wiki/VMware_Workstation">VMware</a>及<a href="https://zh.wikipedia.org/wiki/Microsoft_Virtual_PC">Virtual PC</a>比较下，VirtualBox独到之处包括<a href="https://zh.wikipedia.org/wiki/%E9%81%A0%E7%AB%AF%E6%A1%8C%E9%9D%A2%E5%8D%94%E5%AE%9A">远程桌面协议</a>（RDP）、<a href="https://zh.wikipedia.org/wiki/ISCSI">iSCSI</a>及<a href="https://zh.wikipedia.org/wiki/USB">USB</a>的支持，VirtualBox在客户机操作系统上已可以支持<a href="https://zh.wikipedia.org/wiki/USB_3.0">USB 3.0</a>的硬件设备，不过要安装Virtualbox Extension Pack。</p>
<p><strong>硬件支持：</strong></p>
<ul>
<li>VirtualBox支持<a href="https://zh.wikipedia.org/wiki/Intel">Intel</a> <a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E5%8C%96%E6%8A%80%E8%A1%93">VT-x</a>与<a href="https://zh.wikipedia.org/wiki/AMD">AMD</a> <a href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E5%8C%96%E6%8A%80%E8%A1%93">AMD-V</a>硬件虚拟化技术。</li>
<li>硬盘被模拟在一个称为虚拟磁盘映像档（Virtual Disk Images）的特殊容器，目前此格式不兼容于其它虚拟机平台运行，通常作为一个系统档存放在主机端操作系统（扩展名.vdi[<a href="https://zh.wikipedia.org/wiki/VirtualBox#cite_note-4">4]</a>)。VirtualBox能够链接iSCSI，且能在虚拟硬盘上运作，此外VirtualBox可以读写VMware <a href="https://zh.wikipedia.org/wiki/VMDK">VMDK</a>档与VirtualPC <a href="https://zh.wikipedia.org/w/index.php?title=VHD&action=edit&redlink=1">VHD</a>档。</li>
<li>ISO映像档可以被挂载成CD/DVD设备，例如下载的Linux发行版DVD映像档可以直接使用在VirtualBox，而不需刻录在光盘上，亦可直接在虚拟机上挂载实体光盘驱动器。</li>
<li>默认上VirtualBox提供了一个支持<a href="https://zh.wikipedia.org/wiki/VESA%E5%8C%AF%E6%B5%81%E6%8E%92">VESA</a>兼容的虚拟显卡，与一个供Windows、Linux、Solaris、OS/2客户端系统额外的驱动程序（guest addition），可以提供更好的性能与功能，如当虚拟机的视窗被缩放时，会动态的调整分辨率。在4.1更支持<a href="https://zh.wikipedia.org/wiki/WDDM">WDDM</a>兼容的虚拟显卡，令<a href="https://zh.wikipedia.org/wiki/Windows_Vista">Windows Vista</a>及<a href="https://zh.wikipedia.org/wiki/Windows_7">Windows 7</a>可以使用<a href="https://zh.wikipedia.org/wiki/Windows_Aero">Windows Aero</a>。</li>
<li>在声卡方面，VirtualBox虚拟一个Intel ICH <a href="https://zh.wikipedia.org/wiki/AC97">AC97</a>声卡与SoundBlaster 16 <a href="https://zh.wikipedia.org/wiki/%E8%81%B2%E9%9C%B8%E5%8D%A1">声霸卡</a>。</li>
<li>在<a href="https://zh.wikipedia.org/wiki/%E4%BB%A5%E5%A4%AA%E7%BD%91">以太网</a>接口卡方面，VirtualBox虚拟了数张<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%A1">网卡</a>：AMD PCnet PCI II、AMD PCnet-Fast III、Intel Pro/1000 MT Desktop、Intel Pro/1000 MT Server、Intel Pro/1000 T Server。</li>
<li>VirtualBox亦可模拟<a href="https://zh.wikipedia.org/wiki/UEFI">UEFI</a>固件，但是，该UEFI固件不支持部分版本的Windows系统。</li>
</ul>
<p><strong>优点：</strong> </p>
<ul>
<li>支持64位客户端操作系统，即使主机使用<a href="https://zh.wikipedia.org/wiki/32%E4%BD%8D">32位</a><a href="https://zh.wikipedia.org/wiki/CPU">CPU</a> (6.0版后主机仅支持64位操作系统)[<a href="https://zh.wikipedia.org/wiki/VirtualBox#cite_note-5">5]</a></li>
<li>支持<a href="https://zh.wikipedia.org/wiki/SATA">SATA</a>硬盘<a href="https://zh.wikipedia.org/wiki/NCQ">NCQ</a>技术</li>
<li>虚拟硬盘快照</li>
<li>无缝视窗模式（须安装客户端驱动程序）</li>
<li>能够在主机端与客户端共享剪贴板（须安装客户端驱动）</li>
<li>在主机端与客户端间创建共享文件夹（须安装客户端驱动）</li>
<li>内置远程桌面服务器</li>
<li>支持VMware VMDK磁盘档及Virtual PC VHD磁盘档格式</li>
<li>3D虚拟化技术支持OpenGL（2.1版后支持）、Direct3D（3.0版后支持）、WDDM（4.1版后支持）</li>
<li>最多虚拟32颗<a href="https://zh.wikipedia.org/wiki/CPU">CPU</a>（3.0版后支持）</li>
<li>支持VT-x与AMD-V硬件虚拟化技术</li>
<li>iSCSI支持</li>
<li>USB与USB2.0支持</li>
</ul>
</li>
<li><p>VMware workstations </p>
<p><strong>VMware Workstation Pro</strong>（曾用名<strong>VMware Workstation</strong>）是<a href="https://zh.wikipedia.org/wiki/VMware">VMware</a>公司推出的一款桌面虚拟计算软件，具有<a href="https://zh.wikipedia.org/wiki/Windows">Windows</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a> 版本。此软件可以提供<a href="https://zh.wikipedia.org/wiki/%E8%99%9A%E6%8B%9F%E6%9C%BA">虚拟机</a>功能，使计算机可以同时运行多个不同<a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>。2015年，VMware Workstation发表12版，<a href="https://zh.wikipedia.org/wiki/VMware_Player">VMware Player</a>转型为VMware Workstation的免费版并改名为<a href="https://zh.wikipedia.org/wiki/VMware_Workstation_Player">VMware Workstation Player</a>，VMware Workstation的付费版定名为VMware Workstation Pro。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装软件</title>
    <url>/blog/2021/11/23/Linux%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="五、Linux安装及管理软件"><a href="#五、Linux安装及管理软件" class="headerlink" title="五、Linux安装及管理软件"></a>五、Linux安装及管理软件</h1><p>​    本章主要简介Linux下软件安装方式，Linux安装软件也有自己的一套方式，最常见的有源码安装方式，RPM安装方式、YUM安装方式和二进制安装方式。用户可以根据自己的需要和获得软件包的不同，选择不自己喜欢的安装方式。</p>
<h2 id="5-1、源码安装方式"><a href="#5-1、源码安装方式" class="headerlink" title="5.1、源码安装方式"></a>5.1、源码安装方式</h2><p>由于Linux操作系统开放源代码，因而在其上安装的软件大部分也都是开源软件，例如Apache、Tomcat、PHP等软件，开源软件基本都是提供源码下载、源码安装的方式；源码安装的好处是用户可以定制软件功能，安装需要的模块，不需要的功能可以不用安装，此外用户还可以自己选择安装路径，方便管理，卸载软件也很方便，只需要删除对应的安装目录即可。</p>
<p>源码安装软件一般有以下几个步骤：下载解压源码、分析安装平台环境（configure）、编译安装软件（make、make install）</p>
<p><strong>5.2、下载、解压源码</strong></p>
<p>Linux下软件的源码一般都是C或者C++语言编写的，并且都会在软件的官网上提供源码包下载，我们可以从官网下载源码文件，然后再传到所在的Linux系统下，如果你的Linux系统处于联网状态下，也可以直接在系统内通过wget之类的下载命令将源码包直接下载到Linux系统下。</p>
<p>下载完成，把相应的软件包解压即可，针对下载的软件包的不同，使用不同方法进行解压，解压完成后进入解压生成的目录中。在这个目录下，一般都在一个REDAME文件。这个文件非常重要，它详细介绍了这个软件所能完成的功能、授权许可、安装需求、安装注意事项、安装方式等。</p>
<h4 id="5-3、分析安装平台环境"><a href="#5-3、分析安装平台环境" class="headerlink" title="5.3、分析安装平台环境"></a>5.3、分析安装平台环境</h4><p>在软件包解压完成之后，源码目录中，一般都会存在configure和README这两个文件，Linux下软件的安装受到操作系统安装环境的影响，比如某些软件在安装或者运行过程中需要调用操作系统本省的库文件，或者需要运行系统的摸个工具等。</p>
<h4 id="5-4、编译、安装软件"><a href="#5-4、编译、安装软件" class="headerlink" title="5.4、编译、安装软件"></a>5.4、编译、安装软件</h4><p>在验证软件安装环境后正式进入软件的编译步骤，在进行编译前，首先了解下关于编译的一些基础知识.</p>
<p>​    在Linux系统下，make是经常用到的编译命令，无论是安装软件还是项目开发，都会经常用到编译、安装命令，也就是make和make install。对于一个包含很多源文件的应用程序，使用make和Makefile工具可以简单快速地解决各个源文件之间复杂的依赖关系，同时，make工具可以自动完成所有源码文件的编译工作，并且可以只对上次编译后修改过的文件进行增量编译，因此，熟练掌握了make和Makefile工具之后，源码安装软件就变得像Windows下安装软件一样简单。</p>
<p>​    1、makefile 文件</p>
<p>​    make工具最主要的功能就是通过makefile文件来实现的，makefile文件时按照某种语法来进行编写的，文件中定义了各个源文件之间的依赖关系，说明了如果编译源文件并生成可执行文件，它通过描述各个源程序之间的关系make工具自动完成编译工具，</p>
<p>​    2、make与make install</p>
<p>​    在了解Makefile文件结构，我们就可以控制编译的选项，定制自己所需的软件功能，接下来，我嗯只须在命令行输入make命令，即可进入编译阶段，根据软件源程序的大小和系统的硬件配置，编译时间不定，编译完成，会在当前目录以及子目录下生成相应的可执行文件，之后就可以进入安装软件，在命令行输入make install命令，在开始安装软件，安装进程会首先创建安装目录，如果没有指定安装目录安装程序默认会在系统的/usr/local目录下创建安装目录，然后将相应的文件和可执行程序从源码目录复制到安装目录下，这样安装就完成了。</p>
<h4 id="RPM包安装"><a href="#RPM包安装" class="headerlink" title="RPM包安装"></a>RPM包安装</h4><h5 id="RPM介绍"><a href="#RPM介绍" class="headerlink" title="RPM介绍"></a><strong>RPM介绍</strong></h5><p>RPM是Red Hat Package Manager的缩写，本意是Red Hat软件包管理，是最先由Redhat公司开发出来的Linux下软件包管理工具，由于这种软件管理非常方便，逐渐被其他Linux发行商所借用，现在已经成为Linux平台下通用的软件包安装方式。</p>
<p>RPM包管理方式的优点是：安装简单、方便，因为软件已经编译完成且打包完成，安装只是个验证环境和解压的过程，此外通过RPM方式安装的软件RPM工具都会记录软件的安装信息，这样方便了软件日后的查询、升级和卸载。</p>
<p>RPM包管理方式的缺点是对操作系统环境的依赖很大，它要求RPM包的那幢环境必须与PRM包封装时的环境和一致或相当，还需啊满足安装时与系统某些软件包的依赖关系。</p>
<h5 id="RPM包的种类和组成"><a href="#RPM包的种类和组成" class="headerlink" title="RPM包的种类和组成"></a><strong>RPM包的种类和组成</strong></h5><p>RPM包的封装格式一般有两种，分别是RPM和SRPM，SRPM包也是一种RPM，但是它包含了编译时的源文件和一些编译指定的参数文件，因而在使用的时候需要重新进行编译，通常SRPM对应的RPM文件类似于“xxx.src.rpm”格式。</p>
<h5 id="RPM工具描述："><a href="#RPM工具描述：" class="headerlink" title="RPM工具描述："></a><strong>RPM工具描述：</strong></h5><p>RPM工具的使用分为安装、查询、验证、更新、删除等操作。</p>
<ul>
<li><p>安装软件包：</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">rpm [选项...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>常用选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">安装&#x2F;升级&#x2F;擦除选项：
  --allfiles                       安装全部文件，包含配置文件，否则配置文件会被跳过。
  --allmatches                     移除所有符合 &lt;package&gt; 的软件包(如果 &lt;package&gt;
                                   被指定未多个软件包，常常会导致错误出现)
  --badreloc                       对不可重定位的软件包重新分配文件位置
  -e, --erase&#x3D;&lt;package&gt;+           清除 (卸载) 软件包
  --excludedocs                    不安装程序文档
  --excludepath&#x3D;&lt;path&gt;             略过以 &lt;path&gt; 开头的文件
  --force                          --replacepkgs --replacefiles 的缩写
  -F, --freshen&#x3D;&lt;packagefile&gt;+     如果软件包已经安装，升级软件包
  -h, --hash                       软件包安装的时候列出哈希标记 (和 -v 一起使用效果更好)
  --ignorearch                     不验证软件包架构
  --ignoreos                       不验证软件包操作系统
  --ignoresize                     在安装前不检查磁盘空间
  -i, --install                    安装软件包
  --justdb                         更新数据库，但不修改文件系统
  --nodeps                         不验证软件包依赖
  --nofiledigest                   不验证文件摘要
  --nocontexts                     不安装文件的安全上下文
  --noorder                        不对软件包安装重新排序以满足依赖关系
  --noscripts                      不执行软件包脚本
  --notriggers                     不执行本软件包触发的任何脚本
  --nocollections                  请不要执行任何动作集
  --oldpackage                     更新到软件包的旧版本(带 --force 自动完成这一功能)
  --percent                        安装软件包时打印百分比
  --prefix&#x3D;&lt;dir&gt;                   如果可重定位，便把软件包重定位到 &lt;dir&gt;
  --relocate&#x3D;&lt;old&gt;&#x3D;&lt;new&gt;           将文件从 &lt;old&gt; 重定位到 &lt;new&gt;
  --replacefiles                   忽略软件包之间的冲突的文件
  --replacepkgs                    如果软件包已经有了，重新安装软件包
  --test                           不真正安装，只是判断下是否能安装
  -U, --upgrade&#x3D;&lt;packagefile&gt;+     升级软件包
  --reinstall&#x3D;&lt;packagefile&gt;+       reinstall package(s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="yum安装方式"><a href="#yum安装方式" class="headerlink" title="yum安装方式"></a>yum安装方式</h4><p>yum是yellowdog update modified 的缩写，yellow dog（黄狗）也是Linux的一个发行版本，只不过Red Hat公司是将这种升级技术利用到自己的发行版上就形成了现在的yum,yum是进行Linux系统下软件安装和升级常用的一个工具，通过Linux工具配合互联网即可实现软件的便捷安装和自动升级。</p>
<h5 id="yum-安装及配置"><a href="#yum-安装及配置" class="headerlink" title="yum 安装及配置"></a>yum 安装及配置</h5><p><strong>yum的安装</strong></p>
<p>以CentOS 7 为例，要检查yum是否已经安装，基本系统默认会自动安装yum工具</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# rpm -qa |grep yum<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>yum的配置</strong></p>
<p>yum的配置文件有主要配置文件/etc/yum.conf,资源库配置目录/etc/yum.repos.d。 yum 安装后，默认的一些资源库配置可能无法使用，因此需要进行修改，修改配置文件为：/etc/yum.repos.d/</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[cr]
name&#x3D;CentOS-$releasever - cr  
baseurl&#x3D;http:&#x2F;&#x2F;mirror.centos.org&#x2F;centos&#x2F;$releasever&#x2F;cr&#x2F;$basearch&#x2F;
gpgcheck&#x3D;1
gpgkey&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-CentOS-7
enabled&#x3D;0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>yum的特点与基本用法</strong></p>
<ol>
<li><p>yum的特点</p>
<ul>
<li>安装方便，自动解决添加或删除RPM包时遇到的依赖性问题。</li>
<li>可以同时配置多个资源库（Repository）</li>
<li>配置文件简单明了（/etc/yum.conf,  /etc/yum.repos.d/）</li>
<li>保持与RPM数据库的一致性</li>
</ul>
</li>
<li><p>yum的基本用法</p>
<ul>
<li><p>如果安装或者删除RPM包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# yum -y install *.rpm
[root@localhost ~]# yum -y remove *.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>检查yum工具更新软件包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# yum check-update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>更新所有的RPM软件包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# yum update -y <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>通过yum查询RPM包信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# yum info <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<h3 id><a href="#" class="headerlink" title></a></h3>]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux常用命令</title>
    <url>/blog/2021/11/23/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h1 id="四、Linux常用命令及使用技巧"><a href="#四、Linux常用命令及使用技巧" class="headerlink" title="四、Linux常用命令及使用技巧"></a>四、Linux常用命令及使用技巧</h1><p>本章重点讲述Linux命令的使用，命令是学习Linux必须熟练掌握的一部分，Linux下的命令大概有1000个，而常用的命令只有100个左右，这些常用命令需要灵活掌握。虽然Linux的各个发行版大同小异，但是常用命令基本相同，因此只要掌握了常用的Linux命令，就能融汇贯通各个Linux版本了。</p>
<h2 id="Linux下的shell简介"><a href="#Linux下的shell简介" class="headerlink" title="Linux下的shell简介"></a>Linux下的shell简介</h2><h3 id="什么是shell"><a href="#什么是shell" class="headerlink" title="什么是shell"></a>什么是shell</h3><p><strong>Unix shell</strong>，一种<a href="https://zh.wikipedia.org/wiki/%E6%AE%BC%E5%B1%A4">壳层</a>与<a href="https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2">命令行界面</a>，是<a href="https://zh.wikipedia.org/wiki/UNIX">UNIX</a><a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>下传统的用户和计算机的交互界面。第一个用户直接输入<a href="https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4_(%E8%AE%A1%E7%AE%97%E6%9C%BA)">命令</a>来执行各种各样的任务。</p>
<p>普通意义上的shell就是可以接受用户输入命令的程序。它之所以被称作shell是因为它隐藏了操作系统低层的细节。同样的Unix下的图形用户界面<a href="https://zh.wikipedia.org/wiki/GNOME">GNOME</a>和<a href="https://zh.wikipedia.org/wiki/KDE">KDE</a>，有时也被叫做“虚拟shell”或“图形shell”。</p>
<p>Unix操作系统下的shell既是用户交互的界面，也是控制系统的<a href="https://zh.wikipedia.org/wiki/%E8%84%9A%E6%9C%AC%E8%AF%AD%E8%A8%80">脚本语言</a>。当然在这点也有别于Windows下的命令行，虽然也提供了很简单的控制语句。在Windows操作系统下，可能有些用户从来都不会直接的使用shell，然而在Unix系列操作系统下，shell仍然是控制系统启动、<a href="https://zh.wikipedia.org/wiki/X_Window">X Window</a>启动和很多其他实用工具的脚本解释程序。</p>
<h3 id="shell-语法"><a href="#shell-语法" class="headerlink" title="shell 语法"></a>shell 语法</h3><p>Linux下的各种shell的主要区别在于命令行的语法对于一些普通的命令，各个shell版本的语法基本相同，只有在编写一个shell脚本或者使用一些shell高级特性的时候，各个版本shell的差异才会显示出来。</p>
<p>shell语法分析是指shell对命令的扫描处理过程，也就是，把命令或者用户输入的内容分解成要处理的各个部分的操作，在Linux系统下，shell语法分析包含很多内容，如重定向、文件名扩展和管道等</p>
<p><strong>shell语法格式</strong></p>
<p>用户登陆系统后，shell命令行启动。shell遵循一定的语法格式将用户输入的命令进行分析解释并传递给系统内核。shell命令的一般格式为：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">command [option] [arguments]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解释：</p>
<blockquote>
<ul>
<li><p>command:表示命令的名称。</p>
</li>
<li><p>options: 表示命令的选项。</p>
</li>
<li><p>arguments: 表示命令的参数。</p>
</li>
</ul>
</blockquote>
<p>根据习惯，我们一般把具有以上格式的字符串称为命令行。命令行是用户与shell之间对话的基本单位；</p>
<p>在命令行中，选项是包含一个或多个字母的代码，主要用户改变命令的执行方式。一般在选项前面有一个“-”符号；</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls -a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>shell通配符</strong></p>
<p>通配符注定要为了方便用户对文件或者目录的描述，例如，当用户需要以“.sh”结尾的文件时，使用通配符就能很方便地实现。各个版本的shell都有通配符，这些通配符是一些特殊字符，用户可以在命令行的参数中使用这些字符，进行文件名或者路径名的匹配。shell将把与命令行中指定的匹配规则符合的所有文件名或者路径名作为命令的参数，然后执行这个命令。</p>
<p>bash中常见的通配符有“*”、“？”、“[]”。</p>
<ol>
<li><p>“*“ 匹配任意一个或多个字符</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls *.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>解释：</strong></p>
<p>列出当前目录所有以”.txt”结尾的文件</p>
</li>
<li><p>”?“  匹配任意单一字符</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls ab?.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>解释：</strong></p>
<p>列出当前目录下ab开头，随后的一个字母是任意字符，最后以”.txt”结尾的文件。</p>
</li>
<li><p>”[]“ 匹配任何包含在方括号内的单字符</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls [abc]*.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>解释：</strong></p>
<p>列出当前目录下以a、b或c开头，租后以“.txt”结尾的文件。</p>
</li>
</ol>
<p><strong>shell重定向</strong></p>
<p>Linux下系统打开多个文件，即标准输出、标准输出和标准错误输出。用户的shell将键盘设为默认的标准输入，默认的标准输出和标准错误输出为屏幕。也就是，用户从键盘输入命令，然后偶将结果和错误消息输出到屏幕。</p>
<p>所谓的重定向，就是不适用系统默认的标准输入/输出，而是重新指定，因此重定向分为输入重定向、输出重定向和错误输出重定向，要实现重定向就需要了解重定向操作符，shell就是根据重定向操作符来决定重定向操作的。</p>
<ol>
<li><p>输入重定向</p>
<p>​     输入重定向用于改变命令的输入源，利用输入重定向，就可以将一个文件的内容作为命令的输入，而不从键盘输入。</p>
<p>用于输入重定向的操作符有“&lt;”和”&lt;&lt;”</p>
<p>例如：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# wc -l &lt; &#x2F;etc&#x2F;hosts
2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>输出重定向</p>
<p>输出重定向不是将命令的输出结果在屏幕，而是输入到一个指定的文件内。</p>
<p>用于输出重定向的操作符有“&gt;”和“&gt;&gt;”</p>
<p>例如：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls &gt; a.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# cat a.txt 
anaconda-ks.cfg
a.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>错误重定向</p>
<p>错误重定向和标准输出重定向一样，可以使用操作符”2&gt;”和”2&gt;&gt;”实现对错误输出的重定向。</p>
<p>例如：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls a.txt b.txt 2&gt; error.txt
a.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# cat error.txt 
ls: 无法访问b.txt: 没有那个文件或目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>shell的管道</p>
<p>管道可以把很多的命令连接起来，可以把第一个命令的输入当作第二个命令的输出，第二个命令的输出可以当作第2个命令的输入，以此类推，因此，管道的作用就是把一个命令的输出当作下一个命令的输入，而不经过中间文件。</p>
<p>通过管道符“|”可以建立管道连接。</p>
<p>例如：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# cat error.txt  | wc -l
1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>shell中的引用</p>
<p>在bash中的很多特殊字符，这些字符本身就具有特殊含义，Linux中使用“引用”技术来忽略这些字符的特殊含义，引用技术就是通知shell将这些特殊字符当作普通字符处理。</p>
<p>shell中用于应用的字符有转义字符“\”、单引号” ‘ “、双引号“ “” ”。</p>
</li>
<li><p>shell的自动补全命令</p>
<p>自动补全命令行是bash一个简单而且使用的功能，自动补全命令行也就是在输入命令时不必把命令全部输入，shell就能智能判断用户所要输入的命令。</p>
</li>
</ol>
<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><h3 id="2-1-system"><a href="#2-1-system" class="headerlink" title="2.1 system"></a>2.1 system</h3><p><strong>uname 命令</strong></p>
<p>功能描述：</p>
<p>​    uname命令显示操作系统的相关信息</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">uname [OPTION]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a 显示操作系统全部信息
-m 显示系统CPU架构
-s 显示操作系统类型
-r 显示操作系统内核版本
-n 显示操作系统的主机名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# uname -a
Linux localhost.localdomain 3.10.0-1127.el7.x86_64 #1 SMP Tue Mar 31 23:36:51 UTC 2020 x86_64 x86_64 x86_64 GNU&#x2F;Linux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p> <strong>uptime 命令</strong></p>
<p>功能描述：</p>
<p>​    uptime命令用来输出系统任务队列信息</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">uptime [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-p, --pretty   显示运行时间
-h, --help     display this help and exit 
-s, --since    显示系统时间
-V, --version  output version information and exit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>hostname命令</strong></p>
<p>功能描述：</p>
<p>​    hostname 显示系统主机名</p>
<p>语法格式</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hostname [options] &#123;hostname|-F file&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a，别名
-A，--all-fqdns所有长主机名（FQDN）
-b，--boot设置默认主机名（如果没有）
-d，--domain DNS域名
-f，-fqdn，-long长主机名（FQDN）
-F，--file从给定文件中读取主机名或NIS域名
-i，--ip-address主机名的地址
-I，--all-ip-address主机的所有地址
-s，--short短主机名
-y，-yp，-nis NIS &#x2F; YP域名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：<br>i<br>查看系统主机名</p>
<pre class="line-numbers language-none"><code class="language-none">[root@localhost ~]# hostname
localhost.localdomain<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>临时修改主机名</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# hostname test.example.com
[root@localhost ~]# bash
[root@test ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>last命令</strong></p>
<p>功能描述：</p>
<p>​    显示最近登陆用户的列表</p>
<p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">last,lastd [options] <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>示例：</p>
<p>查看系统重启历史</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test ~]# last reboot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p><strong>ls命令</strong></p>
<p>功能说明:</p>
<p>ls 命令是显示指定工作目录下的内容，列出目录所含的文件及目录。</p>
<p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ls [选项]... [文件]...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ls的选项及其说明如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a  不隐藏任何以. 开始的项目
-l	使用较长格式列出信息
-d  只显示目录列表，不显示文件
-l  除文件名称外，同时将文件或者子目录的权限、使用者和大小等详细信息列出
-s  在每个文件名后输出的该文件的大小
-k  以k字节的形式表示文件的大小
-u  以文件上次被访问的时间排序
-i  以时间排序
-O  显示除组信息的详细信息
-r  对目录反向排序
-q  用&quot;?&quot;代替不可输出的内容
-m  横向输出文件名，并以“,”作为分隔符
-S  以文件大小排序
-R  列出所有子目录下的文件
-pF 在每个文件名附上一个字符以说明该文件的类型，“*”表示可执行的普通文件，“&#x2F;”表示目录，“@”表示符号链接，“|”表示FIFO，“&#x3D;”表示套接字（socket）
-C  按列输出，纵向排序
-R  列出所有子目录下的文件
-Q  把输出的文件名用双引号括起来<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>以下命令列出/home目录下文件及其子目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ls -l 
总用量 12
-rw-------. 1 root root 1259 1月  21 00:20 anaconda-ks.cfg
-rw-r--r--. 1 root root 7411 1月  22 01:28 ls-help.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>pwd命令</strong></p>
<p>功能说明</p>
<p>显示当前的工作目录，执行pwd指令可立刻得知目前所在的工作目录的绝对路径名称；</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pwd <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>cd 命令</strong></p>
<p>功能说明：</p>
<p>切换当前工作目录</p>
<p>语法格式：</p>
<pre class="line-numbers language-sehll" data-language="sehll"><code class="language-sehll">cd [dir]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd  [dir]   切换到指定文件夹下，注意：Linux下文件和文件夹是区分大小写的
cd 或 cd ~   返回当前用户家目录
cd ~[用户名]  返回指定用户的家目录
cd .. 或者 cd .&#x2F; 返回上级目录
cd &#x2F;         放回到根目录下<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>切换到/opt 目录下，命令如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# cd &#x2F;opt&#x2F;
[root@localhost opt]# pwd
&#x2F;opt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>返回root目录，命令如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost opt]# cd 
[root@localhost ~]# 
[root@localhost ~]# pwd
&#x2F;root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>date命令</strong></p>
<p>功能说明</p>
<p>显示或者修改系统时间和日期。只有超级用户才能用date命令设置时间，一般用户只能用date命令显示时间。</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">date [选项]... [+格式] 或者
date [选项] 显示时间格式（以+开头，后面接时间格式）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-s  --set 设置系统时间
-d  --date 显示描述的日期<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>时间显示格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">%%	一个文字的 %
%a	当前locale 的星期名缩写(例如： 日，代表星期日)
%A	当前locale 的星期名全称 (如：星期日)
%b	当前locale 的月名缩写 (如：一，代表一月)
%B	当前locale 的月名全称 (如：一月)
%c	当前locale 的日期和时间 (如：2005年3月3日 星期四 23:05:25)
%C	世纪；比如 %Y，通常为省略当前年份的后两位数字(例如：20)
%d	按月计的日期(例如：01)
%D	按月计的日期；等于%m&#x2F;%d&#x2F;%y
%e	按月计的日期，添加空格，等于%_d
%F	完整日期格式，等价于 %Y-%m-%d
%g	ISO-8601 格式年份的最后两位 (参见%G)
%G	ISO-8601 格式年份 (参见%V)，一般只和 %V 结合使用
%h	等于%b
%H	小时(00-23)
%I	小时(00-12)
%j	按年计的日期(001-366)
%k   hour, space padded ( 0..23); same as %_H
%l   hour, space padded ( 1..12); same as %_I
%m   month (01..12)
%M   minute (00..59)
%n	换行
%N	纳秒(000000000-999999999)
%p	当前locale 下的&quot;上午&quot;或者&quot;下午&quot;，未知时输出为空
%P	与%p 类似，但是输出小写字母
%r	当前locale 下的 12 小时时钟时间 (如：11:11:04 下午)
%R	24 小时时间的时和分，等价于 %H:%M
%s	自UTC 时间 1970-01-01 00:00:00 以来所经过的秒数
%S	秒(00-60)
%t	输出制表符 Tab
%T	时间，等于%H:%M:%S
%u	星期，1 代表星期一
%U	一年中的第几周，以周日为每星期第一天(00-53)
%V	ISO-8601 格式规范下的一年中第几周，以周一为每星期第一天(01-53)
%w	一星期中的第几日(0-6)，0 代表周一
%W	一年中的第几周，以周一为每星期第一天(00-53)
%x	当前locale 下的日期描述 (如：12&#x2F;31&#x2F;99)
%X	当前locale 下的时间描述 (如：23:13:48)
%y	年份最后两位数位 (00-99)
%Y	年份
%z +hhmm		数字时区(例如，-0400)
%:z +hh:mm		数字时区(例如，-04:00)
%::z +hh:mm:ss	数字时区(例如，-04:00:00)
%:::z			数字时区带有必要的精度 (例如，-04，+05:30)
%Z			按字母表排序的时区缩写 (例如，EDT)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<ul>
<li><p><input disabled type="checkbox">  用指定的格式显示时间和日期</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# date &#39;+this date now is %x time is now:%X&#39;
this date now is 2021年01月22日 time is now:02时27分16秒<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p><input disabled type="checkbox">  修改系统时间</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# date
2021年 01月 22日 星期五 02:27:38 CST
[root@localhost ~]# date -s 00:10
2021年 01月 22日 星期五 00:10:00 CST<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p><strong>passwd 命令</strong></p>
<p>功能说明：设置用户密码</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">passwd [选项...] &lt;帐号名称&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-k, --keep-tokens       保持身份验证令牌不过期
-d, --delete            删除已命名帐号的密码(只有根用户才能进行此操作)
-l, --lock              锁定指名帐户的密码(仅限 root 用户)
-u, --unlock            解锁指名账户的密码(仅限 root 用户)
-e, --expire            终止指名帐户的密码(仅限 root 用户)
-f, --force             强制执行操作
-x, --maximum&#x3D;DAYS      密码的最长有效时限(只有根用户才能进行此操作)
-n, --minimum&#x3D;DAYS      密码的最短有效时限(只有根用户才能进行此操作)
-w, --warning&#x3D;DAYS      在密码过期前多少天开始提醒用户(只有根用户才能进行此操作)
-i, --inactive&#x3D;DAYS     当密码过期后经过多少天该帐号会被禁用(只有根用户才能进行此操作)
-S, --status            报告已命名帐号的密码状态(只有根用户才能进行此操作)
--stdin                 从标准输入读取令牌(只有根用户才能进行此操作)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>普通用户设置用户密码：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">passwd <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>超级用户root修改某个用户的密码</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">passwd [用户名]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>su命令</strong></p>
<p>功能说明：</p>
<p>su命令主要用于切换用户身份</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">su [选项] [-] [USER [参数]...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-m, -p, --preserve-environment  不重置环境变量
-g, --group &lt;组&gt;                 指定主组
-G, --supp-group &lt;组&gt;           指定一个辅助组
-, -l, --login                  使 shell 成为登录 shell
-c, --command &lt;命令&gt;             使用 -c 向 shell 传递一条命令
--session-command &lt;命令&gt;         使用 -c 向 shell 传递一条命令
                                而不创建新会话
-f, --fast                      向shell 传递 -f 选项(csh 或 tcsh)
-s, --shell &lt;shell&gt;             若 &#x2F;etc&#x2F;shells 允许，则运行 shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>普通用户切换root用户</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[test@localhost root]$ su -
密码：
上一次登录：五 1月 22 01:22:53 CST 2021从 gatewaypts&#x2F;0 上
[root@localhost ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>clear命令</strong></p>
<p>功能描述：</p>
<p>​    clear命令用来清除屏幕信息</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">clear<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>man命令</strong></p>
<p>功能描述：</p>
<p>​    man命令用来显示指定命令的帮助信息。</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">man [OPTION...] [SECTION] PAGE...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>示例：</p>
<p>查看man命令的帮助信息，命令如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">man man<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>who命令</strong></p>
<p>功能描述：</p>
<p>​    who命令显示目前登陆系统的用户</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">who [OPTION]... [file]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a 列出所有信息
-b 列出系统最近启动的日期
-l 列出所有可登录的终端信息
-m 仅列出关于当前终端的信息
-q 列出在本地系统上的用户和用户数的名称
-r 显示当前系统的运行级别
-s 仅显示名称、终端和时间字段信息
-u 显示当前每个用户的用户名，登录终端、登录时间、终端活动和进程标识
-T或-w 显示tty终端的状态，“+”表示对任何人可写，“-”表示仅对root用户或所有者可写，“?”表示遇到终端故障<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>查看当前系统处于运行级别</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# who -r
         run-level 3  2021-01-21 17:49<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>输出的内容：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# who
root     tty1         2021-01-21 17:50
root     pts&#x2F;0        2021-01-22 01:22 (gateway)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>解释：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">名称 [状态] 终端 时间 [活动] [进程标识] [主机名]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>w命令</strong></p>
<p>功能描述： </p>
<p>​    显示登陆到系统的用户信息</p>
<p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">w [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
 <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-h  不显示输出信息的标题
-l  用长格式输出
-s  用短格式输出，显示登陆时间、JCPU和PCPU时间
—V  显示版本信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# w
 01:29:11 up  9:58,  2 users,  load average: 0.00, 0.01, 0.04
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
root     tty1                      17:50    6:39   1.32s  1.32s -bash
root     pts&#x2F;0    gateway          01:22     ?     0.22s  0.06s w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解释：</p>
<p>第一行输出信息表示：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">当前的系统时间、系统已运行的时间、登陆系统的用户数、系统平均负载：1分钟、5分钟、15分钟系统负载情况<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>第二行输出信息表示：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">user:   表示登陆系统的用户
TTY:	  用户使用TTY名称
FROM:   用户从哪里登录进来，一般显示远程登陆主机的IP地址或者主机名
LOGIN@: 用户登陆的日期和时间
IDLE:   表示某个程序上次从终端开始执行到现在所持续的时间
JCPU:   表示该终端上的所有进程及子进程使用系统的时间
PCPU:   当前活动进程使用的系统时间
WHAT:   当前用户执行的进程名称和选项<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>free命令</strong></p>
<p>功能说明：</p>
<p>​    free命令用来显示系统内存状态，具体包括系统物理内存、虚拟内存、共享内存和系统缓存。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">free [option] <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-b  以字节为单位显示内存使用情况
-m  以MB为单位显示内存使用情况
-K  以KB为单位显示内存使用情况
-t  显示内存总和列
-s  根据指定的间隔秒数持续显示内存使用情况
-o  不显示系统缓冲区别<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# free 
              total        used        free      shared  buff&#x2F;cache   available
Mem:         995684      169212      688236        7848      138236      682044
Swap:       2097148           0     2097148<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>解释：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">total: 总内存
used:  已使用的内存
free:  剩余内存
shared:
buff&#x2F;cache:
available:
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ps命令</strong></p>
<p>功能描述：</p>
<p>​    ps命令显示系统进程在瞬间的运行状态。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ps [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a 显示所有用户的进程，包含每个程序的完整路径
-x 显示所有系统内存，包括哪些没有终端的程序
-u 显示使用者的名称和起始时间
-f 详细显示程序执行的路径群
-c 只显示进程的名称，不显示进程的完整路径
-e 解除内核进程以为所有进程的信息写到标准输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# ps 
   PID TTY          TIME CMD
 10356 pts&#x2F;0    00:00:00 bash
 10790 pts&#x2F;0    00:00:00 su
 10804 pts&#x2F;0    00:00:00 su
 10808 pts&#x2F;0    00:00:00 bash
 11385 pts&#x2F;0    00:00:00 ps<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出内存详解：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">PID 表示是进程的标识号；
TTY 表示进程所属的终端控制台；
TIME 表示进程所使用的的CPU时间；
CMD 表示列出正在执行的命令行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>top命令</strong></p>
<p>​        top命令提供了对系统处理器状态的实时监控，它能够实时显示系统中各个进程的资源占用情况，该命令可以按照对CPU的使用、内存使用和执行时间对系统任务进程进行排序显示，同时top命令还可以通过交互式命令进行设定显示。</p>
<p>功能描述：</p>
<p>查看即时活跃的进程，类似于Windows的任务管理器。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">top [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-d 指定每两次屏幕信息刷新之间的时间间隔
-i 不显示闲置或者僵死的进程信息
-c 显示进程的整个命令路径，而不是只显示命令名称
-s 使top命令在安全模式下运行，此时top的交互式命令被取消，避免潜在危险
-b 分屏显示输出信息，结合“-n”选项可以将屏幕信息输出到文件；
-n top输出信息更新的次数，完成后将退出top命令<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>交互式命令选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">h或？ 显示帮助信息，给出交互式命令的一些说明
k 终止一个进程，系统将显示用户输入一个需要终止进程的PID
i 忽略闲置进程和僵死进程，这是一个开关式命令
s 改变top输出信息两次刷新之间的时间，系统将提示输入新的时间，单位是秒，如果输	入小数，就换算成毫秒，如果输入0，系统输出将不断刷新，默认刷新时间是5秒，需要	注意的是，如果设置太短的时间，可能会引起系统不断刷新，无法看清输出显示情况，而且系统负载也会加大
o或者O 该表top输出信息中显示项的顺序，按小写的a~z键可以将相应的列向右移动，而按大写的A~Z键可以将相应列向左移动，最后按enter键确定
f或者F  从当前显示列表中添加或者删除项，按f键之后会显示列的列表，按a~z键即可显示或隐藏对应的列。最后按Enter键确定
m 切换显示内存信息
t 切换显示进程和CPU状态信息
r 重新设置一个进程的优先级，系统提示用户输入需要改变的集成PID以及需要设置的进程优先级值，输入一个正值将使优先级减低，反之则可以使该进程拥有更高的优先权。默认值为0；
l 切换显示进程和CPU状态信息
q 退出top显示
c 切换显示完整命令行和命令名称信息
M 根据驻留内存大小进行排序输出
T 根据时间&#x2F;累计时间进行排序输出
S 切换到累计模式
W 将当前top设置写入~&#x2F;.toprc文件中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">top - 03:41:01 up 12:10, 2 users, load average: 0.00, 0.01, 0.05

Tasks: **104** total,  **1** running, **103** sleeping,  **0** stopped,  **0** zombie

%Cpu(s): **0.0** us, **0.0** sy, **0.0** ni,**100.0** id, **0.0** wa, **0.0** hi, **0.0** si, **0.0** st

KiB Mem :  **995684** total,  **686920** free,  **169924** used,  **138840** buff&#x2F;cache

KiB Swap: **2097148** total, **2097148** free,    **0** used.  **681016** avail Mem 
  PID USER   PR NI  VIRT  RES  SHR S %CPU %MEM   TIME+ COMMAND                                  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">top - 09:44:56[当前系统时间],
days[系统已经运行了16天],
user[个用户当前登录],
load average: [系统负载，即任务队列的平均长度]
Tasks:  total[总进程数],
running[正在运行的进程数],
sleeping[睡眠的进程数],
stopped[停止的进程数],
zombie[冻结进程数],
Cpu(s): 99.8%us[用户空间占用CPU百分比],
0.1%sy[内核空间占用CPU百分比],
0.0%ni[用户进程空间内改变过优先级的进程占用CPU百分比],
0.2%id[空闲CPU百分比], 0.0%wa[等待输入输出的CPU时间百分比],
0.0%hi[服务硬件中断所花费的时间],
0.0%st[指的是当前VM中的cpu cycle被虚拟化偷走的比例],
Mem: 4147888k total[物理内存总量],
2493092k used[使用的物理内存总量],
1654796k free[空闲内存总量],
158188k buffers[用作内核缓存的内存量]
Swap:  5144568k total[交换区总量],
56k used[使用的交换区总量],
5144512k free[空闲交换区总量],
2013180k cached[缓冲的交换区<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>whoami命令</strong></p>
<p>功能描述：</p>
<p>​    查看以什么身份登陆系统</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">whoami [选项]...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>finger user命令</strong></p>
<p>功能描述：</p>
<p>​    显示有关用户的信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="硬件命令"><a href="#硬件命令" class="headerlink" title="硬件命令"></a>硬件命令</h5><p><strong>dmesg命令</strong></p>
<p>功能描述：</p>
<p>​    显示开机信息，内核会将开机信息存储在系统缓冲区（ring buffer）中，如果开机不及时查看相关信息，可以在开机后利用dmesg命令查看，也可以在/var/log/目录中查看dmesg文件。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">dmesg [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-c  显示开机信息后，清楚ring buffer信息
-s  设置缓冲区大小，默认设置为8192
-n  设置记录信息的层级<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>查看CPU</strong></p>
<ul>
<li><p>lscpu 命令</p>
<p>功能描述：</p>
<p>​    查看CPU型号以及详细信息</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lscpu [选项]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a, --all               同时打印在线和离线 CPU (-e 选项默认值)
-b, --online            只打印在线 CPU (-p 选项默认值)
-c, --offline           只打印离线 CPU
-e, --extended[&#x3D;&lt;列表&gt;] 打印扩展的可读格式
-p, --parse[&#x3D;&lt;列表&gt;]    打印可解析格式
-s, --sysroot &lt;目录&gt;    以指定目录作为系统根目录
-x, --hex               打印十六进制掩码而非 CPU 列表
-y, --physical          print physical instead of logical IDs
  
-h, --help     显示此帮助并退出
-V, --version  输出版本信息并退出
  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test ~]# lscpu 
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p><strong>lshw命令</strong></p>
<p>功能描述：</p>
<p>​    lshw 是一个能把我们出去硬件信息的小工具，它能为我们提供内存配置、固件版本、主板配置信息、CPU版本和速度、cache信息、总线速度等。它能运行在 DMI兼容的 x86、IA-64和一些 PowerPC的平台上。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lshw [-format] [-options ...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">format can be
	-html           将硬件以HTML格式输出
	-xml            将硬件以xml格式输出
	-json           将硬件以json对象输出
	-short          输出硬件路径
	-businfo        output bus information 输出总线信息

options can be
	-dump filename  displays output and dump collected information into a file (SQLite database)
	-class CLASS    only show a certain class of hardware
	-C CLASS        same as &#39;-class CLASS&#39;
	-c CLASS        same as &#39;-class CLASS&#39;
	-disable TEST   disable a test (like pci, isapnp, cpuid, etc. )
	-enable TEST    enable a test (like pci, isapnp, cpuid, etc. )
	-quiet          don&#39;t display status
	-sanitize       sanitize output (remove sensitive information like serial numbers, etc.)
	-numeric        output numeric IDs (for PCI, USB, etc.)
	-notime         exclude volatile attributes (timestamps) from output<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>lsblk命令</strong></p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lsblk [选项] [&lt;设备&gt; ...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a, --all            打印所有设备
-b, --bytes          以字节为单位而非易读的格式来打印 SIZE
-d, --nodeps         不打印从属设备(slave)或占位设备(holder)
-D, --discard        打印时丢弃能力
-e, --exclude &lt;列表&gt; 根据主设备号排除设备(默认：内存盘)
-I, --include &lt;列表&gt; 只显示有指定主设备号的设备
-f, --fs             输出文件系统信息
-h, --help           使用信息(此信息)
-i, --ascii          只使用 ascii 字符
-m, --perms          输出权限信息
-l, --list           使用列表格式的输出
-n, --noheadings     不打印标题
-o, --output &lt;列表&gt;  输出列
-p, --paths          打印完整设备路径
-P, --pairs          使用 key&#x3D;“value” 输出格式
-r, --raw            使用原生输出格式
-s, --inverse        反向依赖
-t, --topology       输出拓扑信息
-S, --scsi           输出有关 SCSI 设备的信息
-h, --help     显示此帮助并退出
-V, --version  输出版本信息并退出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="2-2-文件管理与编辑"><a href="#2-2-文件管理与编辑" class="headerlink" title="2.2 文件管理与编辑"></a>2.2 文件管理与编辑</h3><p><strong>mkdir 命令</strong></p>
<p>功能描述：</p>
<p>​    mkdir命令用于创建文件夹；</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkdir [OPTION]... DIRECTORY...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-m, --mode&#x3D;MODE   对文件夹设置权限
-p, --parents     递归创建文件夹
-v, --verbose     输出创建文件夹详情<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>创建一个文件夹test</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mkdir test
[root@localhost ~]# ls
anaconda-ks.cfg  test  top.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>批量创建文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mkdir -p &#x2F;opt&#x2F;test&#x2F;test1 -v
mkdir: created directory ‘&#x2F;opt&#x2F;test’
mkdir: created directory ‘&#x2F;opt&#x2F;test&#x2F;test1’
[root@localhost ~]# ls &#x2F;opt&#x2F;
test <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>touch 命令</strong></p>
<p>功能描述：</p>
<p>​    touch命令用于创建文件</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">touch [OPTION]... FILE...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a                     change only the access time
-c, --no-create        do not create any files
-d, --date&#x3D;STRING      parse STRING and use it instead of current time
-f                     (ignored)
-h, --no-dereference   affect each symbolic link instead of any referenced
                       file (useful only on systems that can change the
                       timestamps of a symlink)
-m                     change only the modification time
-r, --reference&#x3D;FILE   use this file&#39;s times instead of current time
-t STAMP               use [[CC]YY]MMDDhhmm[.ss] instead of current ti<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>创建test文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# touch test
[root@localhost ~]# ls
anaconda-ks.cfg  test  top.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>more命令</strong></p>
<p>​    如果一个文本比较长，一屏无法显示完毕，就需要使用more命令。more命令读取文本文件时，每次显示一屏，并且在每屏底部显示单词“More”。如果此时按Enter键，more命令就会接着再显示文本的一行，一次类推；如果按空格键，more命令就继续显示文本文件的另一屏信息。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">用法：more [选项] 文件...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-d        显示帮助，而不是响铃
-f        统计逻辑行数而不是屏幕行数
-l        抑制换页(form feed)后的暂停
-p        不滚屏，清屏并显示文本
-c        不滚屏，显示文本并清理行尾
-u        抑制下划线
-s        将多个空行压缩为一行
-NUM      指定每屏显示的行数为 NUM
+NUM      从文件第 NUM 行开始显示
+&#x2F;STRING  从匹配搜索字符串 STRING 的文件位置开始显示
-V        输出版本信息并退出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<ul>
<li><p>以分页方式显示文件的内容</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# more top.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>显示以10行文件内容，同时清除屏幕</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# more -c -10 top.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p><strong>cat命令</strong></p>
<p>功能描述:</p>
<p>cat命令用来将文件内容输出到标准输出，类似于DOS下的type命令，同时cat还可以用于连接合并文件。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cat [options] files<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-A, --show-all           等于-vET
-b, --number-nonblank    对非空输出行编号
-e                       等于-vE
-E, --show-ends          在每行结束处显示&quot;$&quot;
-n, --number             对输出的所有行编号
-s, --squeeze-blank      不输出多行空行
-t                       与-vT 等价
-T, --show-tabs          将跳格字符显示为^I
-u                       (被忽略)
-v, --show-nonprinting   使用^ 和M- 引用，除了LFD和 TAB 之外
    --help		显示此帮助信息并退出
    --version		显示版本信息并退出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<ul>
<li><p>查看网卡的配置文件；</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test network-scripts]# cat ifcfg-ens33 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>以下命令将文件file1.txt和file2.txt的内容合并后输出到file3.txt中。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test opt]# ls
file1.txt  file2.txt  waizhi
[root@test opt]# cat file1.txt 
this is file one
[root@test opt]# cat file2.txt 
this is file two
[root@test opt]# cat file1.txt file2.txt &gt; file3.txt
[root@test opt]# cat file3.txt 
this is file one
this is file two
[root@test opt]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p><strong>diff命令</strong></p>
<p>功能描述：</p>
<p>​    diff命令用来比较文件的差异。diff以逐行的方式比较文本文件的异同，如果指定比较的是目录，则diff会比价目前中相同文件名的文件，但不会比较其中的子目录。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">diff [选项]... FILES<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-c 显示全部内容，并标出不同之处
-b 忽略行尾的空格，同时字符串的一个或多个空格都将视为相同
-r 当文件1和文件2为目录时，会比较子目录中的文件
-s 当两个文件相同时，显示文件的相同信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例:</p>
<p>比较文件file1.txt和file2.txt的异同</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test opt]# diff file1.txt  file2.txt 
1c1
&lt; this is file one
---
&gt; this is file two
[root@test opt]# diff -c file1.txt file2.txt 
*** file1.txt	2021-01-22 07:50:49.586053712 +0800
--- file2.txt	2021-01-22 07:50:54.322053893 +0800
***************
*** 1 ****
! this is file one
--- 1 ----
! this is file two<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>grep命令</strong></p>
<p>功能描述：</p>
<p>​    grep命令是Linux下的文本过滤工具，grep根据指定的字符串，对文件的每一行进行搜索，如果找到了这个字符串，就输出该行的内容。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">grep [选项]... PATTERN [FILE]...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<p>grep 命令的选项有很多，这里列出常用的选项说明。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-A NUM 除了列出符合条件的行列，同时列出每个符合条件行的后NUM行
-c 只显示符合条件的行数，二部显示每行的具体信息
-f file 事先将要搜索的样式写入一个文件中，每行一个样式，然后以这个文件作为条件进行搜索
-i 搜索时忽略大小写
-n 在搜索结果中显示行号
-B 与选项“-A”相反，除了列出符合条件的行外，同时列出每个符合条件的前NUM行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>rm命令</strong></p>
<p>功能描述：</p>
<p>​    rm命令用来删除文件或者文件夹及其所有子目录。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">rm [选项]... 文件...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-r 递归删除文件及文件夹
-f 强制删除，不做提示
-i 交互式，确认是否删除<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>ln命令</strong></p>
<p>功能描述：</p>
<p>​    ln命令是创建文件或者文件夹之间创建链接。</p>
<p>​    Linux系统下的链接有两种方式，一种是硬链接，一种是符号链接。Linux系统下创建链接默认是硬链接。</p>
<ul>
<li><p>硬链接</p>
<p>是指通过文件的inode来进行链接。在Linux的文件系统中，保存在磁盘所有类型文件都会分配一个编号，这个编号成为inode号（Inode Index)。多个文件指向同一个inode在Linux系统中是允许的，这就是所谓的硬链接。</p>
</li>
<li><p>符号链接</p>
<p>符号链接也叫软连接，软链接类似于Windows中的快捷方式，因此软链接是一个指向真正的文件或者目录位置的符号连接。</p>
</li>
</ul>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ln [选项]... [-T] 目标 链接名	(第一种格式)
ln [选项]... 目标		(第二种格式)
ln [选项]... 目标... 目录	(第三种格式)
ln [选项]... -t 目录 目标...	(第四种格式)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-f 如果在目标位置存在与链接名相同的文件，这个文件将被删除
-s 进行软链接
-d 允许系统管理员硬链接自己的目录
-b 对将在链接时会被覆盖或者删除的文件进行备份<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>file命令</strong></p>
<p>功能描述：</p>
<p>​    file命令用来显示文件类型。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">file [OPTION...] [FILE...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-b 显示文件类型结果，不显示对应文件名称
-L 直接显示符号链接所指向文件的类型
-z 显示压缩文件的信息
-i 如果文件不是常规文件，则不进一步对文件类型进行分类<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>cp 命令</strong></p>
<p>功能描述：</p>
<p>​    cp 命令用来将给出的文件或者目录复制到另一个文件或者目录中。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cp [选项]... [-T] 源文件 目标文件
cp [选项]... 源文件... 目录
cp [选项]... -t 目录 源文件...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-a 在复制目录时使用，它保留所有的信息，包含文件链接、文件属性，并递归地复制目录
-r 若给出的源文件是一目录文件，此时cp将递归复制该目录下所有的子目录和文件。此时目标文件必须为一个目录名
-d 复制时保留链接，这样不会失去链接文件
-p 保留文件的修改时间和存取权限
-i 如果已经有相同文件名的目标文件，则提示用户是否覆盖<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>find 命令</strong></p>
<p>​    find命令用来在指定的路径下查找指定的文件。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">find  path-name [-options] [-print -exec -ok 命令 &#123;&#125; \;]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<ul>
<li>path-name: find命令查找文件夹目录路径</li>
<li>-options: find命令的这个选项主要用来控制搜索的方式。</li>
<li>-print: 将搜索结果输出到标准输出</li>
<li>-exec：对搜索出符合条件的文件执行所给出的Linux命令，而不询问用户是否需要执行该命令。{}表示shell命令的选项即为所查找的文件。命令的末尾必须以“;”结束</li>
<li>-ok: 对搜索出符合条件的文件执行所给出的Linux命令。与-exec不同的是，它会询问用户是否需要执行命令；</li>
</ul>
<p><strong>mv 命令</strong></p>
<p>功能描述：</p>
<p>​    mv 命令用来将文件或目录改名或将文件由一个目录移入另一个文件夹中。如果源类型和目标类型都是文件或者目录，mv将进行目录重命名。如果源类型为文件，而且标类型为目录，mv将进行文件的移动。如果源类型为目录，则目标类型只能是目录，不能是文件，此时完成目录重命名。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mv [选项]... [-T] 源文件 目标文件
mv [选项]... 源文件... 目录
mv [选项]... -t 目录 源文件...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<p>修改源文件名、移动</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test opt]# ls
file1.txt  file2.txt  file3.txt  waizhi
[root@test opt]# mv file4.txt waizhi&#x2F;
[root@test opt]# ls
file1.txt  file2.txt  waizhi
[root@test opt]# ls waizhi&#x2F;
file4.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>zip/unzip命令</strong></p>
<p>​    将一般文件或者目录进行压缩或者解压，Windows默认生成以”.zip”为后缀的压缩包。</p>
<p>注意：在Linux字符版系统默认是没有安装unzip命令，如果需要解压.zip文件，必须安装此命令;</p>
<p>安装unzip命令：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test ~]# yum -y  install unzip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">unzip [files] 指定文件名需要解压缩的文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>gzip/gunzip 命令</strong></p>
<p>功能描述：</p>
<p>​    将一般的文件进行压缩或者解压。压缩文件的扩展名“.gz”。</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">gzip [OPTION]... [FILE]...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>tar 命令</strong></p>
<p>功能描述：</p>
<p>​    tar是Linux下常用的归档工具，对文件或者文件夹进行打包归档，归档成一个文件，但不进行压缩；</p>
<p>语法如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tar [选项...] [FILE]...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tar -cf archive.tar foo bar  # 从文件 foo 和 bar 创建归档文件archive.tar。
tar -tvf archive.tar         # 详细列举归档文件 archive.tar中的所有文件。
tar -xf archive.tar          # 展开归档文件 archive.tar中的所有文件。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id><a href="#" class="headerlink" title></a></h3>]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux控制台的使用</title>
    <url>/blog/2021/11/23/Linux%E6%8E%A7%E5%88%B6%E5%8F%B0%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="三、Linux系统基本结构"><a href="#三、Linux系统基本结构" class="headerlink" title="三、Linux系统基本结构"></a>三、Linux系统基本结构</h1><p>本章主要从整体上讲述Linux系统的基本结构，主要包括Linux控制台的概念和使用、Linux系统与硬件的关系、系统的目录结构、系统运行概念、系统内核的组成和运行原理、系统服务管理与系统关闭过程等；</p>
<p>#Linux 控制台的使用</p>
<p>Linux系统由桌面控制台和字符控制台组成，桌面系统其实就是我们安装软件包时的X-Window视窗，而X-Window的实质是在命令行下的一个应用程序。字符控制台是Linux系统的核心，大部分操作都是在字符界面下完成的。</p>
<p>默认Linux下有6个字符控制台，每个控制台可以独立作业，互不影响，这真正体现了Linux系统的“多用户、多任务”的特性。在图形界面下要切换到字符界面时，只需按Ctrl+alt+F1~F6组合键中的任何一个，即可进入字符界面。如果想要在字符界面切换图形的话输入命令“startx”或者输入“init 5” 即可；</p>
<p>接下来的工作是登陆系统，Linux系统的默认管理员用户是root，root用户可以操作系统的任何文件和设备，拥有最好权限。输入登陆的用户名root，然后输入对应的密码，即可登陆Linux系统了，登陆成功后，会出现一个Linux命令行，请不要因此而泄气，因为从这里开始，我们才真正踏入Linux学习之旅；</p>
<h2 id="Linux硬件资源管理"><a href="#Linux硬件资源管理" class="headerlink" title="Linux硬件资源管理"></a>Linux硬件资源管理</h2><p>Linux新手可能觉得查看系统的硬件信息很难，没有Windows那么直观，可事实正好相反，应该说，Linux下的命令可以把硬件信息显示更加清楚，下面通过几个相关的Linux命令查看系统硬件信息</p>
<ul>
<li><p><strong>查看系统PCI信息</strong></p>
<p>lspci命令可以列出所有的PCI设备，不如主板、显卡、声卡等，也会把USB接口设备列出来</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# lspci <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token number">00</span><span class="token operator">:</span><span class="token number">00.0</span> Host bridge<span class="token operator">:</span> Intel Corporation <span class="token number">440</span>BX<span class="token operator">/</span><span class="token constant">ZX</span><span class="token operator">/</span><span class="token constant">DX</span> <span class="token operator">-</span> <span class="token number">82443</span>BX<span class="token operator">/</span><span class="token constant">ZX</span><span class="token operator">/</span><span class="token constant">DX</span> Host <span class="token function">bridge</span> <span class="token punctuation">(</span>rev <span class="token number">01</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">01.0</span> <span class="token constant">PCI</span> bridge<span class="token operator">:</span> Intel Corporation <span class="token number">440</span>BX<span class="token operator">/</span><span class="token constant">ZX</span><span class="token operator">/</span><span class="token constant">DX</span> <span class="token operator">-</span> <span class="token number">82443</span>BX<span class="token operator">/</span><span class="token constant">ZX</span><span class="token operator">/</span><span class="token constant">DX</span> <span class="token constant">AGP</span> <span class="token function">bridge</span> <span class="token punctuation">(</span>rev <span class="token number">01</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">07.0</span> <span class="token constant">ISA</span> bridge<span class="token operator">:</span> Intel Corporation <span class="token number">82371</span>AB<span class="token operator">/</span><span class="token constant">EB</span><span class="token operator">/</span><span class="token constant">MB</span> <span class="token constant">PIIX4</span> <span class="token constant">ISA</span> <span class="token punctuation">(</span>rev <span class="token number">08</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">07.1</span> <span class="token constant">IDE</span> <span class="token keyword">interface</span><span class="token operator">:</span> Intel Corporation <span class="token number">82371</span>AB<span class="token operator">/</span><span class="token constant">EB</span><span class="token operator">/</span><span class="token constant">MB</span> <span class="token constant">PIIX4</span> <span class="token constant">IDE</span> <span class="token punctuation">(</span>rev <span class="token number">01</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">07.3</span> Bridge<span class="token operator">:</span> Intel Corporation <span class="token number">82371</span>AB<span class="token operator">/</span><span class="token constant">EB</span><span class="token operator">/</span><span class="token constant">MB</span> <span class="token constant">PIIX4</span> <span class="token constant">ACPI</span> <span class="token punctuation">(</span>rev <span class="token number">08</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">07.7</span> System peripheral<span class="token operator">:</span> VMware Virtual Machine Communication <span class="token function">Interface</span> <span class="token punctuation">(</span>rev <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">0</span>f<span class="token punctuation">.</span><span class="token number">0</span> <span class="token constant">VGA</span> compatible controller<span class="token operator">:</span> VMware <span class="token constant">SVGA</span> <span class="token constant">II</span> Adapter
<span class="token number">00</span><span class="token operator">:</span><span class="token number">10.0</span> <span class="token constant">SCSI</span> storage controller<span class="token operator">:</span> Broadcom <span class="token operator">/</span> <span class="token constant">LSI</span> <span class="token number">53</span>c1030 <span class="token constant">PCI</span><span class="token operator">-</span><span class="token constant">X</span> Fusion<span class="token operator">-</span><span class="token constant">MPT</span> Dual Ultra320 <span class="token constant">SCSI</span> <span class="token punctuation">(</span>rev <span class="token number">01</span><span class="token punctuation">)</span>
<span class="token number">00</span><span class="token operator">:</span><span class="token number">11.0</span> <span class="token constant">PCI</span> bridge<span class="token operator">:</span> VMware <span class="token constant">PCI</span> <span class="token function">bridge</span> <span class="token punctuation">(</span>rev <span class="token number">02</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><strong>查看系统内存信息</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# lsmem <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">ANGE                 SIZE STATE REMOVABLE BLOCK
<span class="token number">0x0000000000000000</span><span class="token operator">-</span><span class="token number">0x0000000007ffffff</span> <span class="token number">128</span>M online    否   <span class="token number">0</span>
<span class="token number">0x0000000008000000</span><span class="token operator">-</span><span class="token number">0x000000000fffffff</span> <span class="token number">128</span>M online    是   <span class="token number">1</span>
<span class="token number">0x0000000010000000</span><span class="token operator">-</span><span class="token number">0x0000000017ffffff</span> <span class="token number">128</span>M online    否   <span class="token number">2</span>
<span class="token number">0x0000000018000000</span><span class="token operator">-</span><span class="token number">0x0000000027ffffff</span> <span class="token number">256</span>M online    是  <span class="token number">3</span><span class="token operator">-</span><span class="token number">4</span>
<span class="token number">0x0000000028000000</span><span class="token operator">-</span><span class="token number">0x000000003fffffff</span> <span class="token number">384</span>M online    否  <span class="token number">5</span><span class="token operator">-</span><span class="token number">7</span>
<span class="token class-name">Memory</span> block size<span class="token operator">:</span>    <span class="token number">128</span>M
<span class="token class-name">Total</span> online memory<span class="token operator">:</span>    <span class="token number">1</span>G
<span class="token class-name">Total</span> offline memory<span class="token operator">:</span>   <span class="token number">0</span>B<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><strong>查看CPU信息</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# lscpu <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Architecture</span><span class="token operator">:</span>          x86_64
CPU op<span class="token operator">-</span><span class="token function">mode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span>        <span class="token number">32</span><span class="token operator">-</span>bit<span class="token punctuation">,</span> <span class="token number">64</span><span class="token operator">-</span>bit
<span class="token class-name">Byte</span> <span class="token class-name">Order</span><span class="token operator">:</span>            <span class="token class-name">Little</span> <span class="token class-name">Endian</span>
<span class="token function">CPU</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span>                <span class="token number">1</span>
<span class="token class-name">On</span><span class="token operator">-</span>line <span class="token function">CPU</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> list<span class="token operator">:</span>   <span class="token number">0</span>
<span class="token class-name">Thread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> per core<span class="token operator">:</span>    <span class="token number">1</span>
<span class="token class-name">Core</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> per socket<span class="token operator">:</span>    <span class="token number">1</span>
座：                 <span class="token number">1</span>
NUMA 节点：         <span class="token number">1</span>
厂商 ID：           <span class="token class-name">GenuineIntel</span>
CPU 系列：          <span class="token number">6</span>
型号：              <span class="token number">70</span>
型号名称：        <span class="token class-name">Intel</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token class-name">Core</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i7<span class="token operator">-</span><span class="token number">4870</span>HQ CPU @ <span class="token number">2.50</span>GHz
步进：              <span class="token number">1</span>
CPU <span class="token class-name">MHz</span>：             <span class="token number">2494.226</span>
<span class="token class-name">BogoMIPS</span>：            <span class="token number">4988.45</span>
超管理器厂商：  <span class="token class-name">VMware</span>
虚拟化类型：     完全
<span class="token class-name">L1d</span> 缓存：          <span class="token number">32</span>K
<span class="token class-name">L1i</span> 缓存：          <span class="token number">32</span>K
L2 缓存：           <span class="token number">256</span>K
L3 缓存：           <span class="token number">6144</span>K
L4 缓存：           <span class="token number">131072</span>K
NUMA 节点<span class="token number">0</span> CPU：    <span class="token number">0</span>
<span class="token class-name">Flags</span><span class="token operator">:</span>                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon nopl xtopology tsc_reliable nonstop_tsc eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 avx2 smep bmi2 invpcid xsaveopt arat md_clear spec_ctrl intel_stibp flush_l1d arch_capabilities<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux网络配置</title>
    <url>/blog/2022/03/24/Linux%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="linux-服务器网络配置"><a href="#linux-服务器网络配置" class="headerlink" title="linux 服务器网络配置"></a>linux 服务器网络配置</h1><p>​    本章主要讲解Linux系统下关于网络的一些基础知识和系统出现网络问题时的应对策略，详细讲述了Linux系统下网卡的安装与配置方法；以及常见网卡故障的排除思路和解决方案</p>
<h2 id="网卡驱动的安装"><a href="#网卡驱动的安装" class="headerlink" title="网卡驱动的安装"></a>网卡驱动的安装</h2><p>Linux操作系统作为服务器在使用过程中，出现问题最多的就是网络问题，而与网络对应的就是操作系统中网卡安装、配置的问题。</p>
<p><strong>网卡驱动安装的一般思路</strong></p>
<p>我们在安装Linux系统的时候，如果出现网卡配置的界面，一般说明系统识别到了网卡，或者说系统光盘中含有网卡的驱动程序。不同的版本，不同的系统内核，所含的网卡驱动程序不尽相同，自从最新内核3.10版本以后，Linux自带的网卡驱动陈旭已经很完善了，许多著名厂商（如 inter Realtek VIA等）都默认支持网卡芯片。但是由于Linux发行版很多，硬件更新又很快，可能仍有部分较新的网卡芯片在Linux下不被支持，此时就需要手动安装网卡驱动程序。</p>
<p>对于网卡安装和使用过程中出现的故障，我们需要有一套完整的故障排除思路和解决方法</p>
<pre><code>1. 首先从硬件入手，检查网卡本身故障
2. 检查网卡芯片型号
3. 查看系统是否包含对应型号的网卡驱动
4. 检查网卡驱动是否加载
</code></pre>
<h2 id="配置linux网络"><a href="#配置linux网络" class="headerlink" title="配置linux网络"></a>配置linux网络</h2><p><strong>不同Linux发行版的网络配置文件</strong></p>
<p>网卡通过驱动程序激活后，接下来就要配置网络信息。网络的配置文件一般都在/etc 目录下，但是不同发行版的Linux，网络配置文件路径略有不同。</p>
<p>RHEL/Centos Linux下网络的配置文件路径为：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-interfacename (interfacename 根据网卡类型和排序不同)
&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-lo # 网卡回环地址
&#x2F;etc&#x2F;sysconfig&#x2F;network  # 主机名和网关配置文件
&#x2F;etc&#x2F;resolv.conf       #DNS 配置文件
&#x2F;etc&#x2F;hosts             #设置主机和IP绑定信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Debin/Ubuntu Linux下网络配置文件路径为：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;etc&#x2F;network&#x2F;interfaces # IP 地址、子网掩码等配置文件
&#x2F;etc&#x2F;resolv.conf        #DNS配置文件
&#x2F;etc&#x2F;hostname						#全局主机名配置文件
&#x2F;etc&#x2F;hosts							#设置主机和IP绑定信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="开启Linux代理转发功能"><a href="#开启Linux代理转发功能" class="headerlink" title="开启Linux代理转发功能"></a><strong>开启Linux代理转发功能</strong></h2><ol>
<li><p>修改/proc下内核参数</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward
0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>0：表示静止IP转发</p>
<p>1：开启IP转发功能</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# echo &quot;1&quot; &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>修改/etc/sysctl.conf文件</p>
<p>默认sysctl.conf文件中有一个变量是：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">net.ipv4.ip_forward &#x3D; 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>将后面的值改为1，然后保存文件。因为每次系统启动时初始化脚本/etc/rc.d/rc.sysint会读取/etc/sysctl.conf文件的内容，所以修改此文件后每次系统重启时都会开启IP转发功能，但只是修改sysctl文件不会马上生效，如果要修改的马上生效的话，可以执行此命令</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# sysctl -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="路由的概念与配置"><a href="#路由的概念与配置" class="headerlink" title="路由的概念与配置"></a>路由的概念与配置</h3><ol>
<li><p><strong>路由的概念</strong></p>
<p>计算机与计算机之间的数据传输必须经由路由网络，而网络可以通过直接连接两台计算机的方式，或者由一个或一个以上的节点来构成。数据传输到另一网络节点，另一个网络节点再将数据传输到下个节点，依次类推，最终把数据传输到目标主机。这就是数据传送的一个完整过程，而每个网络几点就是一个路由，”约定“就是路由规则，数据传输就是根据路由规则依次传输下去的。</p>
</li>
<li><p><strong>路由的分类</strong></p>
<p>路由分为静态路由和动态路由。</p>
<p>静态路由：</p>
<p>​      Linux上配置的路由都属于静态路由。静态路由的产生，是由于系统管理员使用route命令所加入的静态路由规则，也就是由手动输入的方式来加入的路由规则。</p>
<p>动态路由:</p>
<p>​        动态路由就是无需手动输入路由规则，其路由规则是本机与不同及其彼此经路由程序（routing daemon）相互交换路由规则而来的。如果网络发生了变化，路由软件就重新计算路由并发出新的路由更新信息。这些信息更新到网络，是路由器重新计算并对路由表做相应的改变。</p>
</li>
<li><p><strong>路由的配置</strong></p>
<p>在Linux下可以通过route命令配置静态路由信息</p>
<p><strong>(1) route 命令</strong></p>
<p>功能描述：</p>
<p>​    配置系统静态路由：</p>
<p>语法格式：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">route [-n | ee]
route add [-net|-host] [网络或主机] \ netmask [mask] [gw|dev]
route del [-net|-host] [网络或主机] \ netmask [mask] [gw|dev]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-n  不适用通信协议或主机名，直接使用IP地址
-ee 显示更详细的路由信息
add 表示添加路由信息
del 表示删除路由信息
-net 表示添加一个网络，也就是后面接的是一个网络号地址
-host 表示后面接的为连接到单独主机的路由
netmask 表示后面接的是子网掩码信息，子网掩码可以限制网络的大小
gw   网关IP信息，gateway的缩写
dev  指定由那个网络设备联机出去，后面接网络设备名。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         172.16.59.1     0.0.0.0         UG    100    0        0 ens33
172.16.59.0     0.0.0.0         255.255.255.0   U     100    0        0 ens33
[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         gateway         0.0.0.0         UG    100    0        0 ens33
172.16.59.0     0.0.0.0         255.255.255.0   U     100    0        0 ens33<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>(2) route 命令输出的含义：</p>
<blockquote>
<ul>
<li><p>Destination：</p>
<p>表示网络号，也就是network的意思</p>
</li>
<li><p>Gateway:</p>
<p>连出网关地址，也就是说，该网络是通过这个IP地址连接出去的。如果显示0:0:0:0，则表示该路由直接由本机传送出去。如果有IP显示，表示本条路由必须经过这个IP的转接才能连接出去。</p>
</li>
<li><p>Genmask:</p>
<p>表示子网掩码地址，也就是netmask。Destination和Genmask组合成一个完整的网络</p>
</li>
<li><p>Flags：</p>
<p>路由标记信息，有几种不同的标记：</p>
<ul>
<li>U(route is up):表示路由是启动的。</li>
<li>H(target is a host):目标路由是一部主机（IP）而非网络</li>
<li>R(reinstate route for daemon or redirect):使用动态路由时，恢复路由信息标记。</li>
<li>G(use gateway): 表示需要通过外部的主机（gateway）来转接、转递数据。</li>
<li>M(modified from routing daemon or redirect): 表示路由已经被修改了。</li>
<li>D(dynamically installed by daemon or redirect):已经由服务设定为动态路由。</li>
<li>!(reject route)：这个路由将不会被接受（用来抵挡不安全的网络）。</li>
</ul>
</li>
<li><p>Metric:</p>
<p>需要经过几个网络节点（hop）才能到达路由的目标网络地址。</p>
</li>
<li><p>Ref：</p>
<p>参考到此路由规则的数目。</p>
</li>
<li><p>Use:</p>
<p>有几个转送数据包参考到此路由规则。</p>
</li>
<li><p>Iface:</p>
<p>路由对应的网络设备接口。</p>
</li>
</ul>
</blockquote>
</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
  </entry>
  <entry>
    <title>MacbookPor-m1</title>
    <url>/blog/2021/12/02/MacbookPor-m1/</url>
    <content><![CDATA[<h1 id="Macbook-Pro-m1-install-vmware"><a href="#Macbook-Pro-m1-install-vmware" class="headerlink" title="Macbook Pro m1 install vmware"></a>Macbook Pro m1 install vmware</h1><h2 id="获取下载vmware-（开发测试版本）"><a href="#获取下载vmware-（开发测试版本）" class="headerlink" title="获取下载vmware （开发测试版本）"></a>获取下载vmware （开发测试版本）</h2><ul>
<li>下载地址：<a href="https://vmware.com/go/get-fusion-m1">https://vmware.com/go/get-fusion-m1</a></li>
</ul>
<h2 id="安装Linux-CentOS-系统"><a href="#安装Linux-CentOS-系统" class="headerlink" title="安装Linux CentOS 系统"></a>安装Linux CentOS 系统</h2><p>普通x86_64版本的系统！是不支持m1芯片，因为CPU的架构是arm架构，普通inter架构是不支持arm架构，如果想要实现安装，必须是arm架构系统，才能被支持！</p>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>问题根源在于pagesize的支持，M1上面的pagesize是16K，而centos的默认内核是使用的64K的pagesize，当然就不支持了，并且ubuntu，fedora都是4K的所以不存在问题</p>
<h3 id="Centos-7"><a href="#Centos-7" class="headerlink" title="Centos 7"></a>Centos 7</h3><h4 id="获取地址："><a href="#获取地址：" class="headerlink" title="获取地址："></a>获取地址：</h4><ul>
<li>链接: <a href="https://pan.baidu.com/s/1xWRr-o8VFLbpMXhkgzU6KA">https://pan.baidu.com/s/1xWRr-o8VFLbpMXhkgzU6KA</a> 提取码: 9sst</li>
</ul>
<h3 id="Centos-8"><a href="#Centos-8" class="headerlink" title="Centos 8"></a>Centos 8</h3><h4 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h4><ul>
<li>地址：<a href="https://blog.csdn.net/zphj1987/article/details/119173539?spm=1001.2014.3001.5501">https://blog.csdn.net/zphj1987/article/details/119173539?spm=1001.2014.3001.5501</a></li>
</ul>
<h4 id="获取地址：-1"><a href="#获取地址：-1" class="headerlink" title="获取地址："></a>获取地址：</h4><ul>
<li>百度云地址：链接: <a href="https://pan.baidu.com/s/1Ntbp0MGaB5MwfbdvvxVQIQ">https://pan.baidu.com/s/1Ntbp0MGaB5MwfbdvvxVQIQ</a> 提取码: 014m</li>
</ul>
<h2 id="视频链接地址："><a href="#视频链接地址：" class="headerlink" title="视频链接地址："></a>视频链接地址：</h2><p><a href="https://youtu.be/Y15ZXUoaZVU">https://youtu.be/Y15ZXUoaZVU</a></p>
]]></content>
      <categories>
        <category>MAC M1</category>
      </categories>
      <tags>
        <tag>VMware fuison</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL</title>
    <url>/blog/2021/07/16/MySQL/</url>
    <content><![CDATA[<p><img src="https://itsilesia.com/wp-content/uploads/2018/11/mysql-logo.jpg" class="lazyload placeholder" data-srcset="https://itsilesia.com/wp-content/uploads/2018/11/mysql-logo.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<span id="more"></span>
<h2>MySQL 介绍</h2>
MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 [Oracle](https://baike.baidu.com/item/Oracle) 旗下产品。MySQL 是最流行的[关系型数据库管理系统](https://baike.baidu.com/item/关系型数据库管理系统/696511)之一，在 WEB 应用方面，MySQL是最好的 [RDBMS](https://baike.baidu.com/item/RDBMS/1048260) (Relational Database Management System，关系数据库管理系统) 应用软件之一。

<p>MySQL是一种关系型数据库管理系统，关系数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。</p>
<p>MySQL所使用的 SQL 语言是用于访问<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93/103728">数据库</a>的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是<a href="https://baike.baidu.com/item/%E5%BC%80%E6%94%BE%E6%BA%90%E7%A0%81/7176422">开放源码</a>这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。</p>
<p>MySQL是目前最流行的关系型数据库管理系统。它分为社区版和商业版。由于其体积小、速度快、应用成本低、尤其是开发源代码这一特点，使其成为中小型网站开发首选的数据库平台。但是，甲骨文公司收购了MySQL后，又将MySQL闭源的潜在风险，因此社区采用分支的方式来避开这个风险，MariaDB数据库就是MySQL的一个分支。在RHEL 7.0版本之后，系统自带的数据库由MySQL替换为MariaDB数据库，MariaDB主要由开源社区维护，采用GPL授权社区。</p>
<h2>特性</h2>

<ul>
<li>使用C和C++编写，并使用了多种编译器进行测试，保证源代码的可移植性。</li>
<li>支持AIX、BSDi、FreeBSD、HP-UX、Linux、Mac OS、Novell NetWare、NetBSD、OpenBSD、OS/2 Wrap、Solaris、Windows等多种操作系统。</li>
<li>为多种编程语言提供了API。这些編程语言包括C、C++、C#、VB.NET、Delphi、Eiffel、Java、Perl、PHP、Python、Ruby和Tcl等。</li>
<li>支持多线程，充分利用CPU资源，支持多用户。</li>
<li>优化的SQL查询算法，有效地提高查询速度。</li>
<li>既能够作为一个单独的应用程序在客户端服务器网络环境中运行，也能够作为一个程序库而嵌入到其他的软件中。</li>
<li>提供多语言支持，常见的编码如中文的GB 2312、BIG5，日文的Shift JIS等都可以用作数据表名和数据列名。</li>
<li>提供TCP/IP、ODBC和JDBC等多种数据库连接途径。</li>
<li>提供用于管理、检查、優化数据库操作的管理工具。</li>
<li>可以处理拥有上千万条记录的大型数据库。</li>
</ul>
<h2>历史</h2>

<ul>
<li>1979年 Monty Widenius 为一个叫TcX的小公司打工，并用BASIC设计了一个报表工具,可以在4M主频和16KB内的计算机上运行，过了不久使用C语言重写，移植到Unix平台，当时，它只是一个很底层的面向报表的存储引擎，这个工具叫做Unireg;</li>
<li>1985 年，瑞典的几位志同道合小伙子（以David Axmark 为首） 成立了一家公司，这就是MySQL AB 的前身;这个公司最初并不是为了开发数据库产品，而是在实现他们想法的过程中，需要一个数据库。他们希望能够使用开源的产品;</li>
<li>1990年，TcX的customer 中开始有人要求要为它的API提供SQL支持，当时，有人想到了直接使用商用数据库算了，但是Monty觉得商用数据库的速度难令人满意.于是，他直接借助于mSQL的代码，将它集成到自己的存储引擎中。但不巧的是，效果并不太好。于是,Monty雄心大起，决心自己重写一个SQL支持。</li>
<li>1996年，MySQL 1.0发布, 在小范围内使用。到了96年10月，MySQL 3.11.1发布了，没有2.x版本。最开始，只提供了Solaris下的二进制版本。一个月后，Linux版本出现了。 此时的MySQL还非常简陋，除了在一个表上做一些Insert，Update，Delete和Select 操作职位，没有其他更多的功能。</li>
<li>1999-2000年，有一家公司在瑞典成立了，叫MySQL AB。   雇了几个人,与Sleepycat合作，开发出了 Berkeley DB引擎, 因为BDB支持事务处理，所以，MySQL从此开始支持事务处理了。</li>
<li>2000年，MySQL 公布了自己的源代码，并采用GPL（GNU General Public License）许可协议，正式进入开源世界。</li>
<li>2001年发布的3.23 版本的时候，该版本已经支持大多数的基本的SQL 操作，而且还集成了MyISAM和InnoDB 存储引擎。MySQL与InnoDB的正式结合版本是4.0。</li>
<li>2004年10月，发布了经典的4.1版本。 2005年10月，有发布了里程碑的一个版本，MySQL 5.0.  在5.0中加入了游标，存储过程，触发器，视图和事务的支持。在5.0 之后的版本里，MySQL明确地表现出迈向高性能数据库的发展步伐。</li>
<li>2008年1月16号 MySQL被Sun公司收购。</li>
<li>2009年04月20日Oracle收购Sun 公司，MySQL 转入Oracle 门下。</li>
<li>2010年04月22 发布MySQL 5.5, MySQLcluster 7.1.</li>
</ul>
<h2>MySQL管理</h2>

<ul>
<li>可以使用命令行工具管理MySQL数据库（命令mysql和mysqladmin），也可以从MySQL的网站下载图形管理工具MySQL Workbench；</li>
<li>Navicat是一套专为MySQL设计的强大数据库管理及开发工具。它可以用于任何版本的MySQL数据库，并支持大部分MySQL的功能，包括触发器、索引、查看等；</li>
<li>phpMyAdmin是由PHP写成的MySQL数据库系统管理程序，让管理者可用Web接口管理MySQL数据库。借由此Web接口可以成为一个简易方式输入繁杂SQL语法的较佳途径，尤其要处理大量资料的导入及导出更为方便。其中一个更大的优势在于由于phpMyAdmin跟其他PHP程序一样在网页服务器上运行，但是您可以在任何地方使用这些程序产生的HTML页面，也就是于远程管理你的MySQL数据库。使用phpMyAdmin您就可以方便的创建、修改、删除数据库及资料表；</li>
<li>phpMyBackupPro也是由PHP写成的，可以通过Web接口创建和管理数据库。它可以创建伪cronjobs，可以用来自动在某个时间或周期备份MySQL数据库。</li>
</ul>
<h2 id="连接方式"><a href="#连接方式" class="headerlink" title="连接方式"></a>连接方式</h2><ul>
<li>应用程序可通过ODBC或ADO方式，经由使用MyODBC与MySQL数据库连接；</li>
<li>MS .Net Framework下的程序（例如：C#、VB.NET）可通过ADO.NET的方式，经由使用MySQL.Net（页面存档备份，存于互联网档案馆）与MySQL数据库连接；</li>
<li>C/C++可使用MySQL++（页面存档备份，存于互联网档案馆）或是直接使用MySQL内置API与MySQL数据库连接；</li>
<li>PHP可通过PHP的MySQLi与MySQL数据库连接，具备比MySQL模块（页面存档备份，存于互联网档案馆）更好的性能。另外PHP6可使用mysqlnd与MySQL数据库连接；</li>
<li>JAVA程序可通过JDBC方式与MySQL进行连接，MySQL官方提供了JDBC驱动程序；</li>
<li>可通过MySQL客户端软件与MySQL进行连接，如mysqlfront、mysqlyog、mysqlbrowser等；</li>
<li>javascript可以通过使用fibjs的内置mysql模块[2]（页面存档备份，存于互联网档案馆）与MySQL数据库连接。</li>
</ul>
<h2>派生版本</h2>

<ul>
<li>Drizzle</li>
</ul>
<p>  ① 介绍</p>
<p>  Drizzle，一个精简版的MySQL分支，在目前的MySQL代码基本之上，将存储过程、视图、触发器、查询缓存、PREPARE语句等等没什么必要的功能从代码中删掉，简化对数据类型和存储引擎的支持，并且进行大胆的重构。最终要实现的目的是将MySQL的代码大大简化，理顺MySQL的架构，改善MySQL的代码质量，提高系统的稳定性和性能。将更适合 Web应用、云计算组件、没有业务逻辑的数据库（又名存储过程）、多核架构 等业务</p>
<p>  ②特性：</p>
<blockquote>
<p>现在的目标是针对某类应用 / 开发人员，看看对他们是否真的有帮助。举例来说，Drizzle 的目标有：</p>
</blockquote>
<ol>
<li>Web 应用。</li>
<li>云计算组件。</li>
<li>没有业务逻辑的数据库（又名存储过程）。</li>
<li>多核架构。</li>
</ol>
<ul>
<li>基于 MySQL 6.0 的源码树</li>
<li>无附加库</li>
<li>遵守 POSIX</li>
<li>微内核设计</li>
<li>可插拔架构，适用于视图、存储过程、UDF、存储引擎等</li>
<li>跨多个节点的 Sharding 技术</li>
<li>智能代理</li>
<li>多 CPU/ 多核 CPU</li>
<li>优化的字段类型</li>
<li>高效的内存使用</li>
<li>没有内部 ACL，使用 LDAP/PAM</li>
<li>没有数据库数据格式化</li>
<li>整理有序的 Make 系统</li>
<li>缺省存储引擎为 InnoDB</li>
<li>移除 Windows 兼容性</li>
</ul>
<h2>哲学上更大的差异</h2>

<blockquote>
<p>采用外部库，采用开源软件的机制编写代码，保持开放式的沟通，消除了内部开发和外部开发之间的界限。本质上讲，做到了我一直倡导的“朴实的开源”。我们主要针对 C99、POSIX、基于自动化工具（Autotools）的系统。我们完全采用了微内核设计，将代码移出核心，通过接口将其推向边缘。我们在模块间采用了类似于 Linux/Apache 的紧耦合设计。</p>
</blockquote>
<p> 查看英文原文：<a href="http://www.infoq.com/news/2008/08/drizzle">Drizzle - a new direction for databases</a></p>
<h2 id="MariaDB"><a href="#MariaDB" class="headerlink" title="MariaDB"></a>MariaDB</h2><ul>
<li>MariaDB是MySQL关系数据库管理系统的一个复刻，由社区开发，有商业支持，旨在继续保持在GNU GPL下开源。MariaDB的开发是由MySQL的一些原始开发者领导的，他们担心甲骨文公司收购MySQL后会有一些隐患。</li>
<li>MariaDB打算保持与MySQL的高度兼容性，确保具有库二进制奇偶校验的直接替换功能，以及与MySQL API和命令的精确匹配。MariaDB自带了一个新的存储引擎Aria，它可以替代MyISAM，成为默认的事务和非事务引擎。它最初使用XtraDB作为默认存储引擎， 并从10.2版本切换回InnoDB。</li>
<li>它的首席开发人员是米卡埃尔·维德纽斯，他是MySQL AB的创始人之一，也是Monty Program AB的创始人。2008年1月16日，MySQL AB 宣布它已经同意被Sun微系统集团以大约10亿美元的价格收购。该项收购已于2008年2月26日完成。MariaDB是以Monty的小女儿Maria命名的，就像MySQL是以他另一个女儿My命名的一样。</li>
</ul>
<h2>版本</h2>

<p>MariaDB直到5.5版本，均依照MySQL的版本。因此，使用MariaDB5.5的人会从MySQL 5.5中了解到MariaDB的所有功能。</p>
<p>从2012年11月12日起发布的10.0.0版开始，不再依照MySQL的版号。10.0.x版以5.5版为基础，加上移植自MySQL 5.6版的功能和自行开发的新功能</p>
<table>
<thead>
<tr>
<th align="center">版本</th>
<th align="center">原始发布日期</th>
<th align="center">最新版本</th>
<th align="center">发布日期</th>
<th align="center">状态</th>
</tr>
</thead>
<tbody><tr>
<td align="center">5.1</td>
<td align="center">2009年10月29日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-11">11]</a></td>
<td align="center">5.1.67</td>
<td align="center">2013年1月30日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-12">12]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">5.2</td>
<td align="center">2010年4月10日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-13">13]</a></td>
<td align="center">5.2.14</td>
<td align="center">2013年1月30日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-14">14]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">5.3</td>
<td align="center">2011年7月26日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-15">15]</a></td>
<td align="center">5.3.12</td>
<td align="center">2013年1月30日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-16">16]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">5.5</td>
<td align="center">2012年2月25日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-17">17]</a></td>
<td align="center">5.5.68</td>
<td align="center">2020年5月12日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-5.5-18">18]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.0</td>
<td align="center">2012年11月12日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-19">19]</a></td>
<td align="center">10.0.38</td>
<td align="center">2019年1月31日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-20">20]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.1</td>
<td align="center">2014年6月30日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-21">21]</a></td>
<td align="center">10.1.48</td>
<td align="center">2020年11月4日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.1-22">22]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.2</td>
<td align="center">2016年4月18日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-102_initial-23">23]</a></td>
<td align="center">10.2.39</td>
<td align="center">2021年6月23日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.2-24">24]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.3</td>
<td align="center">2017年4月16日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-103_initial-25">25]</a></td>
<td align="center">10.3.30</td>
<td align="center">2021年6月23日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.2-24">24]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.4</td>
<td align="center">2018年11月9日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-104_initial-26">26]</a></td>
<td align="center">10.4.20</td>
<td align="center">2021年6月23日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.2-24">24]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center">10.5</td>
<td align="center">2019年12月3日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-105_initial-27">27]</a></td>
<td align="center">10.5.11</td>
<td align="center">2021年6月23日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.2-24">24]</a></td>
<td align="center">Stable (GA)</td>
</tr>
<tr>
<td align="center"><strong>10.6</strong></td>
<td align="center">2021年4月26日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-106_initial-28">28]</a></td>
<td align="center">10.6.3</td>
<td align="center">2021年7月6日[<a href="https://zh.wikipedia.org/wiki/MariaDB#cite_note-10.6-29">29]</a></td>
<td align="center">Stable (GA)</td>
</tr>
</tbody></table>
<ul>
<li>Percona</li>
<li>Server</li>
<li>OurDelta</li>
</ul>
<h1 id="安装部分"><a href="#安装部分" class="headerlink" title="安装部分"></a>安装部分</h1><p>一、<a href="https://abbott68.github.io/blog/2021/07/18/MySQL%E9%83%A8%E7%BD%B2/#more">源码安装mysql</a><br>二、<a href="https://abbott68.github.io/blog/2021/10/27/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/">二进制安装MySQL</a><br>三、<a href>通过YUM安装MySQL</a></p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL8.0.27版本二进制安装</title>
    <url>/blog/2021/10/27/MySQL%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="MySQL-二进制安装"><a href="#MySQL-二进制安装" class="headerlink" title="MySQL 二进制安装"></a>MySQL 二进制安装</h1><h2 id="一、-获取MySQL软件包"><a href="#一、-获取MySQL软件包" class="headerlink" title="一、 获取MySQL软件包"></a>一、 获取MySQL软件包</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">~]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-8.0&#x2F;mysql-8.0.27-linux-glibc2.17-x86_64-minimal.tar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="二、创建存放位置并解压软件包"><a href="#二、创建存放位置并解压软件包" class="headerlink" title="二、创建存放位置并解压软件包"></a>二、创建存放位置并解压软件包</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql827]# mkdir &#123;data,log&#125;
soft]# tar xf mysql-8.0.27-linux-glibc2.17-x86_64-minimal.tar
[root@docker soft]# mv mysql-8.0.27-linux-glibc2.17-x86_64-minimal  &#x2F;app&#x2F;mysql827
[root@docker soft]# cd &#x2F;app&#x2F;mysql827&#x2F;
[root@docker mysql827]# ls
bin  docs  include  lib  LICENSE  man  README  share  support-files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、修改my-cnf文件-主配置文件"><a href="#三、修改my-cnf文件-主配置文件" class="headerlink" title="三、修改my.cnf文件(主配置文件)"></a>三、修改my.cnf文件(主配置文件)</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker mysql827]# vim &#x2F;etc&#x2F;my.cnf
[mysqld]
# 选择默认存储引擎为InnoDB
default-storage-engine&#x3D;InnoDB
# 用户
user &#x3D; mysql
# 监听端口
port &#x3D; 3306
#socket通信设置
socket&#x3D;&#x2F;tmp&#x2F;mysql.sock
# 安装目录
basedir&#x3D;&#x2F;app&#x2F;mysql827
# 数据文件位置
datadir&#x3D;&#x2F;app&#x2F;mysql827&#x2F;data
# 允许最大连接数 
max_connections&#x3D;512
# 等待关闭连接时间
wait_timeout&#x3D;600
# 服务端字符集
character-set-server&#x3D;utf8mb4
# 错误日志
log-error&#x3D;&#x2F;app&#x2F;mysql827&#x2F;log&#x2F;error.log
# 默认使用“mysql_native_password”插件认证
default_authentication_plugin&#x3D;mysql_native_password
#server-id&#x3D;10
log_bin&#x3D;gh
## 兼容sql_mode
sql_mode&#x3D;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、添加数据库用户及修改权限"><a href="#四、添加数据库用户及修改权限" class="headerlink" title="四、添加数据库用户及修改权限"></a>四、添加数据库用户及修改权限</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker app]# useradd mysql -s &#x2F;sbin&#x2F;nologin
[root@docker app]# chown -R mysql:mysql mysql827&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="五、初始化数据库"><a href="#五、初始化数据库" class="headerlink" title="五、初始化数据库"></a>五、初始化数据库</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker mysql827]# &#x2F;app&#x2F;mysql827&#x2F;bin&#x2F;mysqld --user&#x3D;mysql --basedir&#x3D;&#x2F;app&#x2F;mysql827 --datadir&#x3D;&#x2F;app&#x2F;mysql827&#x2F;data --initialize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>官方推荐：</p>
<p>初始化的时候添加有密码 –initialize （官方推荐） 初始化密码放在error.log日志里</p>
<p>初始化的时候没有密码：–initialize-insecure </p>
</blockquote>
<h2 id="六、拷贝启动文件，方便在控制端启动服务并启动服务"><a href="#六、拷贝启动文件，方便在控制端启动服务并启动服务" class="headerlink" title="六、拷贝启动文件，方便在控制端启动服务并启动服务"></a>六、<strong>拷贝启动文件，方便在控制端启动服务并启动服务</strong></h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker mysql827]# cp &#x2F;app&#x2F;mysql827&#x2F;support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysql 
[root@docker mysql827]# &#x2F;etc&#x2F;init.d&#x2F;mysql start  | stop <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="七、修改环境变量（必须是root权限如果不是root用户您可以使用echo命令）"><a href="#七、修改环境变量（必须是root权限如果不是root用户您可以使用echo命令）" class="headerlink" title="七、修改环境变量（必须是root权限如果不是root用户您可以使用echo命令）"></a>七、修改环境变量（必须是root权限如果不是root用户您可以使用echo命令）</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker mysql827]# vim &#x2F;etc&#x2F;profile
export PATH&#x3D;$PATH:&#x2F;app&#x2F;mysql827&#x2F;bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="八、登陆数据库"><a href="#八、登陆数据库" class="headerlink" title="八、登陆数据库"></a>八、登陆数据库</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker mysql827]# mysql -uroot -p   # 密码error.log（初始密码）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="九、-修改登陆密码"><a href="#九、-修改登陆密码" class="headerlink" title="九、 修改登陆密码"></a>九、 修改登陆密码</h2><pre class="line-numbers language-shel;l" data-language="shel;l"><code class="language-shel;l">mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password by &#39;root123456&#39;;
Query OK, 0 rows affected (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="至此二进制数据库已经搭建完成"><a href="#至此二进制数据库已经搭建完成" class="headerlink" title="至此二进制数据库已经搭建完成"></a>至此二进制数据库已经搭建完成</h2>]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL优化和运维之道</title>
    <url>/blog/2021/10/26/MySQL%E4%BC%98%E5%8C%96%E5%92%8C%E8%BF%90%E7%BB%B4%E4%B9%8B%E9%81%93/</url>
    <content><![CDATA[<h1 id="MySQL-优化和运维之道"><a href="#MySQL-优化和运维之道" class="headerlink" title="MySQL 优化和运维之道"></a>MySQL 优化和运维之道</h1><h2 id="一、-前言"><a href="#一、-前言" class="headerlink" title="一、 前言"></a>一、 前言</h2><ol>
<li>历史</li>
<li>MySQL优点<ul>
<li>使用简单</li>
<li>开源免费</li>
<li>扩展性好，在一定阶段扩展性好</li>
<li>社区活跃</li>
<li>性能可以满足互联网存储和性能需求，离不开硬件的支持</li>
</ul>
</li>
<li>MySQL 存在的问题<ul>
<li>优化器对复杂的SQL支持不好</li>
<li>对SQL标准支持不好</li>
<li>大规模集群方案不成熟，主要指中间件</li>
<li>ID生成器，全局自增ID</li>
<li>异步逻辑复制，数据安全性问题</li>
<li>Online DDL</li>
<li>HA 方案不完全</li>
<li>备份和恢复方案还是比较复杂，需要依赖外部组件</li>
<li>展现给用户的信息过少，排查问题困难</li>
<li>众多分支，让人难以选择</li>
</ul>
</li>
</ol>
<h2 id="二、-数据库开发规范"><a href="#二、-数据库开发规范" class="headerlink" title="二、 数据库开发规范"></a>二、 数据库开发规范</h2><p>数据库开发规范定义：</p>
<ul>
<li><p>开发规范是针对内部开发的一系列建议或规则，由 OBA 制订(如 果有 OBA 的话)。</p>
</li>
<li><p>开发规范本身也包含几部分 : 基本命名 、约束规范、 字段设计规范、索引规范、使用 规范。</p>
</li>
</ul>
<ol>
<li><p>规范存在的意义</p>
<ul>
<li>保证线上数据库scheme 规范；</li>
<li>减少出问题概率；</li>
<li>方便自动化管理；</li>
<li>需要长期坚持规范，这对开发和DBA 来说是双赢；</li>
</ul>
</li>
<li><p>基本命令和约束规范</p>
<ul>
<li>表字符集选择UTF8，如果需要存储 emoj 表情，需要使用 UTF8mb4（MySQL 5.5.3 版本以后支持）；</li>
<li>存储引擎使用InnoDB;</li>
<li>变长字符串尽量使用 varchar 或 varbinary;</li>
<li>不在数据库中存储图片、文件等；</li>
<li>单标数据量控制在1亿以下；</li>
<li>库名、表名、字段名不适用保留字；</li>
<li>库名、表名、字段名、索引名使用小写字母，以下划线分割，需要见名知意；</li>
<li>库表名不要涉及得过长，尽可能用最少的字符表达出表的用途；</li>
</ul>
</li>
<li><p>字段规范</p>
<ul>
<li>所有字段均定义为 NOT NULL, 除非你想的想存 NULL；</li>
<li>字段类型在满足需求条件下越小越好，使用 UNSIGNED 存储非负整数，实际使用时存储负数的场景不多；</li>
<li>使用 TMESTAMP 存储时间；</li>
<li>使用 varchar存储变长字符串，当然要注意 varchar CM ) 里的 M 指的是字符数而不是字节数:使用 UNSIGNED INT 存储 1Pv4 地址而不是 CHAR (15)，这种方式只能存储 1Pv4，存储不了 1Pv6。</li>
<li>使用 DECIMAL存储精确浮点数，用 float 类型可能会存在数据误差；</li>
<li>少用 blob text；</li>
</ul>
<p>关于为什么定义不用NULL 的原因：</p>
<ul>
<li>浪费存储空间，应为 InnoDB 需要额外一个字节来存储；</li>
<li>表内默认值 NULL 过多会影响优化器选择执行计划；</li>
</ul>
</li>
<li><p>索引规范</p>
<ul>
<li>单个索引字段不超过5，单表索引数量不超过5，索引设计遵循 B+Tree 索引最左前缀匹配原则。</li>
<li>选择区分度高的列作为索引；</li>
<li>建立的索引覆盖80% 主要的查询，不求全，解决问题的主要矛盾就好；</li>
<li>DML 要和order by、group by 字段建立合适的索引；</li>
<li>避免索引的隐式转换；</li>
<li>避免冗余索引；</li>
</ul>
</li>
<li><p>SQL 类规范</p>
<ul>
<li>建议尽量不适用存储过程、触发器、函数等，减少维护成本和性能隐患；</li>
<li>避免适用达标的JOIN， MySQL优化器对JOIN 优化策略过于简单；</li>
<li>避免在数据库中进行数据运算和其他大量计算任务；</li>
<li>SQL 合并，主要是DML时 多个value 合并，减少和数据库交互；</li>
<li>合理分页，尤其大分页；</li>
<li>如果 UPDATE、DELETE 语句不是 LIMIT,  在Staement 日志格式下容易造成主从不一致； </li>
</ul>
</li>
</ol>
<h2 id="三、数据库运维规范"><a href="#三、数据库运维规范" class="headerlink" title="三、数据库运维规范"></a>三、数据库运维规范</h2><ol>
<li><p>运维规范主要内容</p>
<ul>
<li>SQL 审核，DDL 审核和操作时间，尤其是 Online DDL；</li>
<li>高危操作检查，DROP前做好数据备份；</li>
<li>权限控制和审计；</li>
<li>日志分析，主要是指的MySQL 慢日志和错误日志；</li>
<li>高可用方案；</li>
<li>数据备份方案</li>
</ul>
</li>
<li><p>版本选择</p>
<ul>
<li>MySQL 社区版，用户群体最大；</li>
<li>MySQL 企业版，收费；</li>
<li>Percona Server 版，新特性多；</li>
<li>MariaDB 版，国内用户不多；</li>
</ul>
</li>
<li><p>Online DDL 问题</p>
<p>原生MySQL执行DDL时需要锁表， 且在锁表期间业务无法写入数据，这对服务影响很大， MySQL 对这方面的支持比较差。大表做 DDL 对 DBA 来说是很痛苦的，相信很多 人都经历过。如何做到 Online DDL，这个问题是不是就无解了呢? 当然不是 !</p>
</li>
<li><p>可用性</p>
<p>关于可用性，我们来分享一种无缝切主库方案，如下图所示。可以用于日常切换，使用思 路也比较简单。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>优化</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL数据库客户端配置prompt参数</title>
    <url>/blog/2021/11/01/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AEprompt%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<p>[mysql]</p>
<p>prompt=\U [\d]&gt;  显示的效果为 <a href="mailto:&#100;&#x65;&#x76;&#49;&#x40;&#49;&#x37;&#50;&#46;&#x31;&#54;&#46;&#53;&#57;&#46;&#49;&#x33;&#51;">&#100;&#x65;&#x76;&#49;&#x40;&#49;&#x37;&#50;&#46;&#x31;&#54;&#46;&#53;&#57;&#46;&#49;&#x33;&#51;</a> [mysql]&gt;</p>
<p>虽然在访问 MySQL 数据库时首选图形客户端，但对于许多用户来说，<em>mysql</em>命令行客户端是连接 MySQL 服务器时的首选。很多时候，当您通过 SSH 访问远程机器时，这是唯一可用的选项。</p>
<p>默认的 mysql 提示很简单：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql &gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>很好很简单，但是如果您打开了多个 mysql 客户端窗口，则可能很难知道哪个窗口连接到哪个用户和数据库。更改显示数据库和用户的提示可以更容易地快速判断哪个窗口连接到哪个客户端和数据库。</p>
<h4 id="更改-mysql-提示"><a href="#更改-mysql-提示" class="headerlink" title="更改 mysql 提示"></a>更改 mysql 提示</h4><blockquote>
<p>要更改提示，请打开您的 MySQL <strong>my.cnf</strong>（或<strong>my.ini，</strong>如果您使用的是 Windows）并在 [mysql] 部分添加以下行。如果该文件没有，请通过添加以下行来创建它。</p>
</blockquote>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">[ mysql ]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在上述行之后添加以下选项。</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">prompt&#x3D;\u@\h: [ \d ]&gt; \_<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>‘\u’ 和 ‘\h’ 分别显示用户名和主机名。’\d’ 显示选择的默认数据库。重启客户端会显示修改后的提示，下面是我机器上的样子。’wordpress’ 是我的默认数据库。</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">codediesel@localhost: [ wordpress ]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果您不想更改<strong>my.ini</strong>文件或无法更改，您还可以如下所示以交互方式更改提示。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">shell &gt; mysql --prompt&#x3D; &quot;\u@\h:[\d]&gt;\_&quot; -uUSERNAME -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下列出prompt参数的完整选项清单：</p>
<h4 id="选项列表"><a href="#选项列表" class="headerlink" title="选项列表"></a>选项列表</h4><p>‘prompt’ 参数支持多种选项，完整列表如下表所示。</p>
<table>
<thead>
<tr>
<th><code>\c</code></th>
<th>为您发出的每个语句递增的计数器</th>
</tr>
</thead>
<tbody><tr>
<td><code>\D</code></td>
<td>完整的当前日期</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>默认数据库</td>
</tr>
<tr>
<td><code>\h</code></td>
<td>服务器主机</td>
</tr>
<tr>
<td><code>\l</code></td>
<td>当前分隔符（5.0.25 中的新增功能）</td>
</tr>
<tr>
<td><code>\m</code></td>
<td>当前时间的分钟</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>换行符</td>
</tr>
<tr>
<td><code>\O</code></td>
<td>三字母格式的当前月份（一月，二月，…）</td>
</tr>
<tr>
<td><code>\o</code></td>
<td>数字格式的当前月份</td>
</tr>
<tr>
<td><code>\P</code></td>
<td>上午下午</td>
</tr>
<tr>
<td><code>\p</code></td>
<td>当前 TCP/IP 端口或套接字文件</td>
</tr>
<tr>
<td><code>\R</code></td>
<td>当前时间，采用 24 小时军用时间 (0–23)</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>当前时间，标准 12 小时制 (1-12)</td>
</tr>
<tr>
<td><code>\S</code></td>
<td>分号</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>当前时间的秒数</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>一个制表符</td>
</tr>
<tr>
<td><code>\U</code></td>
<td>您的完整 user_name@host_name 帐户名称</td>
</tr>
<tr>
<td><code>\u</code></td>
<td>您的用户名</td>
</tr>
<tr>
<td><code>\v</code></td>
<td>服务器版本</td>
</tr>
<tr>
<td><code>\w</code></td>
<td>以三字母格式表示的当前日期（周一、周二、…）</td>
</tr>
<tr>
<td><code>\Y</code></td>
<td>当前年份，四位数</td>
</tr>
<tr>
<td><code>\y</code></td>
<td>当前年份，两位数</td>
</tr>
<tr>
<td><code>\_</code></td>
<td>空间</td>
</tr>
<tr>
<td><code>\</code></td>
<td>一个空格（反斜杠后面有一个空格）</td>
</tr>
<tr>
<td><code>\&#39;</code></td>
<td>单引号</td>
</tr>
<tr>
<td><code>\&quot;</code></td>
<td>双引号</td>
</tr>
<tr>
<td><code>\\</code></td>
<td>文字“ <code>\</code>”反斜杠字符</td>
</tr>
<tr>
<td><code>\*</code>x<code>*</code></td>
<td>x，对于上面未列出的任何“x”</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL部署（源码编译）</title>
    <url>/blog/2021/07/18/MySQL%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p><font size="5" color="green">MySQL8.0.25 源码编译部署</font></p>
<span id="more"></span>
<h1 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h1><ul>
<li>centos 8.3</li>
<li>数据库版本：MySQL-8.0.25</li>
<li>gcc版本：<ul>
<li>7系列系统默认GCC版本低不支持安装MySQL8以上版本的数据，需要升级GCC版本，</li>
<li>8系列版本的系统不需要升级GCC</li>
<li>如果需要如何升级 <a href>点这</a></li>
</ul>
</li>
</ul>
<h2 id="安装cmake工具"><a href="#安装cmake工具" class="headerlink" title="安装cmake工具"></a>安装cmake工具</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql-8.0.25]# dnf -y install cmake3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="源码编译"><a href="#源码编译" class="headerlink" title="源码编译"></a>源码编译</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql-8.0.25]# cmake . \
-DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F; \
-DDEFAULT_CHARSET&#x3D;utf8 \
-DDEFAULT_COLLATION&#x3D;utf8_general_ci \
-DENABLED_LOCAL_INFILE&#x3D;ON \
-DWITH_INNODB_MEMCACHED&#x3D;ON \
-DWITH_SSL&#x3D;system \
-DWITH_INNOBASE_STORAGE_ENGINE&#x3D;1 \
-DWITH_FEDERATED_STORAGE_ENGINE&#x3D;1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE&#x3D;1 \
-DWITH_ARCHIVE_STORAGE_ENGINE&#x3D;1 \
-DWITHOUT_EXAMPLE_STORAGE_ENGINE&#x3D;1 \
-DWITH_PERFSCHEMA_STORAGE_ENGINE&#x3D;1 \
-DCOMPILATION_COMMENT&#x3D;&quot;zsd edition&quot; \
-DWITH_BOOST&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql-8.0.25&#x2F;boost&#x2F;boost_1_73_0&#x2F; \
-DMYSQL_UNIX_ADDR&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;3306&#x2F;mysql.sock \
-DSYSCONFDIR&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;3306  \
-DFORCE_INSOURCE_BUILD&#x3D;1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><font size="4" color="red">报错:</font></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">一、警告不要在源码中构建
CMake Error at CMakeLists.txt:382 (MESSAGE):
  Please do not build in-source.  Out-of source builds are highly
  recommended: you can have multiple builds for the same source, and there is
  an easy way to do cleanup, simply remove the build directory (note that
  &#39;make clean&#39; or &#39;make distclean&#39; does *not* work)
  You *can* force in-source build by invoking cmake with
  -DFORCE_INSOURCE_BUILD&#x3D;1
二、缺少依赖
①  CMake Error at cmake&#x2F;ssl.cmake:61 (MESSAGE):
  PleaseCMake Error at cmake&#x2F;readline.cmake:71 (MESSAGE):
②  Curses library not found.  Please install appropriate package, install the appropriate openssl developer package.
remove CMakeCache.txt and rerun cmake.On Debian&#x2F;Ubuntu, package name is libncurses5-dev, on Redhat and derivates it is ncurses-devel.
③ CMake Warning at cmake&#x2F;rpc.cmake:40 (MESSAGE):
  Cannot find RPC development libraries.  You need to install the required
  packages:

    Debian&#x2F;Ubuntu:              apt install libtirpc-dev
    RedHat&#x2F;Fedora&#x2F;Oracle Linux: yum install libtirpc-devel
    SuSE:                       zypper install glibc-devel
三、依赖<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>安装依赖：</p>
<p>注意： rpcgen源没有需下载</p>
<p><a href="https://centos.pkgs.org/8/centos-powertools-x86_64/">下载地址</a></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql-8.0.25]# dnf -y install openssl-devel
[root@test mysql-8.0.25]# dnf -y install ncurses-devel
[root@test mysql-8.0.25]# rm -rf CMakeCache.txt
[root@test mysql-8.0.25]# yum -y install libtirpc-devel
[root@test mysql-8.0.25]# wget http:&#x2F;&#x2F;mirror.centos.org&#x2F;centos&#x2F;8&#x2F;PowerTools&#x2F;aarch64&#x2F;os&#x2F;Packages&#x2F;rpcgen-1.3.1-4.el8.aarch64.rpm
[root@test mysql-8.0.25]# dnf --enablerepo&#x3D;powertools install rpcgen<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再次构建：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql-8.0.25]# cmake . \
-DCMAKE_INSTALL_PREFIX&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F; \
-DDEFAULT_CHARSET&#x3D;utf8 \
-DDEFAULT_COLLATION&#x3D;utf8_general_ci \
-DENABLED_LOCAL_INFILE&#x3D;ON \
-DWITH_INNODB_MEMCACHED&#x3D;ON \
-DWITH_SSL&#x3D;system \
-DWITH_INNOBASE_STORAGE_ENGINE&#x3D;1 \
-DWITH_FEDERATED_STORAGE_ENGINE&#x3D;1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE&#x3D;1 \
-DWITH_ARCHIVE_STORAGE_ENGINE&#x3D;1 \
-DWITHOUT_EXAMPLE_STORAGE_ENGINE&#x3D;1 \
-DWITH_PERFSCHEMA_STORAGE_ENGINE&#x3D;1 \
-DCOMPILATION_COMMENT&#x3D;&quot;zsd edition&quot; \
-DWITH_BOOST&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;mysql-8.0.25&#x2F;boost&#x2F;boost_1_73_0&#x2F; \
-DMYSQL_UNIX_ADDR&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;3306&#x2F;mysql.sock \
-DSYSCONFDIR&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;3306 \
-DFORCE_INSOURCE_BUILD&#x3D;1
[root@test mysql-8.0.25]# make -j4
[root@test mysql-8.0.25]# make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="配置用户"><a href="#配置用户" class="headerlink" title="配置用户"></a>配置用户</h2><p>创建MySQL用户和用户组</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# groupadd mysql
[root@test mysql]# useradd  -r -g mysql  -s &#x2F;bin&#x2F;false mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="初始化数据目录"><a href="#初始化数据目录" class="headerlink" title="初始化数据目录"></a>初始化数据目录</h2><p>① 修改目录权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# chown -R mysql .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>② 初始化数据目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# bin&#x2F;mysqld --initialize --user&#x3D;mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>通过<code>mysqld</code>初始化<code>data</code>目录时，如果使用<code>--initialize</code>选项，则会为<code>&#39;root&#39;@&#39;localhost&#39;</code>用户创建一个随机密码。该密码会打印在控制台，如下所示行中末尾就是临时密码：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">2021-07-18T13:02:48.598005Z 0 [System] [MY-013169] [Server] &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysqld (mysqld 8.0.25) initializing of server in progress as process 87376
2021-07-18T13:02:48.621612Z 0 [Warning] [MY-013242] [Server] --character-set-server: &#39;utf8&#39; is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.
2021-07-18T13:02:48.621622Z 0 [Warning] [MY-013244] [Server] --collation-server: &#39;utf8_general_ci&#39; is a collation of the deprecated character set UTF8MB3. Please consider using UTF8MB4 with an appropriate collation instead.
2021-07-18T13:02:48.632207Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2021-07-18T13:02:49.645548Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2021-07-18T13:02:51.981723Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: e2%TeUjfTg0N<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>复制启动脚本、启动</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# cp support-files&#x2F;mysql.server &#x2F;etc&#x2F;init.d&#x2F;mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动失败（报错）</p>
<p><font size="4" color="red">原因：启动时候没有找到对应3306目录</font></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# &#x2F;etc&#x2F;init.d&#x2F;mysqld start
Starting MySQL.Logging to &#39;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;data&#x2F;test.err&#39;.
2021-07-18T15:13:37.356447Z mysqld_safe Directory &#39;&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;3306&#39; for UNIX socket file don&#39;t exists.
The server quit without updating PID file (&#x2F;usr&#x2F;local&#x2F;mysql[失败]test.pid).<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# mkdir 3306
[root@test mysql]# chown mysql:mysql 3306&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>重新启动：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# bin&#x2F;mysqld_safe --user&#x3D;mysql &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>MySQL命令软连接到/usr/local/bin/mysql用户可以方便使用MySQL命令</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test bin]# ln  -s &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;mysql &#x2F;usr&#x2F;local&#x2F;bin&#x2F;mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>登陆数据库：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@test mysql]# bin&#x2F;mysql -uroot -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.25

Copyright (c) 2000, 2021, Oracle and&#x2F;or its affiliates.

Oracle is a registered trademark of Oracle Corporation and&#x2F;or its
affiliates. Other names may be trademarks of their respective
owners.
mysql&gt; show databases;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><font size="3" color="red">ERROR报错:{需要重置密码}</font></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysql&gt; alter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password by &#39;123456&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>NFS文件共享</title>
    <url>/blog/2022/04/01/NFS%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/</url>
    <content><![CDATA[<h1 id="NFS-文件共享"><a href="#NFS-文件共享" class="headerlink" title="NFS 文件共享"></a>NFS 文件共享</h1><hr>
<h2 id="NFS介绍"><a href="#NFS介绍" class="headerlink" title="NFS介绍"></a><strong>NFS介绍</strong></h2><ul>
<li>NFS（Network File System，网络文件系统）是当前主流异构平台共享文件系统之一。主要应用在UNIX环境下。最早是由Sun Microsystems开发，现在能够支持在不同类型的系统之间通过网络进行文件共享，广泛应用在FreeBSD、SCO、Solaris等异构操作系统平台，允许一个系统在网络上与他人共享目录和文件。通过使用NFS，用户和程序可以像访问本地文件一样访问远端系统上的文件，使得每个计算机的节点能够像使用本地资源一样方便地使用网上资源。换言之，NFS可用于不同类型计算机、操作系统、网络架构和传输协议运行环境中的网络文件远程访问和共享。</li>
<li>网络文件系统（<a href="https://baike.baidu.com/item/NFS/812203">NFS</a>）从1984 年问世以来持续演变，并已成为<a href="https://baike.baidu.com/item/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/1250388">分布式文件系统</a>的基础;</li>
</ul>
<p><img src="/images/NFS.jpg" class="lazyload placeholder" data-srcset="/images/NFS.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="NFS"></p>
<h2 id="NFS-实现原理"><a href="#NFS-实现原理" class="headerlink" title="NFS 实现原理"></a>NFS 实现原理</h2><p>NFS服务器启动后，都会开启对客户端连接对应的端口号，端口号的范围是1~1024，但每次启动NFS服务器，相应服务器端口号都各不相同。为了确保客户端每次都能正确的连接到NFS服务器上，NFS通过一个远程过程调用（Remote  Procedure Call ,RPC ）的协议来协助NFS 服务器完成连接，程序可以通过使用这种协议向网络中另一台计算机上的程序请求服务，在NFS中，RPC最主要的功能就是指定并监听NFS守护进程对应的端口号，并将端口信息通知给客户端，让客户端可以连接到正确端口上来，因此也可以说，NFS是一个RPC服务器。需要注意的是，远程挂载NFS服务器的本地主机也需要同步启动RPC协议。</p>
<p>要使用NFS服务器，需要在NFS服务端至少启用两个系统守护进程（daemons）,分别是rpc.nfsd 和rpc.mountd。</p>
<h2 id="NFS-服务搭建"><a href="#NFS-服务搭建" class="headerlink" title="NFS 服务搭建"></a><strong>NFS 服务搭建</strong></h2><ul>
<li><p>安装NFS软件包</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@nfs ~]# yum -y install nfs-uils rpcbind<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>创建共享目录，并设置足够的权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@nfs ~]# mkdir  &#x2F;opt&#x2F;nfsfile
[root@nfs ~]# chmod -Rf 777 &#x2F;opt&#x2F;nfsfile&#x2F;
[root@nfs ~]# echo &quot;welcome to linux&quot; &gt; &#x2F;opt&#x2F;nfsfile&#x2F;README<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>修改NFS主配置文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@nfs ~]# vim &#x2F;etc&#x2F;exports
&#x2F;opt&#x2F;nfsfile 172.16.59.*(rw,sync,roo_squash)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>共享资源路径：就是要共享出来的目录或者磁盘分区。</p>
<p>主机地址：设置允许使用NFS服务器共享资源的客户端主机地址，主机地址可以是主机名、域名、IP地址等，支持匹配</p>
<p>选项：下面是各个选项的含义。</p>
<ul>
<li>ro: 既 read only也就是客户端主机对共享咨询仅有读权限。</li>
<li>rw: 即 read  write， 也就是可短短主机对共享资源有读、写权限。</li>
<li>no_root_squash: 信任客户端，根据用户UID进行判断，如果登陆NFS主机的用户是ROOT，那么次用就拥有对共享资源的最高权限。此参数不安全，建议不要使用。</li>
<li>root_squash: 不管登陆NFS主机的是什么用户，都会将共享文件的UID和GID 隐射到匿名用户 nfsnobody.</li>
<li>no_all_squash: 系统预设值，保留共享文件的UID和GID默认权限。</li>
<li>anonuid: 将登入NFS主机的用户都设定成指定的UID，此UID必须在于NFS服务端/etc/passwd中。</li>
<li>anongid: 与anonuid 含义类似，但是编程GIDle，即用户组ID 。</li>
<li>sync：资料同步写入磁盘中，默认选择</li>
<li>aync: 资料会先暂时存放在内存中，不会直接写入硬盘。</li>
</ul>
</blockquote>
</li>
<li><p>启动服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@nfs ~]# systemctl start nfs rpcbind
[root@nfs ~]# systemctl enable nfs rpcbind<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h2><p> Linux客户端</p>
<p>  发现服务器上共享信息</p>
  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@promethues ~]# showmount -e 172.16.59.191
Export list for 172.16.59.191:
&#x2F;opt&#x2F;nfsfile 172.16.59.196<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>挂载并使用</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@promethues ~]# mount 172.16.59.191:&#x2F;opt&#x2F;nfsfile &#x2F;opt&#x2F;nfs191&#x2F;
[root@promethues ~]# df -h
文件系统                    容量  已用  可用 已用% 挂载点
172.16.59.191:&#x2F;opt&#x2F;nfsfile   18G  1.7G   17G   10% &#x2F;opt&#x2F;nfs191
[root@promethues ~]# cd &#x2F;opt&#x2F;nfs191&#x2F;
[root@promethues nfs191]# ls
README
[root@promethues nfs191]# touch  abc
[root@promethues nfs191]# ll
总用量 4
-rw-r--r--. 1 root root  0 3月  30 22:56 abc
-rw-r--r--. 1 root root 17 3月  30 22:22 README<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>windows 客户端</p>
<blockquote>
<p>打开 控制面板 —&gt; 程序 —&gt; 启用或关闭Windows功能 </p>
<p>或者</p>
<p>也可以用【Win+R】运行，复制输入以下命令：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">OptionalFeatures<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<img src="/Users/abbott/Library/Application Support/typora-user-images/image-20220330231532283.png" class="lazyload placeholder" data-srcset="/Users/abbott/Library/Application Support/typora-user-images/image-20220330231532283.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330231532283" style="zoom:50%;">

<blockquote>
<p>mount IP:/nfsroot X:    (IP为NFS服务器得IP，/nfsroot为你挂载得目录路径)</p>
</blockquote>
<img src="~/work list/blog/source/images/g" class="lazyload placeholder" data-srcset="~/work list/blog/source/images/g" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20220330234439410" style="zoom:50%;">]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>文件共享</tag>
      </tags>
  </entry>
  <entry>
    <title>PSSH</title>
    <url>/blog/2021/07/16/PSSH/</url>
    <content><![CDATA[<p><img src="https://www.abbreviations.com/images/1396650_pssh.png" class="lazyload placeholder" data-srcset="https://www.abbreviations.com/images/1396650_pssh.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<span id="more"></span>
<h1 id="批量管理服务器PSSH"><a href="#批量管理服务器PSSH" class="headerlink" title="批量管理服务器PSSH"></a>批量管理服务器PSSH</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>PSSH提供OpenSSH和相关工具的并行版本。包括pssh，pscp，prsync，pnuke和pslurp。该项目包括psshlib，可以在自定义应用程序中使用。 pssh是python编写，可以并发在多台机器上批量执行命令的工具，用法可以媲美ansible的一些简单用法，执行起来速度比ansible快，支持文件并行复制，远程命令。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装之前首先获取epel源</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># wget -O &#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;epel-7.repo
# yum repolist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>安装pssh</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># yum -y install pssh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="功能："><a href="#功能：" class="headerlink" title="功能："></a>功能：</h3><ul>
<li>pssh 在多个主机上并行运行命令</li>
<li>pscp 把文件并行复制到多个主机上</li>
<li>prsync 通过rsync协议把文件高效并行复制到多个主机上</li>
<li>pslurp 把文件并行地从多个远程主机复制到中心主机上</li>
<li>pnuke 并行地在多个远程主机上杀死进程</li>
</ul>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h5 id="PSSH示例及验证："><a href="#PSSH示例及验证：" class="headerlink" title="PSSH示例及验证："></a>PSSH示例及验证：</h5><hr>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pssh -h hosts.txt -l irb2 -o &#x2F;tmp&#x2F;foo uptime
pssh -h hosts.txt &quot;hostnamectl&quot;   hosts 主机IP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>选项解释：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">--version     版本显示程序的版本号和退出
--help        显示帮助信息          
-h HOST_FILE, 主机文件列表 格式[user@]host[:port]
-l USER       用户名 (OPTIONAL)
-p PAR，--par &#x3D; PAR并行线程的最大数量（可选）
-o OUTDIR， --outdir &#x3D; OUTDIR 标准输出文件的输出目录（可选）
-e ERRDIR， --errdir &#x3D; ERRDIR  stderr文件的输出目录（可选）
-t TIMEOUT，--timeout &#x3D;超时  每个主机的超时时间（秒）（0 &#x3D;无超时）（可选）
-O OPTION， --option &#x3D; OPTION   SSH选项（可选）
-v，--verbose  打开警告和诊断消息（可选）
-A，-askpass   要求输入密码（可选）
-x ARGS，--extra-args &#x3D; ARGS 额外的命令行参数，处理空格，引号和反斜杠
-X ARG， --extra-arg &#x3D; ARG  额外的命令行参数
-i，--inline  每个服务器的内联内联聚合输出和错误
--inline-stdout 每个服务器的内联标准输出
-I，--send-input 从标准输入读取并作为输入发送到ssh
-P，--print 打印输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="实验："><a href="#实验：" class="headerlink" title="实验："></a>实验：</h3><p>1.在控制端主机上建立一个主机文件hosts.txt</p>
<pre class="line-numbers language-none"><code class="language-none"># cat hosts.txt
172.16.127.161
172.16.127.131<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2.实现远程控制获取被控主机IP地址</p>
<pre class="line-numbers language-none"><code class="language-none"># pssh -h hosts.txt  -i &#39;ip addr show| grep ens33&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果没有报错的话，应该输出类似实验下面的</p>
<pre class="line-numbers language-none"><code class="language-none">[1] 22:42:03 [SUCCESS] 172.16.127.131
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    inet 172.16.127.131&#x2F;24 brd 172.16.127.255 scope global noprefixroute dynamic ens33
[2] 22:42:03 [SUCCESS] 172.16.127.161
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    inet 172.16.127.161&#x2F;24 brd 172.16.127.255 scope global noprefixroute dynamic ens33<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果有以下错误</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[1] 22:40:24 [FAILURE] 172.16.127.131 Exited with error code 255
Stderr: The authenticity of host &#39;172.16.127.131 (172.16.127.131)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:TikjI&#x2F;UUYTvpaoAt&#x2F;CsGWH5Tjj&#x2F;tlSRIMUFHwjydpBY.
ECDSA key fingerprint is MD5:03:f9:94:2d:8b:a7:16:1b:a4:91:e4:9b:d6:1b:0d:4d.
Are you sure you want to continue connecting (yes&#x2F;no)?
Host key verification failed.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>原因是因为不能远程连接被控主机上，所以我们需要做免密认证，</p>
<pre class="line-numbers language-none"><code class="language-none"># ssh-keygen  创建私钥和公钥
# ssh-copy-id 把公钥copy给每台被控主机<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="pscp-示例及验证："><a href="#pscp-示例及验证：" class="headerlink" title="pscp 示例及验证："></a>pscp 示例及验证：</h5><hr>
<h3 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h3><ul>
<li>把文件并行复制到多个主机上</li>
</ul>
<h3 id="实验：-1"><a href="#实验：-1" class="headerlink" title="实验："></a>实验：</h3><p>1.创建一个测试文件text.txt</p>
<pre class="line-numbers language-none"><code class="language-none"># echo &quot;nihao&quot; &gt; text.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2.远程将主机文件复制到被控端主机上</p>
<pre class="line-numbers language-none"><code class="language-none"># pscp.pssh -h hosts.txt text.txt &#x2F;opt&#x2F;text.txt
[1] 23:02:17 [SUCCESS] 172.16.127.161
[2] 23:02:18 [SUCCESS] 172.16.127.131<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="prsync-示例："><a href="#prsync-示例：" class="headerlink" title="prsync 示例："></a>prsync 示例：</h4><hr>
<p>作用：</p>
<ul>
<li>通过rsync协议协议将文件或目录从本地主机同步到远程多个主机上</li>
</ul>
<h4 id="pnuke-示例及验证："><a href="#pnuke-示例及验证：" class="headerlink" title="pnuke 示例及验证："></a>pnuke 示例及验证：</h4><hr>
<p>作用：</p>
<ul>
<li>并行地在多个远程主机上杀死进程</li>
</ul>
<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p>杀死进程</p>
<ul>
<li>安装Apache</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># pssh -h hosts.txt -i &quot;yum -y install httpd&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>开启Apache web服务</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># pssh -h hosts.txt -i &quot;systemctl start httpd&quot;
[1] 00:32:33 [SUCCESS] 172.16.127.131
[2] 00:32:33 [SUCCESS] 172.16.127.161<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>查看进程(验证)</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># pssh -h hosts.txt -i &quot;lsof -i:80&quot;
[1] 00:36:46 [SUCCESS] 172.16.127.161
COMMAND   PID   USER   FD   TYPE DEVICE SIZE&#x2F;OFF NODE NAME
httpd   11710   root    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
httpd   11711 apache    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
httpd   11712 apache    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
httpd   11713 apache    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
httpd   11714 apache    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
httpd   11715 apache    4u  IPv6  37706      0t0  TCP *:http (LISTEN)
[2] 00:36:46 [SUCCESS] 172.16.127.131
COMMAND  PID   USER   FD   TYPE DEVICE SIZE&#x2F;OFF NODE NAME
httpd   9307   root    4u  IPv6  34309      0t0  TCP *:http (LISTEN)
httpd   9308 apache    4u  IPv6  34309      0t0  TCP *:http (LISTEN)
httpd   9309 apache    4u  IPv6  34309      0t0  TCP *:http (LISTEN)
httpd   9310 apache    4u  IPv6  34309      0t0  TCP *:http (LISTEN)
httpd   9312 apache    4u  IPv6  34309      0t0  TCP *:http (LISTEN)
httpd   9313 apache    4u  IPv6  34309      0t0  TCP *:http (LISTEN)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>杀死进程</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># pnuke -h hosts.txt httpd
[1] 00:38:39 [SUCCESS] 172.16.127.131
[2] 00:38:39 [SUCCESS] 172.16.127.161<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>查看进程(验证)</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none"># pssh -h hosts.txt -i &quot;lsof -i:80&quot;
[1] 00:39:55 [FAILURE] 172.16.127.161 Exited with error code 1
[2] 00:39:55 [FAILURE] 172.16.127.131 Exited with error code 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>







<p>三台  关闭firewalld</p>
]]></content>
      <categories>
        <category>自动化</category>
      </categories>
      <tags>
        <tag>自动化</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx</title>
    <url>/blog/2021/07/16/Nginx/</url>
    <content><![CDATA[<p>Nginx 初始</p>
<span id="more"></span>
<p><img src="https://www.linuxadictos.com/wp-content/uploads/nginx-1.jpg" class="lazyload placeholder" data-srcset="https://www.linuxadictos.com/wp-content/uploads/nginx-1.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
<h2 id="nginx是什么"><a href="#nginx是什么" class="headerlink" title="nginx是什么"></a>nginx是什么</h2><p>&#160; &#160; &#160;我们在学习Nginx时也采用同样的方式,先来看看Nginx的竞争对手——Apache、Lighttpd、Tomcat、Jetty、IIS,它们都是Web服务器,或者叫做WWW(World Wide Web)服务器,相应地也都具备Web服务器的基本功能:基于REST架构风格 [1] ,以统一资源描述符(Uniform Resource Identifier,URI)或者统一资源定位符(Uniform Resource Locator,URL)作为沟通依据,通过HTTP为浏览器等客户端程序提供各种网络服务。<br>&#160; &#160; &#160;Tomcat和Jetty面向Java语言,先天就是重量级的Web服务器,它的性能与Nginx没有可比性。</p>
<h2 id="apache的特点"><a href="#apache的特点" class="headerlink" title="apache的特点"></a>apache的特点</h2><p>&#160; &#160; &#160;Apache有许多优点,如稳定、开源、跨平台等,但它出现的时间太长了,在它兴起的年代,互联网的产业规模远远比不上今天,所以它被设计成了一个重量级的、不支持高并发的Web服务器。</p>
<h2 id="为什么选择Nginx"><a href="#为什么选择Nginx" class="headerlink" title="为什么选择Nginx"></a>为什么选择Nginx</h2><ul>
<li>更快<br>这表现在两个方面:一方面,在正常情况下,单次请求会得到更快的响应;另一方面,在高峰期(如有数以万计的并发请求),Nginx可以比其他Web服务器更快地响应请求；</li>
<li>高扩展性<br>Nginx的设计极具扩展性,它完全是由多个不同功能、不同层次、不同类型且耦合度极低的模块组成；</li>
<li>高可靠性<br>高可靠性是我们选择Nginx的最基本条件,因为Nginx的可靠性是大家有目共睹的,很多家高流量网站都在核心服务器上大规模使用Nginx；</li>
<li>低内存消耗<br>一般情况下,10000个非活跃的HTTP Keep-Alive连接在Nginx中仅消耗2.5MB的内存,这是Nginx支持高并发连接的基础；</li>
<li>单机支持10万以上的并发连接<br>这是一个非常重要的特性!随着互联网的迅猛发展和互联网用户数量的成倍增长,各大公司、网站都需要应付海量并发请求,一个能够在峰值期顶住10万以上并发请求的Server,无疑会得到大家的青睐；</li>
<li>热部署<br>master管理进程与worker工作进程的分离设计,使得Nginx能够提供热部署功能,即可以在7×24小时不间断服务的前提下,升级Nginx的可执行文件；</li>
<li>最自由的BSD许可协议<br>这是Nginx可以快速发展的强大动力。BSD许可协议不只是允许用户免费使用Nginx,它还允许用户在自己的项目中直接使用或修改Nginx源码,然后发布；</li>
<li>Apache拥有丰富的模块组件支持，稳定性强，BUG少，动态内容处理强。</li>
<li>Nginx轻量级，占用资源少，负载均衡，高并发处理强，静态内容处理高效</li>
</ul>
<h2 id="部署Nginx服务"><a href="#部署Nginx服务" class="headerlink" title="部署Nginx服务"></a>部署Nginx服务</h2><h4 id="官网获取软件包"><a href="#官网获取软件包" class="headerlink" title="官网获取软件包"></a>官网获取软件包</h4><p>下载<a href="http://nginx.org/en/download.html">适合您</a>的版本<br>以下是做测试用的版本</p>
<pre class="line-numbers language-none"><code class="language-none"># wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.15.5.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果您的主机上没有wget命令请安装<br>Centos RedHat 版本:</p>
<pre class="line-numbers language-none"><code class="language-none"># sudo yum -y install wget<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ubuntu Depin系列:</p>
<pre class="line-numbers language-none"><code class="language-none"># sudo apt install wget<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h4><pre class="line-numbers language-none"><code class="language-none"># mkdir &#x2F;usr&#x2F;local&#x2F;nginx
# mv nginx-1.15.5.tar.gz  &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;
# cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;
# tar xf nginx-1.15.5.tar.gz
# cd nginx-1.15.5
# yum -y install gcc gcc-c++ pcre-devel   zlib-devel
# .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;
# make &amp;&amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>选项</p>
<pre class="line-numbers language-none"><code class="language-none">nginx -s stop|quit|raload|reopen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>解释</p>
<blockquote>
<p>   stop — fast shutdown  &#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; &#160; &#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; &#160;# 快速关机<br>   quit — graceful shutdown    &#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; &#160;#  优雅关机<br>    reload — reloading the configuration file  &#160; &#160; # 重新加载配置文件<br>    reopen — reopening the log files &#160; &#160; &#160;&#160; &#160; &#160;&#160; &#160; # 重新代开日志文件</p>
</blockquote>
<h4 id="查看服务-默认是80端口"><a href="#查看服务-默认是80端口" class="headerlink" title="查看服务:默认是80端口"></a><font color="#A52A2A">查看服务:默认是80端口</font></h4><pre class="line-numbers language-none"><code class="language-none">ps -ax | grep nginx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="搭建虚拟主机"><a href="#搭建虚拟主机" class="headerlink" title="搭建虚拟主机"></a><font color="#A52A2A">搭建虚拟主机</font></h2><h4 id="创建虚拟主机配置文件"><a href="#创建虚拟主机配置文件" class="headerlink" title="创建虚拟主机配置文件"></a>创建虚拟主机配置文件</h4><pre class="line-numbers language-none"><code class="language-none"># mkdir &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html&#x2F;&#123;gtxi,gtjb&#125;
# echo &quot;gongtongxuexi.com&quot; &gt; &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html&#x2F;gtxi&#x2F;index.html
# echo &quot;gongtongjinbu.com&quot; &gt; &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;html&#x2F;gtjb&#x2F;index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="编辑配置文件："><a href="#编辑配置文件：" class="headerlink" title="编辑配置文件："></a>编辑配置文件：</h4><p>配置文件所在位置 /usr/local/nginx/conf/nginx.conf<br>在配置文件定义虚拟主机加入:</p>
<pre class="line-numbers language-none"><code class="language-none">server &#123;
    listen       8080;
   # listen       somename:8080;
    server_name  www.gongtongxuexi.com;
    location &#x2F; &#123;
        root   html&#x2F;gtxi;
        index  index.html index.htm;
    &#125;
   &#125;
server &#123;
    listen       8081;
   # listen       somename:8080;
    server_name  www.gongtongjinbu.com;

    location &#x2F; &#123;
        root   html&#x2F;gtjb;
        index  index.html index.htm;
    &#125;
   &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="重新加载配置文件："><a href="#重新加载配置文件：" class="headerlink" title="重新加载配置文件："></a>重新加载配置文件：</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s raload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="验证："><a href="#验证：" class="headerlink" title="验证："></a>验证：</h4><p>打开浏览器访问 http//iP地址   </p>
<h4 id="配置文件解释："><a href="#配置文件解释：" class="headerlink" title="配置文件解释："></a>配置文件解释：</h4><pre class="line-numbers language-none"><code class="language-none">keepalive_timeout  65;          # 设置连接超时时间
# 使用server定义虚拟主机
  server &#123;
    listen       80;            # 监听端口
    server_name  localhost;     # 访问域名

    #charset koi8-r;            # 编码格式

    # 设置虚拟主机的访问日志
    #access_log  logs&#x2F;host.access.log  main;  

    # 对URL进行匹配
    location &#x2F; &#123;
    # 设置网页根路径
        root   html;
    # 先找html文件，如果没有则htm
        index  index.html index.htm;
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> HTTPS server<br> <pre class="line-numbers language-none"><code class="language-none">#
#server &#123;
#    listen       443 ssl;         监听端口
#    server_name  localhost;       访问域名
	指定证书文件，使用相对路径证书需要在与Nginx.conf同目录下
#    ssl_certificate      cert.pem;
#    ssl_certificate_key  cert.key;
		指定会话缓存
#    ssl_session_cache    shared:SSL:1m;
#    ssl_session_timeout  5m;

#    ssl_ciphers  HIGH:!aNULL:!MD5;
#    ssl_prefer_server_ciphers  on;

#    location &#x2F; &#123;
#        root   html;
#        index  index.html index.htm;
#    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h3 id="网站的错误代码："><a href="#网站的错误代码：" class="headerlink" title="网站的错误代码："></a><font color="#A52A2A">网站的错误代码：</font></h3><blockquote>
<p>1xx: 代表提示信息<br>  2xx: 代表成功信息<br>  3xx: 代表重定向<br>  4xx：代表客户端错误信息<br>  5xx: 代表服务器错误信息</p>
</blockquote>
<h2 id="Nginx实现反向代理"><a href="#Nginx实现反向代理" class="headerlink" title="Nginx实现反向代理"></a><font color="#A52A2A">Nginx实现反向代理</font></h2><h3 id="代理服务器"><a href="#代理服务器" class="headerlink" title="代理服务器"></a>代理服务器</h3><p>1、什么是代理服务器<br>代理服务器，客户机在发送请求时，不会直接发送给目的主机，而是先发送给代理服务器，代理服务接受客户机请求之后，再向主机发出，并接收目的主机返回的数据，存放在代理服务器的硬盘中，再发送给客户机。<br>2、为什么要使用代理服务器<br>1）提高访问速度<br>由于目标主机返回的数据会存放在代理服务器的硬盘中，因此下一次客户再访问相同的站点数据时，会直接从代理服务器的硬盘中读取，起到了缓存的作用，尤其对于热门站点能明显提高请求速度。<br>2）防火墙作用<br>    由于所有的客户机请求都必须通过代理服务器访问远程站点，因此可在代理服务器上设限，过滤某些不安全信息。<br>3）通过代理服务器访问不能访问的目标站点<br>    互联网上有许多开发的代理服务器，客户机在访问受限时，可通过不受限的代理服务器访问目标站点，通俗说，我们使用的翻墙浏览器就是利用了代理服务器，虽然不能出国，但也可直接访问外网。</p>
<h3 id="反向代理-VS-正向代理"><a href="#反向代理-VS-正向代理" class="headerlink" title="反向代理 VS 正向代理"></a>反向代理 VS 正向代理</h3><p>1、什么是正向代理？什么是反向代理？</p>
<p>   正向代理，架设在客户机与目标主机之间，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中。</p>
<p>  反向代理服务器架设在服务器端，通过缓冲经常被请求的页面来缓解服务器的工作量，将客户机请求转发给内部网络上的目标服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器与目标主机一起对外表现为一个服务器。</p>
<p>2、反向代理有哪些主要应用？</p>
<p>现在许多大型web网站都用到反向代理。除了可以防止外网对内网服务器的恶性攻击、缓存以减少服务器的压力和访问安全控制之外，还可以进行负载均衡，将用户请求分配给多个服务器。</p>
<pre class="line-numbers language-none"><code class="language-none"> upstream web1.com&#123;
           server 192.168.122.206;
   &#125;
 upstream web2.com&#123;
           server 192.168.122.84;
   &#125;

server &#123;
    listen       80;
  # listen       someme:8080;
   server_name www.web1.com;
location &#x2F; &#123;
      proxy_pass  http:&#x2F;&#x2F;web1.com;
      index  index.html index.htm;
    &#125;
  &#125;

 server &#123;
     listen       80;
   # listen       somename:8080;
     server_name  www.web2.com;

  location &#x2F; &#123;
     proxy_pass   http:&#x2F;&#x2F;web2.com;
     index  index.html index.htm;
      &#125;
   &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>web服务</category>
      </categories>
      <tags>
        <tag>Web</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonValueError</title>
    <url>/blog/2021/12/13/PythonValueError/</url>
    <content><![CDATA[<h1 id="ValueError-not-enough-values-to-unpack-expected-2-got-1"><a href="#ValueError-not-enough-values-to-unpack-expected-2-got-1" class="headerlink" title="ValueError: not enough values to unpack (expected 2, got 1)"></a>ValueError: not enough values to unpack (expected 2, got 1)</h1><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span> x<span class="token punctuation">,</span>y <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter a two value:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
Enter a two value<span class="token punctuation">:</span><span class="token number">10</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"&lt;stdin>"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
ValueError<span class="token punctuation">:</span> <span class="token keyword">not</span> enough values to unpack <span class="token punctuation">(</span>expected <span class="token number">2</span><span class="token punctuation">,</span> got <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>原因是：输入的值不是期望的值，输入的俩个值的不能换行</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x<span class="token punctuation">,</span>y <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"Enter a two value:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
Enter a two value<span class="token punctuation">:</span><span class="token number">10</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python 语言</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 函数</title>
    <url>/blog/2021/10/24/Python%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h1 id="Python-函数"><a href="#Python-函数" class="headerlink" title="Python 函数"></a>Python 函数</h1><p>函数是组织好的，可重复使用的，用来实现单一，或相关联功能的代码段。<br>函数能提高应用的模块性，和代码的重复利用率。我们已经知道Python提供了许多内建函数，比如<code>print()</code>。但我们也可以自己创建函数，这被叫做用户自定义函数。</p>
<h2 id="定义一个函数"><a href="#定义一个函数" class="headerlink" title="定义一个函数"></a>定义一个函数</h2><p>我们可以定义一个由自己想要功能的函数，以下是简单的规则：</p>
<ul>
<li>函数代码块以<code>def</code>关键词开头，后接<code>函数标识符名称</code>和<code>圆括号()</code>。</li>
<li>任何传入参数和自变量必须放在圆括号中间。圆括号之间可以用于<code>定义参数</code>。</li>
<li>函数的<code>第一行语句</code>可以选择性地使用文档字符串—用于存放<code>函数说明</code>。</li>
<li>函数内容以<code>冒号</code>起始，并且缩进。</li>
<li><code>Return[expression]</code>结束函数，选择性地返回一个值给调用方。不带表达式的return相当于返回 <code>None</code>。</li>
</ul>
<h2 id="函数基本定义"><a href="#函数基本定义" class="headerlink" title="函数基本定义"></a>函数基本定义</h2><p>函数（Function）指通过专门的代码组织，用来实现特定功能代码段，具有相对独立性，可供其他代码重复调用。</p>
<ol>
<li><p>函数定义基本语法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">def</span> 函数名<span class="token punctuation">(</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
    函数体
    <span class="token keyword">return</span> <span class="token punctuation">[</span>返回值<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>def  关键字</p>
<p>函数体： 函数体为实现函数功能的相关代码段。</p>
<p>返回值： return 语句后面空一格，跟需要返回的</p>
</blockquote>
</li>
</ol>
<p>定义一个函数只给了函数一个名称，指定了函数里包含的参数，和代码块结构。</p>
<p>这个函数的基本结构完成以后，你可以通过另一个函数调用执行，也可以直接从Python提示符执行。</p>
<p>Python里不用像C语言里需要先申明函数再使用。</p>
<p>如下实例调用了<code>printme()</code>函数：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>
<span class="token comment">#定义函数</span>
<span class="token keyword">def</span> <span class="token function">printme</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>

printme<span class="token punctuation">(</span><span class="token string">"我要调用用户自定义函数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
printme<span class="token punctuation">(</span><span class="token string">"在次调用同一函数！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>以下是调用函数时可使用的正式参数类型：</p>
<ul>
<li>必选参数：<code>fun(name, age)</code></li>
<li>默认参数：<code>fun(name=&#39;yjc&#39;, age=18)</code></li>
<li>可变参数：<code>fun(*args)</code></li>
<li>关键字参数：<code>fun(name, age, **kw)</code></li>
<li>命名关键字参数：<code>fun(name, age, *, city)</code></li>
</ul>
<h5 id="1-必须参数"><a href="#1-必须参数" class="headerlink" title="1. 必须参数"></a>1. 必须参数</h5><p>必选参数也称<strong>位置参数</strong>。必选参数须以正确的顺序传入函数。调用时的数量必须和声明时的一样。<br>调用<code>printme()</code>函数，你必须传入一个参数，不然会出现语法错误：</p>
<pre class="line-numbers language-PYTHON" data-language="PYTHON"><code class="language-PYTHON">#!&#x2F;usr&#x2F;bin&#x2F;python3
#定义函数
def printme(str):
    print(str)
    return;
printme()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出 结果：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"/Users/abbott/work list/pyproject/pydome/函数/def1.py"</span><span class="token punctuation">,</span> line <span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">></span>
    printme<span class="token punctuation">(</span><span class="token punctuation">)</span>
TypeError<span class="token punctuation">:</span> printme<span class="token punctuation">(</span><span class="token punctuation">)</span> missing <span class="token number">1</span> required positional argument<span class="token punctuation">:</span> '<span class="token builtin">str</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="2-默认参数"><a href="#2-默认参数" class="headerlink" title="2. 默认参数"></a>2. 默认参数</h5><p>调用函数时，默认参数的值如果没有传入，则被认为是默认值。下例会打印默认的age，如果age没有被传入：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">printinfo</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span>

<span class="token comment">#调用函数</span>
printinfo<span class="token punctuation">(</span><span class="token string">"abbott"</span><span class="token punctuation">)</span>
printinfo<span class="token punctuation">(</span><span class="token string">"abott"</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment"># 当不按顺序提供部分默认参数时，需要把参数名写上</span>
printinfo<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"abbott"</span><span class="token punctuation">,</span>age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">name abbott
age <span class="token number">35</span>
name abott
age <span class="token number">50</span>
name abbott
age <span class="token number">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="3-可变参数"><a href="#3-可变参数" class="headerlink" title="3. 可变参数"></a>3. 可变参数</h5><p>在Python函数中，还可以定义可变参数。顾名思义，可变参数就是传入的参数个数是可变的，可以是1个、2个到任意个，还可以是0个。基本语法如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">functionname</span><span class="token punctuation">(</span><span class="token operator">*</span>var_args_tuple<span class="token punctuation">)</span><span class="token punctuation">:</span>
    function_suite
    <span class="token keyword">return</span><span class="token punctuation">[</span>expression<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>加*号的变量名会存放所有未命名的变量参数。如以下实例：</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token operator">*</span>numbers<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span> 
    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers<span class="token punctuation">:</span>
        <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token builtin">sum</span>  <span class="token operator">+</span> n <span class="token operator">*</span> n 
    <span class="token keyword">return</span> <span class="token builtin">sum</span> 

r <span class="token operator">=</span> calc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-none"><code class="language-none">5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python 语言</tag>
      </tags>
  </entry>
  <entry>
    <title>Python初始</title>
    <url>/blog/2021/10/24/Python%E5%88%9D%E5%A7%8B/</url>
    <content><![CDATA[<h1 id="Python-编程语言"><a href="#Python-编程语言" class="headerlink" title="Python 编程语言"></a>Python 编程语言</h1><p>Python 是一种高级、通用且非常流行的编程语言。Python 编程语言（最新的 Python 3）正被用于 Web 开发、机器学习应用程序以及软件行业的所有尖端技术。Python 编程语言非常适合初学者，也适合使用 C++ 和 Java 等其他编程语言的有经验的程序员。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>以下是关于Python编程语言的应用领域</p>
<ol>
<li>Python 是目前使用最广泛的多用途、高级编程语言。</li>
<li>Python 允许在面向对象和过程范式中进行编程。</li>
<li>Python 程序通常比 Java 等其他编程语言小。程序员必须相对较少的类型和语言的缩进要求，使它们始终可读。</li>
<li>几乎所有的科技巨头都在使用 Python 语言，比如谷歌、亚马逊、Facebook、Instagram、Dropbox、优步等。</li>
<li>Python 的最大优势是庞大的标准库集合，可用于以下方面：<ul>
<li><a href="https://www.geeksforgeeks.org/machine-learning/">机器学习</a></li>
<li>GUI 应用程序（如<a href="https://www.geeksforgeeks.org/kivy-tutorial/">Kivy</a>、Tkinter、PyQt 等）</li>
<li><a href="https://www.geeksforgeeks.org/django-tutorial/">Django</a>等网络框架（YouTube、Instagram、Dropbox 使用）</li>
<li>图像处理（如<a href="https://www.geeksforgeeks.org/opencv-python-tutorial/">OpenCV</a>、Pillow）</li>
<li>网页抓取（如 Scrapy、BeautifulSoup、Selenium）</li>
<li>测试框架</li>
<li>多媒体</li>
<li>科学计算</li>
<li>文本处理等等..</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python 语言</tag>
      </tags>
  </entry>
  <entry>
    <title>Python基础</title>
    <url>/blog/2021/12/13/Python%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="1-1-Python-语言介绍"><a href="#1-1-Python-语言介绍" class="headerlink" title="1.1    Python 语言介绍"></a>1.1    Python 语言介绍</h1><p><a href="https://www.geeksforgeeks.org/python-programming-language/">Python</a>是一种广泛使用的通用高级编程语言。它由 Guido van Rossum 于 1991 年创建，并由 Python 软件基金会进一步开发。它的设计强调代码的可读性，其语法允许程序员用更少的代码行表达他们的概念。</p>
<p>Python 是一种编程语言，可让您快速工作并更有效地集成系统。</p>
<h1 id="1-2-Python-语言优势"><a href="#1-2-Python-语言优势" class="headerlink" title="1.2.     Python 语言优势"></a>1.2.     Python 语言优势</h1><p>Python 是一种高级、解释性和通用的动态编程语言，专注于代码可读性。与 Java 和 C 相比，它的步骤更少。它由开发人员 Guido Van Rossum 于 1991 年创立。Python 是世界上最受欢迎和发展最快的语言之一。Python 是一种功能强大、灵活且易于使用的语言。此外，那里的社区非常活跃。它在许多组织中使用，因为它支持多种编程范式。它还执行自动内存管理。</p>
<p><strong>好处 ：</strong></p>
<blockquote>
<ol>
<li>第三方模块的存在 </li>
<li>广泛的支持库（用于数值计算的 NumPy、用于数据分析的 Pandas 等） </li>
<li>开源和社区发展 </li>
<li>用途广泛，易于阅读、学习和编写</li>
<li>用户友好的数据结构 </li>
<li>高级语言 </li>
<li>动态类型语言（无需提及基于赋值的数据类型，它需要数据类型） </li>
<li>面向对象语言 </li>
<li>便携和交互</li>
<li>原型的理想选择——以更少的编码提供更多的功能</li>
<li>高效（Python 简洁的面向对象设计提供了增强的过程控制，并且该语言配备了出色的文本处理和集成能力，以及自己的单元测试框架，使其更加高效。）</li>
<li>(IoT)物联网机遇</li>
<li>口译语言</li>
<li>跨操作系统可移植 </li>
</ol>
</blockquote>
<p><strong>应用：</strong></p>
<blockquote>
<ol>
<li>基于 GUI 的桌面应用程序</li>
<li>平面设计、图像处理应用程序、游戏和科学/计算应用程序</li>
<li>Web 框架和应用程序 </li>
<li> 企业和商业应用 </li>
<li> 操作系统 </li>
<li>教育</li>
<li>数据库访问</li>
<li>语言发展 </li>
<li> 原型制作 </li>
<li>软件开发</li>
</ol>
</blockquote>
<p><strong>使用Python的组织：</strong></p>
<blockquote>
<ol>
<li>谷歌（谷歌蜘蛛和搜索引擎的组件） </li>
<li>雅虎（地图） </li>
<li>YouTube </li>
<li>Mozilla </li>
<li>保管箱 </li>
<li>微软 </li>
<li>思科 </li>
<li>Spotify </li>
<li>知乎</li>
</ol>
</blockquote>
<h1 id="1-3-下载并安装-Python-3-最新版本"><a href="#1-3-下载并安装-Python-3-最新版本" class="headerlink" title="1.3  下载并安装 Python 3 最新版本"></a>1.3  下载并安装 Python 3 最新版本</h1><p>如何下载和安装 Python 3 最新版本？在本文中，您将获得与在 Windows/Linux/macOS 上安装 Python 相关的所有问题的答案。Python 是由 Guido van Rossum 于 1990 年代初期开发的，其最新版本是 3.9，我们可以简称为 Python3。</p>
<p>要了解如何安装 Python，您需要知道<em>Python 是什么</em>以及它实际安装在系统中的位置。</p>
<h3 id="1-4-Python3基础知识"><a href="#1-4-Python3基础知识" class="headerlink" title="1.4    Python3基础知识"></a>1.4    Python3基础知识</h3><p><a href="https://www.geeksforgeeks.org/python-tutorial-learn-python-3-with-examples/">Python</a>是由 Guido van Rossum 于 1990 年代初期开发的，其最新版本是 3.7.1，我们可以简称为 Python3。Python 3.0 于 2008 年发布。它是解释性语言，即它没有被编译，解释器将逐行检查代码。这篇文章可以用来学习非常基础的<a href="https://www.geeksforgeeks.org/python-programming-language/">Python 编程语言</a>。</p>
<p>所以在继续之前……让我们做最流行的“HelloWorld，因此将 Python 的语法与 C、C++、Java 进行比较（我选择了这 3 种语言，因为它们是最著名和最常用的语言)。</p>
<h4 id="1-4-1-介绍与设置"><a href="#1-4-1-介绍与设置" class="headerlink" title="1.4.1    介绍与设置"></a>1.4.1    介绍与设置</h4><p><strong>1 、Windows 平台</strong></p>
<p>如果您使用的是<strong>Windows 操作系统</strong>，请<a href="https://www.python.org/downloads/windows/">单击此处</a>下载 Python，然后从设置中安装并在开始菜单中输入 IDLE.IDLE，您可以将其视为 Python 的 IDE 来运行 Python 脚本。</p>
<p>它会以某种方式看起来像这样：</p>
<p><img src="https://media.geeksforgeeks.org/wp-content/uploads/Python_console.png" class="lazyload placeholder" data-srcset="https://media.geeksforgeeks.org/wp-content/uploads/Python_console.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="灯箱"></p>
<p><strong>2、 Linux/Unix 平台</strong></p>
<p>如果您使用的是<strong>类似 Linux/Unix 的系统，</strong>只需打开终端，并且在 99% 的 linux 操作系统上，Python 预装了操作系统。只需在终端中输入“python3”，您就可以开始使用了。<br>它看起来像这样：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">]# python3
Python 3.6.8 (default, Aug 24 2020, 17:57:11) 
[GCC 8.3.1 20191121 (Red Hat 8.3.1-5)] on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="1-5-变量和数据结构"><a href="#1-5-变量和数据结构" class="headerlink" title="1.5    变量和数据结构"></a>1.5    变量和数据结构</h3><p>在 C、C++ 和 Java 等其他编程语言中，您需要声明变量的类型，但在 Python 中则不需要这样做。只需输入变量，当将给它值时，它就会自动知道给定的值是 int、float、char 还是 String。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&gt;&gt;&gt; myNuber &#x3D; 3
&gt;&gt;&gt; print(myNuber)
3
&gt;&gt;&gt; myNuber2 &#x3D; 4.5
&gt;&gt;&gt; print(myNuber2)
4.5
&gt;&gt;&gt; myNuber3 &#x3D; &quot;hell world&quot;
&gt;&gt;&gt; print(myNuber3)
hell world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>看，它有多简单，只需创建一个变量并为其分配任何您想要的值，然后使用打印功能将其打印出来。Python 有 4 种类型的内置数据结构，即<strong>List</strong>、<strong>Dictionary</strong>、<strong>Tuple</strong>和 <strong>Set</strong>。</p>
</blockquote>
<p>**列表:**是python中最基本的数据结构。列表是一种可变数据结构，即可以在创建列表后将项目添加到中。这就像您要去当地市场购物并列出一些商品，然后您可以将越来越多的商品添加到列表中。<br>append() 函数用于向列表中添加数据。</p>
<pre><code class="python">&gt;&gt;&gt; nums = []
&gt;&gt;&gt; nums.append(21)
&gt;&gt;&gt; nums.append(40.5)
&gt;&gt;&gt; nums.append(&quot;String&quot;)
&gt;&gt;&gt; print(nums)
[21, 40.5, &#39;String&#39;]
</code></pre>
]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python 语言</tag>
      </tags>
  </entry>
  <entry>
    <title>Zabbix分布式监控</title>
    <url>/blog/2021/12/04/Zabbix%E5%88%86%E5%B8%83%E5%BC%8F%E7%9B%91%E6%8E%A7/</url>
    <content><![CDATA[<h1 id="Zabbix简介"><a href="#Zabbix简介" class="headerlink" title="Zabbix简介"></a>Zabbix简介</h1><hr>
<p>Zabbix 由 Alexei Vladishev 创建，目前由其成立的公司—— Zabbix SIA 积极的持续开发更新维护， 并为用户提供技术支持服务。</p>
<p>Zabbix 是一个企业级分布式开源监控解决方案。</p>
<p>Zabbix 软件能够监控众多网络参数和服务器的健康度、完整性。Zabbix 使用灵活的告警机制，允许用户为几乎任何事件配置基于邮件的告警。这样用户可以快速响应服务器问题。Zabbix 基于存储的数据提供出色的报表和数据可视化功能。这些功能使得 Zabbix 成为容量规划的理想选择。</p>
<p>Zabbix 支持主动轮询（polling）和被动捕获（trapping）。Zabbix所有的报表、统计数据和配置参数都可以通过基于 Web 的前端页面进行访问。基于 Web 的前端页面确保您可以在任何地方访问您监控的网络状态和服务器健康状况。适当的配置后，Zabbix 可以在监控 IT 基础设施方面发挥重要作用。无论是对于有少量服务器的小型组织，还是拥有大量服务器的大企业而言，同样适用。</p>
<p>Zabbix 是免费的。Zabbix 是根据 GPL 通用公共许可证的第二版编写和发布的。这意味着产品源代码是免费发布的，可供公共使用。</p>
<h1 id="Zabbix架构"><a href="#Zabbix架构" class="headerlink" title="Zabbix架构"></a><strong>Zabbix架构</strong></h1><hr>
<p>Zabbix的通用架构是Client/Server架构，分布式架构为Client/Proxy/Server或Client/Node/Server,Zabbix-Server将采集到的数据持久地存储在数据中，用前端UI友好展示给用户。</p>
<p><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2371460695,4125660326&fm=26&gp=0.jpg" class="lazyload placeholder" data-srcset="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2371460695,4125660326&fm=26&gp=0.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="点击查看源网页"></p>
<h1 id="Zabbix-的功能特性"><a href="#Zabbix-的功能特性" class="headerlink" title="Zabbix 的功能特性"></a>Zabbix 的功能特性</h1><hr>
<p>zabbix有常见的商业监控软件所具备的功能，如主机的性能监控、网络设备、性能监控、数据库监控、FTP等通用协议监控、多种告警方式、详细的报表图表绘制、分布式、可扩展能力、API等。</p>
<p>Zabbix 是一个高度成熟完善的网络监控解决方案，一个的软件包中包含了多种功能。</p>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/items">数据采集</a></strong></p>
<ul>
<li>可用性和性能检查；</li>
<li>支持 SNMP（包括主动轮询和被动捕获）、IPMI、JMX、VMware 监控；</li>
<li>自定义检查；</li>
<li>按照自定义的时间间隔采集需要的数据；</li>
<li>通过 Server/Proxy 和 Agents 来执行数据采集。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/triggers">灵活的阈值定义</a></strong></p>
<ul>
<li>您可以参考后端数据库定义非常灵活的告警阈值，即触发器</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/notifications">高度可配置化的告警</a></strong></p>
<ul>
<li>可以根据递增计划、接收者、媒介类型自定义发送告警通知；</li>
<li>使用宏变量可以使告警通知变得更加高效有用；</li>
<li>自动操作包含远程执行命令。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/visualization/graphs/simple">实时图形</a></strong></p>
<ul>
<li>使用内置图形功能可以将监控项实时绘制成图形。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/web_monitoring">Web 监控功能</a></strong></p>
<ul>
<li>Zabbix可以追踪模拟鼠标在 Web 网站上的点击操作，来检查 Web 网站的功能和响应时间。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/visualization">丰富的可视化选项</a></strong></p>
<ul>
<li>可以组合多个监控项到单个视图中，创建自定义图表；</li>
<li>网络拓扑图；</li>
<li>以仪表盘样式展示自定义聚合图形和幻灯片演示；</li>
<li>报表；</li>
<li>监控资源的更高层次展示视图（业务视图）。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/installation/requirements#database_size">历史数据存储</a></strong></p>
<ul>
<li>存储在数据库中的数据；</li>
<li>历史配置；</li>
<li>内置数据管理机制（housekeeping）。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/hosts">配置简单</a></strong></p>
<ul>
<li>将被监控设备添加为主机；</li>
<li>主机一旦添加到数据库中，就会采集数据用于监控；</li>
<li>将模板用于监控设备。</li>
</ul>
<p><strong>使用<a href="https://www.zabbix.com/documentation/4.0/manual/config/templates">模板</a></strong></p>
<ul>
<li>模板中分组检查；</li>
<li>模板可以关联模板，继承已关联模板的属性。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/discovery">网络发现</a></strong></p>
<ul>
<li>自动发现网络设备；</li>
<li>Zabbix Agent 发现设备后自动注册；</li>
<li>自动发现文件系统、网络接口和 SNMP OIDs 值。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/web_interface">快捷的 Web 界面</a></strong></p>
<ul>
<li>基于 PHP 的 Web 前端；</li>
<li>可以从任何地方访问；</li>
<li>您可以定制自己的操作方式；</li>
<li>您可以通过审计日志来查看你的操作。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/api">Zabbix API</a></strong></p>
<ul>
<li>Zabbix API 为 Zabbix 提供可编程接口，用于批量操作、第三方软件集成和其他用途。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/config/users_and_usergroups">权限管理系统</a></strong></p>
<ul>
<li>安全的用户身份验证；</li>
<li>指定的用户只能查看指定的权限范围内的视图。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/concepts/agent">功能强大且易于扩展的 Zabbix Agent</a></strong></p>
<ul>
<li>部署于被监控对象上；</li>
<li>支持 Linux 和 Windows ；</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/concepts/server">二进制守护进程</a></strong></p>
<ul>
<li>为了更好的性能和更少的内存占用，采用 C 语言编写；</li>
<li>便于移植。</li>
</ul>
<p><strong><a href="https://www.zabbix.com/documentation/4.0/manual/distributed_monitoring">适应更复杂的环境</a></strong></p>
<ul>
<li>使用 Zabbix Proxy 代理，可以轻松实现分布式远程监控。</li>
</ul>
]]></content>
      <categories>
        <category>监控系统</category>
      </categories>
      <tags>
        <tag>Zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>c语言初始</title>
    <url>/blog/2021/10/24/c%E8%AF%AD%E8%A8%80%E5%88%9D%E5%A7%8B/</url>
    <content><![CDATA[<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p><strong>C</strong>是一种通用的<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80">编程语言</a>，广泛用于<a href="https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6">系统软件</a>与<a href="https://zh.wikipedia.org/wiki/%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6">应用软件</a>的开发。于1969年至1973年间，为了移植与开发<a href="https://zh.wikipedia.org/wiki/UNIX">UNIX</a><a href="https://zh.wikipedia.org/wiki/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1">操作系统</a>，由<a href="https://zh.wikipedia.org/wiki/%E4%B8%B9%E5%B0%BC%E6%96%AF%C2%B7%E9%87%8C%E5%A5%87">丹尼斯·里奇</a>与<a href="https://zh.wikipedia.org/wiki/%E8%82%AF%C2%B7%E6%B1%A4%E6%99%AE%E9%80%8A">肯·汤普逊</a>，以<a href="https://zh.wikipedia.org/wiki/B%E8%AF%AD%E8%A8%80">B语言</a>为基础，在<a href="https://zh.wikipedia.org/wiki/%E8%B4%9D%E5%B0%94%E5%AE%9E%E9%AA%8C%E5%AE%A4">贝尔实验室</a>设计、开发出来。</p>
<p>C语言具有高效、灵活、功能丰富、表达力强和较高的<a href="https://zh.wikipedia.org/wiki/%E7%A7%BB%E6%A4%8D_(%E8%BB%9F%E9%AB%94)">可移植性</a>等特点，在<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">程序设计</a>中备受青睐，成为最近25年使用最为广泛的编程语言[<a href="https://zh.wikipedia.org/wiki/C%E8%AF%AD%E8%A8%80#cite_note-AutoTX-3-2">2]</a>。目前，C语言<a href="https://zh.wikipedia.org/wiki/%E7%B7%A8%E8%AD%AF%E5%99%A8">编译器</a>普遍存在于各种不同的<a href="https://zh.wikipedia.org/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>中，例如<a href="https://zh.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows</a>、<a href="https://zh.wikipedia.org/wiki/Mac_OS_X">macOS</a>、<a href="https://zh.wikipedia.org/wiki/Linux">Linux</a>、<a href="https://zh.wikipedia.org/wiki/Unix">Unix</a>等。C语言的设计影响了众多后来的编程语言，例如<a href="https://zh.wikipedia.org/wiki/C%2B%2B">C++</a>、<a href="https://zh.wikipedia.org/wiki/Objective-C">Objective-C</a>、<a href="https://zh.wikipedia.org/wiki/Java">Java</a>、<a href="https://zh.wikipedia.org/wiki/C%E2%99%AF">C#</a>等。</p>
<p>二十世纪八十年代，为了避免各开发厂商用的C语言的语法产生差异，由<a href="https://zh.wikipedia.org/wiki/%E7%BE%8E%E5%9C%8B%E5%9C%8B%E5%AE%B6%E6%A8%99%E6%BA%96%E5%B1%80">美国国家标准局</a>为C语言订定了一套完整的国际标准语法，称为<a href="https://zh.wikipedia.org/wiki/ANSI_C">ANSI C</a>，作为C语言的标准。二十世纪八十年代至今的有关程序开发工具，一般都支持符合<a href="https://zh.wikipedia.org/wiki/ANSI_C">ANSI C</a>的语法。</p>
<h3 id="K-amp-R-C"><a href="#K-amp-R-C" class="headerlink" title="K&amp;R C"></a>K&amp;R C</h3><p>1978年，丹尼斯·里奇(Dennis Ritchie)和布莱恩·科尔尼干(Brian Kernighan)出版了一本书，名叫《The C Programming Language》（中文译名为《C程序设计语言》）。这本书被C语言开发者们称为“K&amp;R”，很多年来被当作C语言的非正式的标准说明。人们称这个版本的C语言为“K&amp;R C”。</p>
<p>1988年丹尼斯·里奇(Dennis Ritchie)和布莱恩·科尔尼干(Brian Kernighan)修改此书，出版了《The C Programming Language》第二版，第二版涵盖了ANSI C语言标准。第二版从此成为大学计算机教育有关C语言的经典教材，多年后也没再出现过更好的版本。</p>
<h3 id="ANSI-C-和-ISO-C"><a href="#ANSI-C-和-ISO-C" class="headerlink" title="ANSI C 和 ISO C"></a>ANSI C 和 ISO C</h3><p>1970到80年代，C语言被广泛应用，从大型主机到小型微机，也衍生了C语言的很多不同版本。</p>
<p>为统一C语言版本，1983年美国国家标准局（American National Standards Institute，简称ANSI）成立了一个委员会，来制定C语言标准。1989年C语言标准被批准，被称为ANSI X3.159-1989 “Programming Language C”。这个版本的C语言标准通常被称为ANSI C。又由于这个版本是 89 年完成制定的，因此也被称为 C89。</p>
<p>后来 ANSI 把这个标准提交到 ISO（国际化标准组织），1990年被 ISO 采纳为国际标准，称为 ISO C。又因为这个版本是1990年发布的，因此也被称为C90。</p>
<p>ANSI C(C89) 与 ISO C(C90)内容基本相同，主要是格式组织不一样。</p>
<p>因为 ANSI 与 ISO 的C标准内容基本相同，所以对于C标准，可以称为ANSI C，也可以说是ISO C，或者 ANSI / ISO C。</p>
<p>注意：以后大家看到 ANSI C、ISO C、C89、C90，要知道这些标准的内容都是一样的。</p>
<p>目前，几乎所有的开发工具都支持 ANSI / ISO C 标准。是C语言用得最广泛的一个标准版本。</p>
<h3 id="C99"><a href="#C99" class="headerlink" title="C99"></a>C99</h3><p>在ANSI C标准确立之后，C语言的规范在很长一段时间内都没有大的变动。1995年C程序设计语言工作组对 C语言进行了一些修改，成为后来的1999年发布的 ISO/IEC 9899:1999标准，通常被成为C99。</p>
<p>但是各个公司对C99的支持所表现出来的兴趣不同。当GCC和其它一些商业编译器支持C99的大部分特性的時候，微软和Borland却似乎对此不感兴趣。</p>
<p>说明：GCC（GNU Compiler Collection，GNU编译器集合）是一套由GNU工程开发的支持多种编程语言的编译器。</p>
<p><font size="3" color="red">综上所述，目前广泛使用的C语言版本是 ANSI / ISO C，最经典的C语言教材是《C程序设计语言(The C Programming Language) 第二版》</font></p>
<p><img src="http://c.biancheng.net/cpp/uploads/allimg/150301/1-15030119511M02.png" class="lazyload placeholder" data-srcset="http://c.biancheng.net/cpp/uploads/allimg/150301/1-15030119511M02.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></p>
<h2 id><a href="#" class="headerlink" title></a></h2>]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>C语言</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL部署（Yum安装)</title>
    <url>/blog/2021/12/09/install.mysql/</url>
    <content><![CDATA[<h1 id="Yum源安装-MySQL"><a href="#Yum源安装-MySQL" class="headerlink" title="Yum源安装 MySQL"></a>Yum源安装 MySQL</h1><span id="more"></span>
<h4 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h4><ul>
<li><p>Redhat6/CentOS6版本</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-server ~]# yum -y install mysql mysql-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>Redhat7/CentOS7版本以上</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-server ~]# yum -y install mariadb mariadb-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>启动数据库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-server ~]# systemctl start mariadb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h4 id="源码编译安装"><a href="#源码编译安装" class="headerlink" title="源码编译安装"></a>源码编译安装</h4><h4 id="登陆数据库"><a href="#登陆数据库" class="headerlink" title="登陆数据库"></a>登陆数据库</h4><ul>
<li>默认MySQL数据库是没有密码</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web-server &#x2F;]# mysql 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 2
Server version: 5.5.68-MariaDB MariaDB Server

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>为了数据库的安装我们需要初始化以及设置密码</p>
</blockquote>
<ul>
<li><p>初始化数据库</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web-server &#x2F;]# mysql_secure_installation<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>初始化完成再次登陆   (需要 用户+ 密码 )</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@web-server &#x2F;]# mysql -uroot -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 11
Server version: 5.5.68-MariaDB MariaDB Server

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="连接数据库方式"><a href="#连接数据库方式" class="headerlink" title="连接数据库方式"></a>连接数据库方式</h4>]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>kubernetes1.23版 重置</title>
    <url>/blog/2021/12/25/kubernetes1.23%E7%89%88%E6%9C%AC%E9%87%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="kubernetes-重置"><a href="#kubernetes-重置" class="headerlink" title="kubernetes 重置"></a>kubernetes 重置</h1><ul>
<li>为什么需要初始化</li>
</ul>
<blockquote>
<p>是因为flannel 网络插件需要在初始化的时候需要指定 –pod-network-cidr 10.244.0.0/167</p>
<p>如果不指定可以使用CrashLoopBackOff 这一种状态</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kube-system   kube-flannel-ds-5tjjw                0&#x2F;1     CrashLoopBackOff    69 (2m19s ago)   16h
kube-system   kube-flannel-ds-9lq64                0&#x2F;1     CrashLoopBackOff    61 (2m45s ago)   16h
kube-system   kube-flannel-ds-mrhdn                0&#x2F;1     CrashLoopBackOff    57 (2m14s ago)   16h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>一、 重置master</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">## 移出node
kubectl drain k8s-node01 --delete-emptydir-data --force --ignore-daemonsets
kubectl drain k8s-node02 --delete-emptydir-data --force --ignore-daemonsets
##查看node 
kubectl get node -A
##重置master
kubeadm reset
##清除iptables规则
iptables -F &amp;&amp; iptables -t nat -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X

## 重新初始化kubernetes
kubeadm init --pod-network-cidr 10.244.0.0&#x2F;16
mkdir -p $HOME&#x2F;.kube
cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config
chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config
export KUBECONFIG&#x3D;&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>二、 重置node(所有node节点)</p>
<blockquote>
<p>加入节点报错</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-node01 ~]# kubeadm join 172.18.252.35:6443 --token mt5lr5.z6yr8vkcowsqazqf   --discovery-token-ca-cert-hash sha256:1c0dbef451646a3bebe880242d785a503e74f5644f0b789d81750b765208ea2f 
[preflight] Running pre-flight checks
error execution phase preflight: [preflight] Some fatal errors occurred:
	[ERROR FileAvailable--etc-kubernetes-kubelet.conf]: &#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf already exists
	[ERROR FileAvailable--etc-kubernetes-bootstrap-kubelet.conf]: &#x2F;etc&#x2F;kubernetes&#x2F;bootstrap-kubelet.conf already exists
	[ERROR Port-10250]: Port 10250 is in use
	[ERROR FileAvailable--etc-kubernetes-pki-ca.crt]: &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt already exists
[preflight] If you know what you are doing, you can make a check non-fatal with &#96;--ignore-preflight-errors&#x3D;...&#96;
To see the stack trace of this error execute with --v&#x3D;5 or higher<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要重置node节点…执行以下的⬇️再次加入节点</p>
</blockquote>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-node01 ~]# kubeadm reset
[root@k8s-node01 ~]# kubeadm join 172.18.252.35:6443 --token mt5lr5.z6yr8vkcowsqazqf \
&gt;   --discovery-token-ca-cert-hash sha256:1c0dbef451646a3bebe880242d785a503e74f5644f0b789d81750b765208ea2f <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>三、查看是否加入</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master ~]# kubectl get nodes -A
NAME         STATUS   ROLES                  AGE   VERSION
k8s-master   Ready    control-plane,master   18h   v1.23.0
k8s-node01   Ready    &lt;none&gt;                 22m   v1.23.0
k8s-node02   Ready    &lt;none&gt;                 22m   v1.23.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>kubernetes系列</category>
      </categories>
      <tags>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>kubernetes构建efk日志系统</title>
    <url>/blog/2021/12/21/kubernetes%E6%9E%84%E5%BB%BAefk%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/</url>
    <content><![CDATA[<h1 id="kubernetes-1-23集群-构建efk-日志系统"><a href="#kubernetes-1-23集群-构建efk-日志系统" class="headerlink" title="kubernetes-1.23集群 构建efk 日志系统"></a>kubernetes-1.23集群 构建efk 日志系统</h1><h2 id="一、EFK-简介"><a href="#一、EFK-简介" class="headerlink" title="一、EFK 简介"></a>一、EFK 简介</h2><p><strong>ElasticSearch：分布式存储检索引擎，用来搜索、存储日志</strong></p>
<p><strong>Fluentd：日志采集</strong></p>
<p><strong>Kibana：读取es中数据进行可视化web界面展示</strong></p>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><p>1、 创建namespace 空间</p>
<ul>
<li><p>创建yaml文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat create-logging-namespace.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> logging
 <span class="token key atrule">labels</span><span class="token punctuation">:</span>
   <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> logging
   <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
   <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建logging空间</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl create -f create-logging-namespace.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>2、 创建es</p>
<ul>
<li><p>创建es-service.yaml文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat es-service.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
    <span class="token key atrule">kubernetes.io/name</span><span class="token punctuation">:</span> <span class="token string">"Elasticsearch"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> db
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9200</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9200</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> transport
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9300</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9300</span>
  <span class="token key atrule">publishNotReadyAddresses</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建es-statefulset.yaml 文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat es-statefulset.yaml </span>
<span class="token comment"># BAC authn and authz</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">""</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"services"</span>
      <span class="token punctuation">-</span> <span class="token string">"namespaces"</span>
      <span class="token punctuation">-</span> <span class="token string">"endpoints"</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"get"</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
    <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token punctuation">---</span>
<span class="token comment">#Elasticsearch deployment itself</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
    <span class="token key atrule">version</span><span class="token punctuation">:</span> v7.10.2
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v7.10.2
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
        <span class="token key atrule">version</span><span class="token punctuation">:</span> v7.10.2
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/fluentd_elasticsearch/elasticsearch<span class="token punctuation">:</span>v7.10.2
          <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
           <span class="token comment"># need more cpu upon initialization, therefore burstable class</span>
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 1000m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 3Gi
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 3Gi
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9200</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> db
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9300</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> transport
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
              <span class="token key atrule">port</span><span class="token punctuation">:</span> transport
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
              <span class="token key atrule">port</span><span class="token punctuation">:</span> transport
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /data
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"NAMESPACE"</span>
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"MINIMUM_MASTER_NODES"</span>
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      <span class="token comment">#lasticsearch requires vm.max_map_count to be at least 262144.</span>
      <span class="token comment">#f your OS already sets up this number to a higher value, feel free</span>
      <span class="token comment">#o remove this init container.</span>
      <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> alpine<span class="token punctuation">:</span><span class="token number">3.6</span>
          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/sbin/sysctl"</span><span class="token punctuation">,</span> <span class="token string">"-w"</span><span class="token punctuation">,</span> <span class="token string">"vm.max_map_count=262144"</span><span class="token punctuation">]</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">-</span>logging<span class="token punctuation">-</span>init
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建es-service</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># kubectl create -f es-service.yaml </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>创建es-statefulset集群</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl create -f es-statefulset.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>3、 查看pod</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl get pod -n logging
NAME                              READY   STATUS    RESTARTS   AGE
elasticsearch-logging-0           1&#x2F;1     Running   0          91m
elasticsearch-logging-1           1&#x2F;1     Running   0          89m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、 安装kibana</p>
<ul>
<li><p>创建kibana-service.yaml文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat kibana-service.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
    <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
    <span class="token key atrule">kubernetes.io/name</span><span class="token punctuation">:</span> <span class="token string">"Kibana"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5601</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30333</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> ui
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建kibana-deployment.yaml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat kibana-service.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
    <span class="token key atrule">kubernetes.io/cluster-service</span><span class="token punctuation">:</span> <span class="token string">"true"</span>
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
    <span class="token key atrule">kubernetes.io/name</span><span class="token punctuation">:</span> <span class="token string">"Kibana"</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5601</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">30333</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> ui
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat kibana-deployment.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
          <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/kibana/kibana<span class="token punctuation">-</span>oss<span class="token punctuation">:</span>7.10.2
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
           <span class="token comment"># need more cpu upon initialization, therefore burstable class</span>
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 1000m
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_HOSTS
              <span class="token key atrule">value</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">-</span>logging<span class="token punctuation">:</span><span class="token number">9200</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVER_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> kibana<span class="token punctuation">-</span>logging
            <span class="token comment">#- name: SERVER_BASEPATH</span>
            <span class="token comment">#  value: /api/v1/namespaces/logging/services/kibana-logging/proxy</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVER_REWRITEBASEPATH
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">"false"</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">5601</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> ui
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/status
              <span class="token key atrule">port</span><span class="token punctuation">:</span> ui
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/status
              <span class="token key atrule">port</span><span class="token punctuation">:</span> ui
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建kibana-service</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl create -f kibana-service.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>创建kibana-deployment</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl create -f kibana-deployment.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>5、 查看kibana服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl get svc -n logging
NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
elasticsearch-logging   ClusterIP   None             &lt;none&gt;        9200&#x2F;TCP,9300&#x2F;TCP   113m
kibana-logging          NodePort    10.103.223.219   &lt;none&gt;        5601:30333&#x2F;TCP      89m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>type: NodePort</p>
<p>暴露端口为：30333 </p>
</blockquote>
<p>6、安装fluentd</p>
<ul>
<li><p>创建 fluentd-es-configmap.yaml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat fluentd-es-configmap.yaml </span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es<span class="token punctuation">-</span>config<span class="token punctuation">-</span>v0.2.1
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">system.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    &lt;system<span class="token punctuation">></span>
      root_dir /tmp/fluentd<span class="token punctuation">-</span>buffers/
    &lt;/system<span class="token punctuation">></span>

  <span class="token key atrule">containers.input.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token comment"># This configuration file for Fluentd / td-agent is used</span>
    <span class="token comment"># to watch changes to Docker log files. The kubelet creates symlinks that</span>
    <span class="token comment"># capture the pod name, namespace, container name &amp; Docker container ID</span>
    <span class="token comment"># to the docker logs for pods in the /var/log/containers directory on the host.</span>
    <span class="token comment"># If running this fluentd configuration in a Docker container, the /var/log</span>
    <span class="token comment"># directory should be mounted in the container.</span>
    <span class="token comment">#</span>
    <span class="token comment"># These logs are then submitted to Elasticsearch which assumes the</span>
    <span class="token comment"># installation of the fluent-plugin-elasticsearch &amp; the</span>
    <span class="token comment"># fluent-plugin-kubernetes_metadata_filter plugins.</span>
    <span class="token comment"># See https://github.com/uken/fluent-plugin-elasticsearch &amp;</span>
    <span class="token comment"># https://github.com/fabric8io/fluent-plugin-kubernetes_metadata_filter for</span>
    <span class="token comment"># more information about the plugins.</span>
    <span class="token comment">#</span>
    <span class="token comment"># Example</span>
    <span class="token comment"># =======</span>
    <span class="token comment"># A line in the Docker log file might look like this JSON:</span>
    <span class="token comment">#</span>
    <span class="token comment"># &#123;"log":"2014/09/25 21:15:03 Got request with path wombat\n",</span>
    <span class="token comment">#  "stream":"stderr",</span>
    <span class="token comment">#   "time":"2014-09-25T21:15:03.499185026Z"&#125;</span>
    <span class="token comment">#</span>
    <span class="token comment"># The time_format specification below makes sure we properly</span>
    <span class="token comment"># parse the time format produced by Docker. This will be</span>
    <span class="token comment"># submitted to Elasticsearch and should appear like:</span>
    <span class="token comment"># $ curl 'http://elasticsearch-logging:9200/_search?pretty'</span>
    <span class="token comment"># ...</span>
    <span class="token comment"># &#123;</span>
    <span class="token comment">#      "_index" : "logstash-2014.09.25",</span>
    <span class="token comment">#      "_type" : "fluentd",</span>
    <span class="token comment">#      "_id" : "VBrbor2QTuGpsQyTCdfzqA",</span>
    <span class="token comment">#      "_score" : 1.0,</span>
    <span class="token comment">#      "_source":&#123;"log":"2014/09/25 22:45:50 Got request with path wombat\n",</span>
    <span class="token comment">#                 "stream":"stderr","tag":"docker.container.all",</span>
    <span class="token comment">#                 "@timestamp":"2014-09-25T22:45:50+00:00"&#125;</span>
    <span class="token comment">#    &#125;,</span>
    <span class="token comment"># ...</span>
    <span class="token comment">#</span>
    <span class="token comment"># The Kubernetes fluentd plugin is used to write the Kubernetes metadata to the log</span>
    <span class="token comment"># record &amp; add labels to the log record if properly configured. This enables users</span>
    <span class="token comment"># to filter &amp; search logs on any metadata.</span>
    <span class="token comment"># For example a Docker container's logs might be in the directory:</span>
    <span class="token comment">#</span>
    <span class="token comment">#  /var/lib/docker/containers/997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b</span>
    <span class="token comment">#</span>
    <span class="token comment"># and in the file:</span>
    <span class="token comment">#</span>
    <span class="token comment">#  997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b-json.log</span>
    <span class="token comment">#</span>
    <span class="token comment"># where 997599971ee6... is the Docker ID of the running container.</span>
    <span class="token comment"># The Kubernetes kubelet makes a symbolic link to this file on the host machine</span>
    <span class="token comment"># in the /var/log/containers directory which includes the pod name and the Kubernetes</span>
    <span class="token comment"># container name:</span>
    <span class="token comment">#</span>
    <span class="token comment">#    synthetic-logger-0.25lps-pod_default_synth-lgr-997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b.log</span>
    <span class="token comment">#    -></span><span class="token scalar string">
    #    /var/lib/docker/containers/997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b/997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b-json.log
    #
    # The /var/log directory on the host is mapped to the /var/log directory in the container
    # running this instance of Fluentd and we end up collecting the file:
    #
    #   /var/log/containers/synthetic-logger-0.25lps-pod_default_synth-lgr-997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b.log
    #
    # This results in the tag:
    #
    #  var.log.containers.synthetic-logger-0.25lps-pod_default_synth-lgr-997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b.log
    #
    # The Kubernetes fluentd plugin is used to extract the namespace, pod name &amp; container name
    # which are added to the log message as a kubernetes field object &amp; the Docker container ID
    # is also added under the docker field object.
    # The final tag is:
    #
    #   kubernetes.var.log.containers.synthetic-logger-0.25lps-pod_default_synth-lgr-997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b.log
    #
    # And the final log record look like:
    #
    # &#123;
    #   "log":"2014/09/25 21:15:03 Got request with path wombat\n",
    #   "stream":"stderr",
    #   "time":"2014-09-25T21:15:03.499185026Z",
    #   "kubernetes": &#123;
    #     "namespace": "default",
    #     "pod_name": "synthetic-logger-0.25lps-pod",
    #     "container_name": "synth-lgr"
    #   &#125;,
    #   "docker": &#123;
    #     "container_id": "997599971ee6366d4a5920d25b79286ad45ff37a74494f262e3bc98d909d0a7b"
    #   &#125;
    # &#125;
    #
    # This makes it easier for users to search for logs by pod name or by
    # the name of the Kubernetes container regardless of how many times the
    # Kubernetes pod has been restarted (resulting in a several Docker container IDs).</span>

    <span class="token comment"># Json Log Example:</span>
    <span class="token comment"># &#123;"log":"[info:2016-02-16T16:04:05.930-08:00] Some log text here\n","stream":"stdout","time":"2016-02-17T00:04:05.931087621Z"&#125;</span>
    <span class="token comment"># CRI Log Example:</span>
    <span class="token comment"># 2016-02-17T00:04:05.931087621Z stdout F [info:2016-02-16T16:04:05.930-08:00] Some log text here</span>
    &lt;source<span class="token punctuation">></span>
      @id fluentd<span class="token punctuation">-</span>containers.log
      @type tail
      path /var/log/containers/<span class="token important">*.log</span>
      pos_file /var/log/es<span class="token punctuation">-</span>containers.log.pos
      tag raw.kubernetes.*
      read_from_head true
      &lt;parse<span class="token punctuation">></span>
        @type multi_format
        &lt;pattern<span class="token punctuation">></span>
          format json
          time_key time
          time_format %Y<span class="token punctuation">-</span>%m<span class="token punctuation">-</span>%dT%H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%NZ
        &lt;/pattern<span class="token punctuation">></span>
        &lt;pattern<span class="token punctuation">></span>
          format /^(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>.+) (<span class="token punctuation">?</span>&lt;stream<span class="token punctuation">></span>stdout<span class="token punctuation">|</span>stderr) <span class="token punctuation">[</span>^ <span class="token punctuation">]</span>* (<span class="token punctuation">?</span>&lt;log<span class="token punctuation">></span>.<span class="token important">*)$/</span>
          time_format %Y<span class="token punctuation">-</span>%m<span class="token punctuation">-</span>%dT%H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N%<span class="token punctuation">:</span>z
        &lt;/pattern<span class="token punctuation">></span>
      &lt;/parse<span class="token punctuation">></span>
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Detect exceptions in the log output and forward them as one log entry.</span>
    &lt;match raw.kubernetes.<span class="token important">**></span>
      @id raw.kubernetes
      @type detect_exceptions
      remove_tag_prefix raw
      message log
      stream stream
      multiline_flush_interval 5
      max_bytes 500000
      max_lines 1000
    &lt;/match<span class="token punctuation">></span>

    <span class="token comment"># Concatenate multi-line logs</span>
    &lt;filter <span class="token important">**></span>
      @id filter_concat
      @type concat
      key message
      multiline_end_regexp /\n$/
      separator ""
    &lt;/filter<span class="token punctuation">></span>

    <span class="token comment"># Enriches records with Kubernetes metadata</span>
    &lt;filter kubernetes.<span class="token important">**></span>
      @id filter_kubernetes_metadata
      @type kubernetes_metadata
    &lt;/filter<span class="token punctuation">></span>

    <span class="token comment"># Fixes json fields in Elasticsearch</span>
    &lt;filter kubernetes.<span class="token important">**></span>
      @id filter_parser
      @type parser
      key_name log
      reserve_data true
      remove_key_name_field true
      &lt;parse<span class="token punctuation">></span>
        @type multi_format
        &lt;pattern<span class="token punctuation">></span>
          format json
        &lt;/pattern<span class="token punctuation">></span>
        &lt;pattern<span class="token punctuation">></span>
          format none
        &lt;/pattern<span class="token punctuation">></span>
      &lt;/parse<span class="token punctuation">></span>
    &lt;/filter<span class="token punctuation">></span>

  <span class="token key atrule">system.input.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token comment"># Example:</span>
    <span class="token comment"># 2015-12-21 23:17:22,066 [salt.state       ][INFO    ] Completed state [net.ipv4.ip_forward] at time 23:17:22.066081</span>
    &lt;source<span class="token punctuation">></span>
      @id minion
      @type tail
      format /^(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span><span class="token punctuation">[</span>^ <span class="token punctuation">]</span>* <span class="token punctuation">[</span>^ <span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token important">*)</span><span class="token punctuation">[</span>^\<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token important">*\</span><span class="token punctuation">[</span><span class="token punctuation">[</span>^\<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token important">*\</span><span class="token punctuation">]</span>\<span class="token punctuation">[</span>(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token important">*)</span> <span class="token important">*\</span><span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)$/</span>
      time_format %Y<span class="token punctuation">-</span>%m<span class="token punctuation">-</span>%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S
      path /var/log/salt/minion
      pos_file /var/log/salt.pos
      tag salt
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># Dec 21 23:17:22 gke-foo-1-1-4b5cbd14-node-4eoj startupscript: Finished running startup script /var/run/google.startup.script</span>
    &lt;source<span class="token punctuation">></span>
      @id startupscript.log
      @type tail
      format syslog
      path /var/log/startupscript.log
      pos_file /var/log/es<span class="token punctuation">-</span>startupscript.log.pos
      tag startupscript
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Examples:</span>
    <span class="token comment"># time="2016-02-04T06:51:03.053580605Z" level=info msg="GET /containers/json"</span>
    <span class="token comment"># time="2016-02-04T07:53:57.505612354Z" level=error msg="HTTP Error" err="No such image: -f" statusCode=404</span>
    <span class="token comment"># TODO(random-liu): Remove this after cri container runtime rolls out.</span>
    &lt;source<span class="token punctuation">></span>
      @id docker.log
      @type tail
      format /^time="(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span><span class="token punctuation">[</span>^"<span class="token punctuation">]</span><span class="token important">*)"</span> level=(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span><span class="token punctuation">[</span>^ <span class="token punctuation">]</span><span class="token important">*)</span> msg="(<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span><span class="token punctuation">[</span>^"<span class="token punctuation">]</span><span class="token important">*)"(</span> err="(<span class="token punctuation">?</span>&lt;error<span class="token punctuation">></span><span class="token punctuation">[</span>^"<span class="token punctuation">]</span><span class="token important">*)")?(</span> statusCode=($&lt;status_code<span class="token punctuation">></span>\d+))<span class="token punctuation">?</span>/
      path /var/log/docker.log
      pos_file /var/log/es<span class="token punctuation">-</span>docker.log.pos
      tag docker
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># 2016/02/04 06:52:38 filePurge: successfully removed file /var/etcd/data/member/wal/00000000000006d0-00000000010a23d1.wal</span>
    &lt;source<span class="token punctuation">></span>
      @id etcd.log
      @type tail
      <span class="token comment"># Not parsing this, because it doesn't have anything particularly useful to</span>
      <span class="token comment"># parse out of it (like severities).</span>
      format none
      path /var/log/etcd.log
      pos_file /var/log/es<span class="token punctuation">-</span>etcd.log.pos
      tag etcd
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Multi-line parsing is required for all the kube logs because very large log</span>
    <span class="token comment"># statements, such as those that include entire object bodies, get split into</span>
    <span class="token comment"># multiple lines by glog.</span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I0204 07:32:30.020537    3368 server.go:1048] POST /stats/container/: (13.972191ms) 200 [[Go-http-client/1.1] 10.244.1.3:40537]</span>
    &lt;source<span class="token punctuation">></span>
      @id kubelet.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/kubelet.log
      pos_file /var/log/es<span class="token punctuation">-</span>kubelet.log.pos
      tag kubelet
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I1118 21:26:53.975789       6 proxier.go:1096] Port "nodePort for kube-system/default-http-backend:http" (:31429/tcp) was open before and is still needed</span>
    &lt;source<span class="token punctuation">></span>
      @id kube<span class="token punctuation">-</span>proxy.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/kube<span class="token punctuation">-</span>proxy.log
      pos_file /var/log/es<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>proxy.log.pos
      tag kube<span class="token punctuation">-</span>proxy
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I0204 07:00:19.604280       5 handlers.go:131] GET /api/v1/nodes: (1.624207ms) 200 [[kube-controller-manager/v1.1.3 (linux/amd64) kubernetes/6a81b50] 127.0.0.1:38266]</span>
    &lt;source<span class="token punctuation">></span>
      @id kube<span class="token punctuation">-</span>apiserver.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/kube<span class="token punctuation">-</span>apiserver.log
      pos_file /var/log/es<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>apiserver.log.pos
      tag kube<span class="token punctuation">-</span>apiserver
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I0204 06:55:31.872680       5 servicecontroller.go:277] LB already exists and doesn't need update for service kube-system/kube-ui</span>
    &lt;source<span class="token punctuation">></span>
      @id kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager.log
      pos_file /var/log/es<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager.log.pos
      tag kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># W0204 06:49:18.239674       7 reflector.go:245] pkg/scheduler/factory/factory.go:193: watch of *api.Service ended with: 401: The event in requested index is outdated and cleared (the requested history has been cleared [2578313/2577886]) [2579312]</span>
    &lt;source<span class="token punctuation">></span>
      @id kube<span class="token punctuation">-</span>scheduler.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/kube<span class="token punctuation">-</span>scheduler.log
      pos_file /var/log/es<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>scheduler.log.pos
      tag kube<span class="token punctuation">-</span>scheduler
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I0603 15:31:05.793605       6 cluster_manager.go:230] Reading config from path /etc/gce.conf</span>
    &lt;source<span class="token punctuation">></span>
      @id glbc.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/glbc.log
      pos_file /var/log/es<span class="token punctuation">-</span>glbc.log.pos
      tag glbc
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Example:</span>
    <span class="token comment"># I0603 15:31:05.793605       6 cluster_manager.go:230] Reading config from path /etc/gce.conf</span>
    &lt;source<span class="token punctuation">></span>
      @id cluster<span class="token punctuation">-</span>autoscaler.log
      @type tail
      format multiline
      multiline_flush_interval 5s
      format_firstline /^\w\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span>/
      format1 /^(<span class="token punctuation">?</span>&lt;severity<span class="token punctuation">></span>\w)(<span class="token punctuation">?</span>&lt;time<span class="token punctuation">></span>\d<span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>^\s<span class="token punctuation">]</span><span class="token important">*)\s+(?&lt;pid>\d+)\s+(?&lt;source></span><span class="token punctuation">[</span>^ \<span class="token punctuation">]</span><span class="token punctuation">]</span>+)\<span class="token punctuation">]</span> (<span class="token punctuation">?</span>&lt;message<span class="token punctuation">></span>.<span class="token important">*)/</span>
      time_format %m%d %H<span class="token punctuation">:</span>%M<span class="token punctuation">:</span>%S.%N
      path /var/log/cluster<span class="token punctuation">-</span>autoscaler.log
      pos_file /var/log/es<span class="token punctuation">-</span>cluster<span class="token punctuation">-</span>autoscaler.log.pos
      tag cluster<span class="token punctuation">-</span>autoscaler
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># Logs from systemd-journal for interesting services.</span>
    <span class="token comment"># TODO(random-liu): Remove this after cri container runtime rolls out.</span>
    &lt;source<span class="token punctuation">></span>
      @id journald<span class="token punctuation">-</span>docker
      @type systemd
      matches <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token key atrule">"_SYSTEMD_UNIT"</span><span class="token punctuation">:</span> <span class="token string">"docker.service"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
      &lt;storage<span class="token punctuation">></span>
        @type local
        persistent true
        path /var/log/journald<span class="token punctuation">-</span>docker.pos
      &lt;/storage<span class="token punctuation">></span>
      read_from_head true
      tag docker
    &lt;/source<span class="token punctuation">></span>

    &lt;source<span class="token punctuation">></span>
      @id journald<span class="token punctuation">-</span>container<span class="token punctuation">-</span>runtime
      @type systemd
      matches <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token key atrule">"_SYSTEMD_UNIT"</span><span class="token punctuation">:</span> <span class="token string">"&#123;&#123; fluentd_container_runtime_service &#125;&#125;.service"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
      &lt;storage<span class="token punctuation">></span>
        @type local
        persistent true
        path /var/log/journald<span class="token punctuation">-</span>container<span class="token punctuation">-</span>runtime.pos
      &lt;/storage<span class="token punctuation">></span>
      read_from_head true
      tag container<span class="token punctuation">-</span>runtime
    &lt;/source<span class="token punctuation">></span>

    &lt;source<span class="token punctuation">></span>
      @id journald<span class="token punctuation">-</span>kubelet
      @type systemd
      matches <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token key atrule">"_SYSTEMD_UNIT"</span><span class="token punctuation">:</span> <span class="token string">"kubelet.service"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
      &lt;storage<span class="token punctuation">></span>
        @type local
        persistent true
        path /var/log/journald<span class="token punctuation">-</span>kubelet.pos
      &lt;/storage<span class="token punctuation">></span>
      read_from_head true
      tag kubelet
    &lt;/source<span class="token punctuation">></span>

    &lt;source<span class="token punctuation">></span>
      @id journald<span class="token punctuation">-</span>node<span class="token punctuation">-</span>problem<span class="token punctuation">-</span>detector
      @type systemd
      matches <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token key atrule">"_SYSTEMD_UNIT"</span><span class="token punctuation">:</span> <span class="token string">"node-problem-detector.service"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
      &lt;storage<span class="token punctuation">></span>
        @type local
        persistent true
        path /var/log/journald<span class="token punctuation">-</span>node<span class="token punctuation">-</span>problem<span class="token punctuation">-</span>detector.pos
      &lt;/storage<span class="token punctuation">></span>
      read_from_head true
      tag node<span class="token punctuation">-</span>problem<span class="token punctuation">-</span>detector
    &lt;/source<span class="token punctuation">></span>

    &lt;source<span class="token punctuation">></span>
      @id kernel
      @type systemd
      matches <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token key atrule">"_TRANSPORT"</span><span class="token punctuation">:</span> <span class="token string">"kernel"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
      &lt;storage<span class="token punctuation">></span>
        @type local
        persistent true
        path /var/log/kernel.pos
      &lt;/storage<span class="token punctuation">></span>
      &lt;entry<span class="token punctuation">></span>
        fields_strip_underscores true
        fields_lowercase true
      &lt;/entry<span class="token punctuation">></span>
      read_from_head true
      tag kernel
    &lt;/source<span class="token punctuation">></span>

  <span class="token key atrule">forward.input.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token comment"># Takes the messages sent over TCP</span>
    &lt;source<span class="token punctuation">></span>
      @id forward
      @type forward
    &lt;/source<span class="token punctuation">></span>

  <span class="token key atrule">monitoring.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token comment"># Prometheus Exporter Plugin</span>
    <span class="token comment"># input plugin that exports metrics</span>
    &lt;source<span class="token punctuation">></span>
      @id prometheus
      @type prometheus
    &lt;/source<span class="token punctuation">></span>

    &lt;source<span class="token punctuation">></span>
      @id monitor_agent
      @type monitor_agent
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># input plugin that collects metrics from MonitorAgent</span>
    &lt;source<span class="token punctuation">></span>
      @id prometheus_monitor
      @type prometheus_monitor
      &lt;labels<span class="token punctuation">></span>
        host $<span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span>
      &lt;/labels<span class="token punctuation">></span>
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># input plugin that collects metrics for output plugin</span>
    &lt;source<span class="token punctuation">></span>
      @id prometheus_output_monitor
      @type prometheus_output_monitor
      &lt;labels<span class="token punctuation">></span>
        host $<span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span>
      &lt;/labels<span class="token punctuation">></span>
    &lt;/source<span class="token punctuation">></span>

    <span class="token comment"># input plugin that collects metrics for in_tail plugin</span>
    &lt;source<span class="token punctuation">></span>
      @id prometheus_tail_monitor
      @type prometheus_tail_monitor
      &lt;labels<span class="token punctuation">></span>
        host $<span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span>
      &lt;/labels<span class="token punctuation">></span>
    &lt;/source<span class="token punctuation">></span>

  <span class="token key atrule">output.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    &lt;match <span class="token important">**></span>
      @id elasticsearch
      @type elasticsearch
      @log_level info
      type_name _doc
      include_tag_key true
      host elasticsearch<span class="token punctuation">-</span>logging
      port 9200
      logstash_format true
      &lt;buffer<span class="token punctuation">></span>
        @type file
        path /var/log/fluentd<span class="token punctuation">-</span>buffers/kubernetes.system.buffer
        flush_mode interval
        retry_type exponential_backoff
        flush_thread_count 2
        flush_interval 5s
        retry_forever
        retry_max_interval 30
        chunk_limit_size 2M
        total_limit_size 500M
        overflow_action block
      &lt;/buffer<span class="token punctuation">></span>
    &lt;/match<span class="token punctuation">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建 fluentd-es-ds.yaml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>master efk<span class="token punctuation">]</span><span class="token comment"># cat fluentd-es-ds.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"namespaces"</span>
  <span class="token punctuation">-</span> <span class="token string">"pods"</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">"get"</span>
  <span class="token punctuation">-</span> <span class="token string">"watch"</span>
  <span class="token punctuation">-</span> <span class="token string">"list"</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es<span class="token punctuation">-</span>v3.1.1
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> logging
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
    <span class="token key atrule">version</span><span class="token punctuation">:</span> v3.1.1
    <span class="token key atrule">addonmanager.kubernetes.io/mode</span><span class="token punctuation">:</span> Reconcile
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v3.1.1
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
        <span class="token key atrule">version</span><span class="token punctuation">:</span> v3.1.1
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
        <span class="token key atrule">seccompProfile</span><span class="token punctuation">:</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> RuntimeDefault
      <span class="token key atrule">priorityClassName</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>node<span class="token punctuation">-</span>critical
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es
        <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/fluentd_elasticsearch/fluentd<span class="token punctuation">:</span>v3.1.0
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> FLUENTD_ARGS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>supervisor <span class="token punctuation">-</span>q
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 500Mi
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 200Mi
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> varlog
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> varlibdockercontainers
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/docker/containers
          <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/fluent/config.d
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">24231</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> prometheus
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
        <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> prometheus
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
        <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
          <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
            <span class="token key atrule">port</span><span class="token punctuation">:</span> prometheus
          <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
          <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> varlog
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> varlibdockercontainers
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/lib/docker/containers
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>volume
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> fluentd<span class="token punctuation">-</span>es<span class="token punctuation">-</span>config<span class="token punctuation">-</span>v0.2.1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>创建fluentd服务</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl create fluentd-es-configmap.yaml -f fluentd-es-ds.yaml <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>7、查看pod状态</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@k8s-master efk]# kubectl get pod -n logging
NAME                              READY   STATUS    RESTARTS   AGE
elasticsearch-logging-0           1&#x2F;1     Running   0          103m
elasticsearch-logging-1           1&#x2F;1     Running   0          101m
fluentd-es-v3.1.1-tt7hj           1&#x2F;1     Running   0          76m
fluentd-es-v3.1.1-vrj8h           1&#x2F;1     Running   0          76m
kibana-logging-647576567c-zdl4w   1&#x2F;1     Running   0          42m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、使用"><a href="#三、使用" class="headerlink" title="三、使用"></a>三、使用</h2><p>1、 访问kibana  <a href="http://serverip:30333/">http://serverIP:30333/</a>  </p>
<p>2、 需注意： 需要释放端口：30333</p>
<h2 id="四、-报错"><a href="#四、-报错" class="headerlink" title="四、 报错"></a>四、 报错</h2><blockquote>
<p><strong>修复bug</strong></p>
<p>我们打开浏览器，访问<a href="http://serverip:30333/">http://serverIP:30333/</a> ，我们得到了如下结果：</p>
<p>{“statusCode”:404,”error”:”Not Found”,”message”:”Not Found”}</p>
<p>这是因为将/api/v1/namespaces/kube-system/services/kibana-logging/proxy/app/kibana这个url path也传递给后面的kibana了，导致kibana却无法处理。 这是由于我们错误配置的env，其实我已经在kibana-deployment.yaml 修改完成了</p>
</blockquote>
<p>- </p>
]]></content>
      <categories>
        <category>kubernetes系列</category>
      </categories>
      <tags>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>openstack原理</title>
    <url>/blog/2021/10/28/openstack%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h2 id="第一章-原理篇"><a href="#第一章-原理篇" class="headerlink" title="第一章 原理篇"></a>第一章 原理篇</h2><h3 id="一、云计算之OpenStack"><a href="#一、云计算之OpenStack" class="headerlink" title="一、云计算之OpenStack"></a>一、云计算之OpenStack</h3><h4 id="1-1-什么是云"><a href="#1-1-什么是云" class="headerlink" title="1.1    什么是云"></a>1.1    什么是云</h4><h4 id="云计算-Cloud-Computing-："><a href="#云计算-Cloud-Computing-：" class="headerlink" title="云计算(Cloud Computing)："></a>云计算(Cloud Computing)：</h4><p>一种基于因特网的超级计算模式，在远程的数据中心里，成千上万台电脑和服务器连接成一片电脑云。因此，云计算甚至可以让你体验每秒10万亿次的运算能力，拥有这么强大的计算能力可以模拟核爆炸、预测气候变化和市场发展趋势。用户通过电脑、笔记本、手机等方式接入数据中心，按自己的需求进行运算。</p>
<p><strong>也可以这样理解为：</strong></p>
<p>云计算(Cloud Computing)是网格计算(Grid Computing)、分布式计算(DistributedComputing)、并行计算(ParallelComputing)、效用计算(UtilityComputing) 、网络存储(Network Storage Technologies)、虚拟化(Virtualization) 、负载均衡(Load Balanc)等传统计算机技术和网络技术发展融合的产物。</p>
<h4 id="1-1-1-云计算模型："><a href="#1-1-1-云计算模型：" class="headerlink" title="1.1.1    云计算模型："></a>1.1.1    云计算模型：</h4><p>公用云(Public Cloud)</p>
<p>私有云(Private Cloud)</p>
<p>社区云(Community cloud)</p>
<p>混合云(Hybrid Cloud)</p>
<h4 id="1-1-2-云计算服务形式"><a href="#1-1-2-云计算服务形式" class="headerlink" title="1.1.2    云计算服务形式"></a>1.1.2    云计算服务形式</h4><p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/pUm6Hxkd434pJiaNTyEUyfLseRl2ibZIAVHJqcMFqyAf4ibCUXjcZiaic3R43uBM7WdyoIdpibAicmHbkCsKKc13ibTocA/640?wx_fmt=jpeg" class="lazyload placeholder" data-srcset="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/pUm6Hxkd434pJiaNTyEUyfLseRl2ibZIAVHJqcMFqyAf4ibCUXjcZiaic3R43uBM7WdyoIdpibAicmHbkCsKKc13ibTocA/640?wx_fmt=jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="全面讲解OpenStack技术知识_架构师技术联盟-CSDN博客"></p>
<p>**IaaS(Infrastructure-as-a- Service)**：基础设施即服务。消费者通过Internet可以从完善的计算机基础设施获得服务。</p>
<p><strong>PaaS(Platform-as-a- Service)：</strong>平台即服务。PaaS实际上是指将软件研发的平台作为一种服务，以SaaS的模式提交给用户。</p>
<p><strong>SaaS(Software-as-a- Service)：</strong>软件即服务。它是一种通过Internet提供软件的模式，用户无需购买软件，而是向提供商租用基于Web的软件，来管理企业经营活动。</p>
<h4 id="1-1-3-云计算的优势"><a href="#1-1-3-云计算的优势" class="headerlink" title="1.1.3     云计算的优势"></a>1.1.3     云计算的优势</h4><p><strong>1. 对于社会</strong></p>
<p>1）降低全社会的IT能耗，减少排放，真正做到“绿色计算”。</p>
<p>2）提高全社会的IT设备使用率，并降低电子产品的数量，从而减少因设备淘汰而产生的电子产品垃圾，对于保护环境大有裨益。</p>
<p>3）信息技术产业进一步合理分工——由资金雄厚、技术过硬、专业人士众多的机构负责建设并管理云端，从而提高了整个社会信息技术处理环境的可靠性。换言之，也就降低了因天灾人祸导致的生命财产损失。</p>
<p>4）形成新的云计算产业。</p>
<p>5）有利于全社会共享数据信息，打破信息孤岛。尤其是涉及公民的身份信息、档案信息、信用信息、健康信息及教育工作信息等的全国性公共云平台，带来的社会效益更是巨大的。</p>
<p><strong>2. 对于云计算消费者</strong></p>
<p>1）降低了信息技术成本：前期投入和日常使用成本得到大幅度降低，同时也降低了因各种IT事故导致的损失。</p>
<p>2）提高了数据的安全性，具体介绍见后续章节。</p>
<p>3）提高了应用系统的可靠性，具体介绍见后续章节。</p>
<p>4）提高了用户体验：当今网络无处不在，云计算消费者可以随时随地采用任何云终端接入云端并使用云中的计算资源，真正实现移动办公。</p>
<p>5）大型昂贵软件平民化：诸如可靠性工程软件、ERP 系统、CRM 系统、商业智能系统等云化之后以 SaaS 模式出租，这些以前只有大型企业使用的软件系统，现在广大中小型企业和个人都能用得起。</p>
<p>6）从复杂的 IT 技术泥潭中摆脱出来，专注于自己的核心业务和市场。</p>
<p>7）能快速响应消费者对计算资源的弹性需求，从而能及时满足企业的业务变化。在传统 IT 系统下，一项新业务对 IT 资源的扩容要求，往往在数月或者一年后才能得到满足，这使得市场人员和管理层往往难以接受，因为市场是瞬息万变的。</p>
<p>8）有利于企业之间或者个人之间共享信息，打破信息孤岛。</p>
<p>9）个人、中小企业和机构也用得起高性能计算。</p>
<h4 id="1-1-4-云厂商"><a href="#1-1-4-云厂商" class="headerlink" title="1.1.4     云厂商"></a>1.1.4     云厂商</h4><ul>
<li>亚马逊AWS.</li>
<li>微软Azure.</li>
<li>阿里<strong>云</strong></li>
<li>UCloud.</li>
<li>腾讯<strong>云</strong></li>
</ul>
<h4 id="1-2-OpenStack-发展历史"><a href="#1-2-OpenStack-发展历史" class="headerlink" title="1.2     OpenStack 发展历史"></a>1.2     OpenStack 发展历史</h4><p>Openstack 是在2010年由拖管服务器及云计算提供商RackSpace 和美国航天航空局NASA共同发起的开源项目，愿景是为了数据中心建立一套云操作系统，大幅提升数据中心的运营效率。</p>
<h4 id="1-2-1-什么是-OpenStack"><a href="#1-2-1-什么是-OpenStack" class="headerlink" title="1.2.1    什么是 OpenStack"></a>1.2.1    什么是 OpenStack</h4><p>OpenStack 是一种云操作系统，可控制整个数据中心内的大量计算、存储和网络资源池，所有这些资源都通过一个仪表板进行管理，该仪表板为管理员提供控制权，同时授权其用户通过 Web 界面配置资源。</p>
<h4 id="1-3-OpenStack-概念设计"><a href="#1-3-OpenStack-概念设计" class="headerlink" title="1.3    OpenStack 概念设计"></a>1.3    OpenStack 概念设计</h4><p>OpenStack 是一个开源的云计算平台，由来自全世界的开发者创造了OpenStack开源项目，社区活跃度和代码贡献量非常高，主要特点是易实施、大规模弹性扩展和功能丰富。</p>
<img src="https://docs.openstack.org/install-guide/_images/openstack_kilo_conceptual_arch.png" class="lazyload placeholder" data-srcset="https://docs.openstack.org/install-guide/_images/openstack_kilo_conceptual_arch.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img" style="zoom:60%;">

<p>各服务组件的功能如下：</p>
<ul>
<li><strong>Keystone:</strong>    为各服务组件提供用户认证和权限验证功能；</li>
<li><strong>Ceilometer:</strong> 为各服务组件提供监控、检索和计量功能；</li>
<li><strong>Horizon:</strong>   为用户操作 OpenStack 项目中的各服务提供基于Web形式的图形界面；</li>
<li><strong>Glance:</strong>   为虚拟机实例提供镜像服务，Glance服务中的镜像介质存放在Swift中；</li>
<li><strong>Neutron:</strong>   为虚拟机实例提供网络连接服务，同时也为lronic 提供PXE网络;</li>
<li><strong>lronic:</strong> 提供物理机的添加、删除、电源管理和安装部署等功能；</li>
<li><strong>Nova:</strong>   为虚拟机实例提供计算资源；</li>
<li><strong>Trove:</strong>  为虚拟机镜像提供注册服务；使用Nova 启动数据库实例；依附虚拟实例，提供数据存储、操作和管理；可以备份数据库实例到Swift 中；</li>
<li><strong>inder:</strong> 为虚拟机实例提供块设备，同时备份设备数据到Swift 中；</li>
<li><strong>Sahara:</strong> 通过Heat编排集群配置；在Swift 中保存或二进制文件；将任务分派给虚拟机实例处理；通过Nova 运行数据处理实例；在Glance 中注册Hadoop 镜像;</li>
<li><strong>Heat:</strong> 可以编排Cinder Neutron Glance和 Nova 各种资源;</li>
</ul>
<h4 id="1-4-逻辑架构"><a href="#1-4-逻辑架构" class="headerlink" title="1.4    逻辑架构"></a>1.4    逻辑架构</h4><img src="https://docs.openstack.org/install-guide/_images/openstack-arch-kilo-logical-v1.png" class="lazyload placeholder" data-srcset="https://docs.openstack.org/install-guide/_images/openstack-arch-kilo-logical-v1.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img" style="zoom:80%;">

<h4 id="1-4-Openstack-服务组件"><a href="#1-4-Openstack-服务组件" class="headerlink" title="1.4    Openstack 服务组件"></a>1.4    Openstack 服务组件</h4><p>Openstack 项目通过一系列相互关联的内部服务组件提供了基础设施即服务(Infrastructure as a Service laaS)的解决方案，每个内部服务组件都提供了有利于集成的应用程序接口(API)根据实际需要，可以选择安装某几个或全部安装服务组件：</p>
<ul>
<li>Dashboard （仪表盘）</li>
<li>Compute （计算）</li>
<li>Networking (网络）</li>
<li>ObjectStorage（对象存储） </li>
<li>Block Storage (块存储)</li>
<li>Identify （认证）</li>
<li>Image (镜像）</li>
<li>Telemetry （计量）</li>
<li>Orchestration (编排）</li>
<li>Database (数据库）</li>
<li>Data Processing Service (数据分析）</li>
</ul>
]]></content>
      <categories>
        <category>云计算</category>
      </categories>
      <tags>
        <tag>openstack</tag>
      </tags>
  </entry>
  <entry>
    <title>prometheus定义</title>
    <url>/blog/2021/10/28/prometheus%E5%AE%9A%E4%B9%89/</url>
    <content><![CDATA[<h1 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a><font size="6" color="green">prometheus</font></h1><p><a href="https://prometheus.io/docs/introduction/overview/"><font color="red">官方帮助手册</font></a></p>
<h2 id="一、Prometheus-定义"><a href="#一、Prometheus-定义" class="headerlink" title="一、Prometheus 定义"></a>一、Prometheus 定义</h2><h3 id="1、简介："><a href="#1、简介：" class="headerlink" title="1、简介："></a><strong>1、简介：</strong></h3><p>Prometheus是最初在SoundCiloud上构建的开源系统监视和警报工具包 。自2012年成立以来，许多公司和组织都采用了Prometheus，该项目拥有非常活跃的开发人员和用户社区。现在，它是一个独立的开源项目，并且独立于任何公司进行维护。为了强调这一点并阐明项目的治理结构，Prometheus在2016年加入了 Cloud Native Computing Foundation，这是继Kubernetes之后的第二个托管项目。Prometheus 在开源社区也十分活跃，在GitHub上拥有两万多star，并且每隔一两周就会有一个小版本的更新。</p>
<h3 id="2、-特征："><a href="#2、-特征：" class="headerlink" title="2、 特征："></a><strong>2、 特征：</strong></h3><p>普罗米修斯的主要特点是：</p>
<ul>
<li>一个多维数据模型，其中包含通过度量标准名称和键/值对标识的时间序列数据；</li>
<li>PromQL，一种灵活的查询语言 ，可利用此维度 ；</li>
<li>不依赖分布式存储；单服务器节点是自治的；</li>
<li>时间序列收集通过HTTP上的拉模型进行；</li>
<li>通过中间网关支持推送时间序列；</li>
<li>通过服务发现或静态配置发现目标；</li>
<li>多种图形和仪表板支持模式；</li>
<li>易于维护，可以通过二进制文件直接启动，并且提供了容器化部署镜像；</li>
<li>支持数据的分区采样和联邦部署，支持大规模集群监控；</li>
</ul>
<h4 id="3、-组件："><a href="#3、-组件：" class="headerlink" title="3、 组件："></a><strong>3、 组件</strong>：</h4><p>Prometheus生态系统包含多个组件，其中许多是可选的：</p>
<ul>
<li>Prometheus主服务器，它会刮取并存储时间序列数据</li>
<li>客户端库，用于检测应用程序代码</li>
<li>一个支持短期工作的推送网关</li>
<li>诸如HAProxy，StatsD，Graphite等服务的专用出口商</li>
<li>一个alertmanager处理警报</li>
<li>各种支持工具</li>
</ul>
<h4 id="4、-架构："><a href="#4、-架构：" class="headerlink" title="4、 架构："></a><strong>4、 架构</strong>：</h4><p>Prometheus 的基本原则是通过HTTP周期性抓取被监控组件的状态，任意组件只要提供对应的HTTP接口并且符合Prometheus 定义的数据格式，就可以接入Prometheus 监控；</p>
<p>Prometheus 整体架构图 </p>
<p><img src="https://prometheus.io/assets/architecture.png" class="lazyload placeholder" data-srcset="https://prometheus.io/assets/architecture.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg"></p>
]]></content>
      <categories>
        <category>监控系统</category>
      </categories>
      <tags>
        <tag>prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql5.7主从复制-异步</title>
    <url>/blog/2021/11/06/mysql5-7%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-%E5%BC%82%E6%AD%A5/</url>
    <content><![CDATA[<h1 id="Mysql-5-7-架构之主从复制-异步"><a href="#Mysql-5-7-架构之主从复制-异步" class="headerlink" title="Mysql 5.7  架构之主从复制(异步)"></a>Mysql 5.7  架构之主从复制(异步)</h1><h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><p>MySQL 从3.23版本开始提供复制的功能。复制是指将主数据库的DDL和DML 操作通过二进制日志传到复制服务器（也就从库）上，然后从库上对这些日志重新执行（也叫重做），从而使得从库和主库的数据保持同步。</p>
<p>MySQL 支持两种复制方式： 基于行的复制和基于语句的复制。基于语句的复制（也称为逻辑复制）早在MySQL3.23 版本总就存在，而基于行的复制方式在5.1版本中才被加进来。这两种方式都是通过主主库上记录二进制日志、在备库重放日志的方式来实现异步的数据复制。这意味着，在同一时间点备库上的数据可能与主库存在不一致，并且无法保证主备之间的延迟。一些大的语句可能导致备库产生几秒、几分钟甚至几个小时的延迟。</p>
<p><font color="red">注意：</font></p>
<blockquote>
<p>由于MySQL 实现的是异步的复制，所以主从库之间存在一定的差距，在从库上进行的查询操作需要考虑到这些数据的差异、一般只有更新不频繁的数据或者对实时要求不高的数据可以通过从库查询，实时性要求高的数据仍需要从主数据库获取</p>
</blockquote>
<h2 id="二、复制解决的问题"><a href="#二、复制解决的问题" class="headerlink" title="二、复制解决的问题"></a>二、复制解决的问题</h2><ul>
<li>数据分布</li>
<li>负载均衡</li>
<li>备份</li>
<li>高可用和故障切换</li>
<li>MySQL 升级测试</li>
</ul>
<h2 id="三、MySQL-复制是如何工作"><a href="#三、MySQL-复制是如何工作" class="headerlink" title="三、MySQL 复制是如何工作"></a>三、MySQL 复制是如何工作</h2><p>MySQL 的复制原理大致如下：</p>
<p>mysql主从复制需要三个线程，master（binlog dump thread）、slave（I/O thread 、SQL thread）。</p>
<ol>
<li>首先，MySQL 主库在事务提交时会把数据变更作为事件Events 记录在二进制日志文件Binlog中；MySQL 主库上的sync_binlog 参数控制Binlog 日志刷新磁盘。</li>
<li>主库推送二进制日志文件Binlog 中的事件到从库的中继日志 Relay Log 重做数据变更操作，通过逻辑复制以此达到主库和从库的数据一致。</li>
</ol>
<p>MySQL 通过3个线程来完成主从库间的数据复制： 其中 Binlog Dump 线程跑在主库上， I/O 线程和SQL线程跑在从库上。当在从库上启动复制（START SLAVE)时，首先创建I/O线程连接主库，主库随后创建Binlog Dump 线程读取数据库事件并发送I/O 线程，I/O线程获 取到</p>
<ul>
<li>开启binlog日志</li>
<li>创建I/O 线程连接主库；</li>
<li>主库创建Binlog Dump线程读取数据事件并发送给I/O线程；</li>
<li>I/O 线程获取到事件数据后更新到从库的中继日志 Relay Log 中；</li>
<li>从库上的SQL 线程读取中继日志Relay Log 中更新数据事件并应用</li>
</ul>
<img src="/Users/abbott/Library/Application Support/typora-user-images/image-20211103000318590.png" class="lazyload placeholder" data-srcset="/Users/abbott/Library/Application Support/typora-user-images/image-20211103000318590.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20211103000318590" style="zoom:50%;">

<h2 id="四、环境介绍"><a href="#四、环境介绍" class="headerlink" title="四、环境介绍"></a>四、环境介绍</h2><table>
<thead>
<tr>
<th>IP地址</th>
<th>角色</th>
<th>OS</th>
<th>软件版本</th>
</tr>
</thead>
<tbody><tr>
<td>172.16.59.141</td>
<td>master</td>
<td>3.10.0-1160.45.1.el7.x86_64</td>
<td>5.7.36-log MySQL Community Server (GPL</td>
</tr>
<tr>
<td>172.16.59.142</td>
<td>slave01</td>
<td>3.10.0-1160.45.1.el7.x86_64</td>
<td>5.7.36-log MySQL Community Server (GPL</td>
</tr>
<tr>
<td>172.16.59.143</td>
<td>slave02</td>
<td>3.10.0-1160.45.1.el7.x86_64</td>
<td>5.7.36-log MySQL Community Server (GPL</td>
</tr>
</tbody></table>
<h2 id="五、流程架构图："><a href="#五、流程架构图：" class="headerlink" title="五、流程架构图："></a>五、流程架构图：</h2><img src="/Users/abbott/Library/Application Support/typora-user-images/image-20211105232550510.png" class="lazyload placeholder" data-srcset="/Users/abbott/Library/Application Support/typora-user-images/image-20211105232550510.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="image-20211105232550510" style="zoom:50%;">

<h2 id="六、搭建过程（主从一样）"><a href="#六、搭建过程（主从一样）" class="headerlink" title="六、搭建过程（主从一样）"></a>六、搭建过程（主从一样）</h2><h3 id="6-1-获取安装"><a href="#6-1-获取安装" class="headerlink" title="6.1 获取安装"></a>6.1 获取安装</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-master ~]#  wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz
[root@mysql-slave01 ~]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz
[root@mysql-slave02 ~]# wget https:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;Downloads&#x2F;MySQL-5.7&#x2F;mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="6-2-创建目录及解压"><a href="#6-2-创建目录及解压" class="headerlink" title="6.2 创建目录及解压"></a>6.2 创建目录及解压</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-master ~]# mkdir -p &#x2F;app&#x2F;soft
[root@mysql-master ~]# mkdir -p &#x2F;data&#x2F;mysql5_data&#x2F;logs
[root@mysql-master ~]# mv mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz &#x2F;app&#x2F;soft
[root@mysql-master soft]# tar xf mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz 
[root@mysql-master soft]# ln -s mysql-5.7.36-linux-glibc2.12-x86_64 mysql5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-3-创建mysql用户"><a href="#6-3-创建mysql用户" class="headerlink" title="6.3 创建mysql用户"></a>6.3 创建mysql用户</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-master ~]# useradd  mysql -s &#x2F;sbin&#x2F;nologin <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="6-4-修改权限"><a href="#6-4-修改权限" class="headerlink" title="6.4 修改权限"></a>6.4 修改权限</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@mysql-master data]# chown mysql:mysql -R mysql5_data&#x2F;
[root@mysql-master soft]# chown mysql:mysql -R mysql5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="6-5-创建my-cnf"><a href="#6-5-创建my-cnf" class="headerlink" title="6.5 创建my.cnf"></a>6.5 创建my.cnf</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">[root@mysql-master ~]# vim  &#x2F;data&#x2F;mysql5_data&#x2F;my.cnf
[mysqld]
basedir &#x3D; &#x2F;app&#x2F;soft&#x2F;mysql5
datadir &#x3D; &#x2F;data&#x2F;mysql5_data&#x2F;data
socket &#x3D; &#x2F;data&#x2F;mysql5_data&#x2F;mysql3306.sock
port &#x3D; 3306
server-id &#x3D; 1    # server_id 是唯一

#log setting
log_error &#x3D; &#x2F;data&#x2F;mysql5_data&#x2F;logs&#x2F;error.log
slow_query_log &#x3D; 1
long_query_time &#x3D; 1
slow-query_log_file &#x3D; &#x2F;data&#x2F;mysql5_data&#x2F;slow_query.log
log_queries_not_using_indexes &#x3D; 1
log_throttle_queries_not_using_indexes &#x3D; 5
min_examined_row_limit &#x3D; 100
expire_logs_days &#x3D; 5

#Master-from-set
log-bin &#x3D; mysql-bin
binlog_format &#x3D; ROW

#innodb setting
innodb_buffer_pool_size &#x3D; 64M
innodb_log_buffer_size &#x3D; 2M
innodb_lock_wait_timeout &#x3D; 120
innodb_log_file_size &#x3D; 32M<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><font color="red">注意：</font></p>
<blockquote>
<p>slave 的server_id 要比主server_id 要大</p>
</blockquote>
<h3 id="6-6-初始化"><a href="#6-6-初始化" class="headerlink" title="6.6 初始化"></a>6.6 初始化</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">~]# bin&#x2F;mysqld --user&#x3D;mysql --basedir&#x3D;&#x2F;app&#x2F;soft&#x2F;mysql5&#x2F; --datadir&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;data --initialize<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>初始化密码：会随机打印到屏幕上</p>
</blockquote>
<h3 id="6-7-启动数据并登陆"><a href="#6-7-启动数据并登陆" class="headerlink" title="6.7 启动数据并登陆"></a>6.7 启动数据并登陆</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">~]# bin&#x2F;mysqld --defaults-file&#x3D;&#x2F;data&#x2F;mysql5_data&#x2F;my.cnf  --user&#x3D;mysql &amp;
~]# mysql -S &#x2F;data&#x2F;mysql5_data&#x2F;mysql3306.sock -uroot -p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><font color="red">注意：</font></p>
<blockquote>
<p>第一次登陆mysql需要修改密码：set password=password(‘123456’);</p>
</blockquote>
<p><font color="red">至此master就安装完成，两台 slave 一样执行，唯独my.cnf文件不一样；</font></p>
<h3 id="七、在主库上创建用户并授权用于复制使用的"><a href="#七、在主库上创建用户并授权用于复制使用的" class="headerlink" title="七、在主库上创建用户并授权用于复制使用的"></a>七、在主库上创建用户并授权用于复制使用的</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  create user slave@&#39;%&#39; identified by &#39;slave123&#39;;
root@localhost: [ (none) ]&gt;  grant replication slave on &#39;slave&#39;@&#39;%&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="八、查看master-库上日志文件名及偏移量"><a href="#八、查看master-库上日志文件名及偏移量" class="headerlink" title="八、查看master 库上日志文件名及偏移量"></a>八、查看master 库上日志文件名及偏移量</h3><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  show master status \G
*************************** 1. row ***************************
             File: mysql-bin.000003
         Position: 841
     Binlog_Do_DB: 
 Binlog_Ignore_DB: 
Executed_Gtid_Set: 
1 row in set (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>九、在两个从库上执行</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  change master to 
master_host&#x3D;&#39;172.16.59.141&#39;,          # 表示实现复制的主机的IP地址
master_port&#x3D;3306, 										# 表示实现复制的主机的端口号
master_user&#x3D;&#39;slave&#39;, 									# 表示实现复制远程登陆主机的用户命
master_password&#x3D;&#39;slave123&#39;,					  # 表示实现复制远程登录主机用户的密码
master_log_file&#x3D;&#39;mysql-bin.000003&#39;,   # 表示实现复制的binlog 日志文件名
master_log_pos&#x3D;841;                   # 表示实现复制的binlog 日志文件的偏移量<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>十、在从库上开启slave进程</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  start slave;
Query OK, 0 rows affected (0.00 sec)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="七、验证："><a href="#七、验证：" class="headerlink" title="七、验证："></a>七、验证：</h2><p>一、主库上查看是否有slave进程</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  show processlist;
+----+-------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+
| Id | User  | Host                | db   | Command     | Time | State                                                         | Info             |
+----+-------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+
|  3 | root  | localhost           | NULL | Query       |    0 | starting                                                      | show processlist |
|  4 | slave | 172.16.59.143:41676 | NULL | Binlog Dump |   72 | Master has sent all binlog to slave; waiting for more updates | NULL             |
|  5 | slave | 172.16.59.142:45184 | NULL | Binlog Dump |   59 | Master has sent all binlog to slave; waiting for more updates | NULL             |
+----+-------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>二、从库上查看状态</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">root@localhost: [ (none) ]&gt;  show slave status \G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 172.16.59.141
                  Master_User: slave
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000003
          Read_Master_Log_Pos: 841
               Relay_Log_File: mysql-slave01-relay-bin.000002
                Relay_Log_Pos: 320
        Relay_Master_Log_File: mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><font color="red">注意观察：</font></p>
<blockquote>
<p>I/O 线程 和SQL线程的状态是yes, 两个线程必须为也开启状态</p>
<p>Slave_IO_Running: Yes<br>Slave_SQL_Running: Yes</p>
</blockquote>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>promethues安装之二进制</title>
    <url>/blog/2021/10/28/promethues%E5%AE%89%E8%A3%85%E4%B9%8B%E4%BA%8C%E8%BF%9B%E5%88%B6/</url>
    <content><![CDATA[<h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="安装方式："><a href="#安装方式：" class="headerlink" title="安装方式："></a><strong>安装方式：</strong></h2><ul>
<li><p><a href><strong>使用预编译的二进制文件</strong></a></p>
</li>
<li><p><a href><strong>源码安装</strong></a></p>
</li>
<li><p><a href><strong>docker 安装</strong></a></p>
</li>
</ul>
<h2 id="二进制安装"><a href="#二进制安装" class="headerlink" title="二进制安装"></a>二进制安装</h2><h6 id="2-1-下载并运行-Prometheus"><a href="#2-1-下载并运行-Prometheus" class="headerlink" title="2.1   下载并运行 Prometheus"></a><strong>2.1   下载并运行 Prometheus</strong></h6><p>如何安装、配置和使用一个简单的 Prometheus 实例。您将在本地下载并运行 Prometheus，将其配置为抓取自身和示例应用程序，然后处理查询、规则和图形以使用收集的时间序列数据。</p>
<p>为您的平台<a href="https://prometheus.io/download">下载最新版本</a>的 Prometheus，然后解压并运行它：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@abbott ~]# wget https:&#x2F;&#x2F;github.com&#x2F;prometheus&#x2F;prometheus&#x2F;releases&#x2F;download&#x2F;v2.29.2&#x2F;prometheus-2.29.2.linux-amd64.tar.gz
[root@abbott ~]# tar xf prometheus-2.29.2.linux-amd64.tar.gz  -C &#x2F;usr&#x2F;local&#x2F;
[root@abbott ~]# mv prometheus-2.29.2.linux-amd64 prometheus2.29.2
[root@abbott ~]# ln -s prometheus2.29.2 prometheus<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.2  在启动 Prometheus 之前，让我们查看下住配置文件</strong></p>
<h6 id="配置-Prometheus-监控自身"><a href="#配置-Prometheus-监控自身" class="headerlink" title="配置 Prometheus 监控自身"></a>配置 Prometheus 监控自身</h6><p>Prometheus通过抓取指标 HTTP 端点从<em>目标</em>收集指标。由于 Prometheus 以与自身相同的方式公开数据，因此它还可以抓取和监控自身的健康状况。</p>
<p>虽然仅收集有关自身数据的 Prometheus 服务器不是很有用，但它是一个很好的入门示例。将以下基本 Prometheus 配置保存为名为 的文件<code>prometheus.yml</code>：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@abbott local<span class="token punctuation">]</span><span class="token comment"># vim prometheus/prometheus.yml</span>
<span class="token comment"># my global config</span>
<span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s <span class="token comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span>
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s <span class="token comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span>
  <span class="token comment"># scrape_timeout is set to the global default (10s).</span>
<span class="token comment"># Alertmanager configuration</span>
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
          <span class="token comment"># - alertmanager:9093</span>

<span class="token comment"># Load rules once and periodically evaluate them according to the global 'evaluation_interval'.</span>
<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
  <span class="token comment"># - "first_rules.yml"</span>
  <span class="token comment"># - "second_rules.yml"</span>

<span class="token comment"># A scrape configuration containing exactly one endpoint to scrape:</span>
<span class="token comment"># Here it's Prometheus itself.</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token comment"># The job name is added as a label `job=&lt;job_name>` to any timeseries scraped from this config.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">"prometheus"</span>

    <span class="token comment"># metrics_path defaults to '/metrics'</span>
    <span class="token comment"># scheme defaults to 'http'.</span>

    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"localhost:9090"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>2.3 启动普罗米修斯</strong></p>
<pre class="line-numbers language-sehll" data-language="sehll"><code class="language-sehll">[root@abbott prometheus]# .&#x2F;prometheus  &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>普罗米修斯应该启动。您还应该能够在<a href="http://localhost:9090/">localhost:9090</a>浏览到关于它自己的状态页面。给它几秒钟从它自己的 HTTP 指标端点收集关于它自己的数据。</p>
<p>您还可以通过导航到其指标端点来验证 Prometheus 是否正在提供有关其自身的指标： localhost:9090/metrics</p>
<p><strong>2.4 同步时间</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@abbott prometheus]# yum install  -y  ntpdate
[root@abbott prometheus]# ntpdate  ntp.aliyun.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h5 id><a href="#" class="headerlink" title></a></h5>]]></content>
      <categories>
        <category>监控系统</category>
      </categories>
      <tags>
        <tag>prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title>初始监控系统及软件</title>
    <url>/blog/2021/12/04/%E5%88%9D%E5%A7%8B%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E5%8F%8A%E8%BD%AF%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="监控系统简介"><a href="#监控系统简介" class="headerlink" title="监控系统简介"></a>监控系统简介</h1><hr>
<p><strong>为何需要监控</strong></p>
<p>​    在一个IT环境中会存在各种各样的设备，例如：硬件设备、软件设备系统的构成也是非常复杂的。</p>
<p>​    多种应用构成复杂的IT业务系统，保证这些资源的正常运转，是一个公司IT部门的职责，而要让这些应用能够正常地运行，则需要专业IT人员进行设计、架构、维护和调优。在这个过程中，为了及时掌控基础环境和业务应用系统的可用性，需要获取各个组件的运行状态，如CPU的利用率、系统负载、服务的运行、端口的连通、带宽流量、网站访问状态码等信息。而这一切都离不开监控系统。</p>
<p><strong>监控系统的实现</strong></p>
<p>一个监控系统的组成大体可以分为两部分：数据采集部分（客户端）和数据存储分析告警展示部分（服务端）</p>
<p><strong>数据采集：</strong>工作模式可以分为被动模式和主动模式</p>
<ul>
<li><p>被动模式：服务端到客户端采集数据</p>
</li>
<li><p>主动模式：客户端主动上报数据到服务端</p>
</li>
</ul>
<p><strong>数据采集方式：</strong>专用客户端采集和共用协议采集 </p>
<h1 id="监控系统的软件"><a href="#监控系统的软件" class="headerlink" title="监控系统的软件"></a>监控系统的软件</h1><hr>
<p>在监控软件中，开源的解决方案有流量监控（MRTG、Cati、SmokePing、Craphite等）和性能告警（Nagios、Zabbix、Zenoss Core、Ganglia、OpenTSDB等）可供选择，并且每种软件都有自己的特点和功能，各自的侧重点和目标不完全相同，在设计理念和实现方法上也大同小异，但都具有共同特征，例如：采集数据、分析展示、告警以及简单的故障自动处理。</p>
<p><strong>MRTG</strong></p>
<hr>
<p>MRTG（Multi Router Traffic Grapher）是一套可用来绘制流量图的软件，由瑞士奥尔滕的Tobias Oetiker与Dave Rand所开发，以GPL授权。</p>
<p>MRTG最早的版本是在1995年推出的，用Perl语言写成，可夸平台使用，数据采集用SNMP协议，MRTG将收集到的数据通过Web页面以GIF或PNG格式绘制出图像，并以日、周、月为单位分别绘出，可以查询最大值和最小值。</p>
<p>现在出了各种插件，因此也可以监控服务器的硬盘使用量、CPU的负载等</p>
<p><img src="https://cdn.pcwdld.com/wp-content/uploads/gui-screenshot.jpg" class="lazyload placeholder" data-srcset="https://cdn.pcwdld.com/wp-content/uploads/gui-screenshot.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Best MRTG Alternatives for Network Monitoring &amp; Traffic Graphing 2021"></p>
<p><strong>Cacti</strong></p>
<hr>
<p>Cacti(英文含义为仙人掌)是一套基于PHP、MySQL、SNMP和RRDtool开发的网络流量监测图形分析工具，</p>
<p><img src="https://www.linuxidc.com/upload/2012_09/120921143047331.jpg" class="lazyload placeholder" data-srcset="https://www.linuxidc.com/upload/2012_09/120921143047331.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Cacti监控H3C交换机不显示端口解决办法"></p>
<p><strong>SmokePing</strong></p>
<hr>
<p>SmokePing主要用于监控网络性能，包括常规的ping、www服务器性能DNS查询性能、SSH性能等，底层也用RRDtool做支持，特点是绘制的图非常漂亮，网络丢吧和延迟用颜色和阴影来表示，支持将多张叠放在一起.</p>
<p><img src="https://oss.oetiker.ch/smokeping/doc/reading_multihost.png" class="lazyload placeholder" data-srcset="https://oss.oetiker.ch/smokeping/doc/reading_multihost.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="示例多主机图"></p>
<p><strong>Graphite</strong></p>
<hr>
<p>Graphite 是一个用于采集网站实时信息进行统计的开源项目。Graphite服务支持平均每分钟4800次更新操作，采用简单文本协议，具有绘图功能，其即插即用的功能可方便地用于任何需要监控的系统上。</p>
<p>Graphite本身并不收集具体的数据，这些数据收集的工作通常由第三方工具或插件完成，因此，可以说Graphite是一个绘图工具。</p>
<p><strong>Nagios</strong></p>
<hr>
<p>Nagios 是一个企业级的监控系统，可监控服务的运行状态和网络信息等，并能监视所有指定的本地或远程主机参数以及服务，同时提供异常告警通知功能等；</p>
<p>Nagios可运行在Linux和Unix平台上，同时提供一个可选的基于浏览器的web界面，以方便管理人员的可用性，能及时根据触发条件告警。</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/4/48/ScalableGridEngineNagios2.png" class="lazyload placeholder" data-srcset="https://upload.wikimedia.org/wikipedia/commons/4/48/ScalableGridEngineNagios2.png" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="img"></p>
<p><strong>Zenoss Core</strong></p>
<hr>
<p>Zenoss Core (简称：Zenoss)是开源企业级IT管理软件，它允许IT管理依靠单一的web控制台来监控网络架构的状态和监控度。</p>
<p><strong>Ganglia</strong></p>
<hr>
<p>Ganglia 是一个跨平台的、可扩展的、高性能的分布式监控系统，如集群和网络。它基于分层设计，使用广泛的技术，用RRDtool存储数据，具有可视化界面，适合于对集群系统的自动化监控。其精心设计的数据结构和算法使得监控端到被监控端的连接开销非常低。目前已经有成千上万的集群正在使用这个监控系统，可以轻松地处理2000个节点的集群环境。</p>
<p><strong>OpenTSDB</strong></p>
<hr>
<p>开源监控系统openTSDB用HBase存储所有时序（无需采样）的数据，来构建一个分布式、可伸缩的时间序列数据库。它支持秒级数据采集，支持永久存储，可以做容量规划，并很容易地接入到现有的告警系统里，OpenTSDB可以从大规模的集群（包括集群中的网络设备、操作系统、应用程序）中获取相应的采集指标，并进行存储、索引和服务，从而使这些数据更容易让人理解，如WEB化、图形化等</p>
<p><strong>Zabbix</strong></p>
<hr>
<p>Zabbix 是一个分布式监控系统，支持多种采集方式和采集客户端，有专用的Agent（代理），也可以支持SNMP、IPMI、JMX、等多种协议，它将采集的数据存放到数据库，然后对其进行分析整理，达到条件触发告警。</p>
<p><strong>监控系统的原理</strong></p>
<hr>
<p><strong>监控的诞生</strong></p>
<p>对出现的故障，能及时通知告警和故障的自动修复，对运维人员响应处理故障的速度会大大加快，甚至在异常严重的故障情况下，对及时采用应急预案，有不可或缺的作用，如果没有监控，故障的反馈往往来自用户的报告，然后才由运维人员处理。</p>
<p><strong>监控系统的实现</strong></p>
<p>监控系统往往需要对物理硬件和应用软件的性能和参数进行数据汇集，实现集中管理和统一分析。</p>
<p>在一个监控系统中，构成要素为监控服务器端程序、数据存储、被采集节点等相关模块，其告警分析和自动故障处理功能由服务器执行。</p>
<p>监控系统需要提供一个API，方便其他功能系统对监控数据进行管理，这在业务系统精密的情况下显得特别重要，通常对外提供API功能的软件；</p>
<p><strong>监控系统性能指标</strong></p>
<table>
<thead>
<tr>
<th>监控项目</th>
<th>详细内容</th>
</tr>
</thead>
<tbody><tr>
<td>主机监控</td>
<td>CPU、内存、磁盘的剩余空间/利用率/I/O SWAP使用率、系统UP时间、进程数、负载</td>
</tr>
<tr>
<td>网卡监控</td>
<td>ping的往返时间及包成功率、网卡流量，包括流入/流出量和错误的数据包数</td>
</tr>
<tr>
<td>文件监控</td>
<td>监控文件大小，Hash值，匹配查询、字符串存在与否</td>
</tr>
<tr>
<td>URL监控</td>
<td>监测指定URL访问过程中的返回码、下载时间及文件大小、支持内容匹配</td>
</tr>
<tr>
<td>应用程序</td>
<td>端口和内存使用率、CPU使用率、服务状态、请求数、并发连接数、消息队列的字节数、<br>Client事务处理数、service状态等</td>
</tr>
<tr>
<td>数据库</td>
<td>监控数据库中指定的表空间、数据库的游标数、Session数、事务数、死锁数、缓冲池命中率、<br>库Cache命中率、当前连接数、进程的内存利用率等性能参数</td>
</tr>
<tr>
<td>日志</td>
<td>错误日志匹配、特定字符串匹配</td>
</tr>
<tr>
<td>硬件</td>
<td>温度、风扇转速、电压等</td>
</tr>
</tbody></table>
<p><strong>监控系统对时间的要求</strong></p>
<p>监控系统需要根据实际应用的需求，实时/非实时地采集和展示数据。另外，包括历史趋势数据的展示和分析，以及容量报表、可用性报告的生成。</p>
<p><strong>监控系统的告警需要</strong></p>
<p>支持多种方式，如短信、邮件、IM和其他接口，具备可定制化功能，对第三方告警介质提供可编程接口。</p>
]]></content>
      <categories>
        <category>监控系统</category>
      </categories>
  </entry>
  <entry>
    <title>安装Docker</title>
    <url>/blog/2021/12/04/%E5%AE%89%E8%A3%85Docker/</url>
    <content><![CDATA[<h1 id="安装引擎"><a href="#安装引擎" class="headerlink" title="安装引擎"></a><strong>安装引擎</strong></h1><p>docker 引擎是使用docker容器的核心组件，可以在主流的操作系统和云平台上使用。</p>
<p>docker 可以安装Linux操作系统 MacOS Windows系统之上以及云平台之上。</p>
<h2 id="Centos-环境下安装docker"><a href="#Centos-环境下安装docker" class="headerlink" title="Centos 环境下安装docker"></a>Centos 环境下安装docker</h2><p>  安装<code>yum-utils</code>软件包（提供<code>yum-config-manager</code> 实用程序）并设置<strong>稳定的</strong>存储库。</p>
  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker ~]# yum install -y yum-utils
[root@docker ~]# yum-config-manager \
     --add-repo \
    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="安装最新版本Docker-Engine"><a href="#安装最新版本Docker-Engine" class="headerlink" title="安装最新版本Docker Engine"></a>安装最新版本Docker Engine</h3>  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker]# yum install docker-ce docker-ce-cli containerd.io -y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3>  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker ~]# systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h3>  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@docker ~]# docker version   #查看版本信息
[root@docker ~]# docker info			#查看docker详细信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="ubunt-环境下安装docker"><a href="#ubunt-环境下安装docker" class="headerlink" title="ubunt 环境下安装docker"></a>ubunt 环境下安装docker</h2>  <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">@buntu:~$ sudo apt-get install \
     apt-transport-https \
     ca-certificates \
     curl \
     gnupg \
     lsb-release
@buntu:~$  echo   &quot;deb [arch&#x3D;amd64 signed-by&#x3D;&#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;docker-archive-keyring.gpg] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu \
  $(lsb_release -cs) stable&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;docker.list &gt; &#x2F;dev&#x2F;null
     
@ubuntu:~$  curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu&#x2F;gpg | sudo gpg --dearmor -o &#x2F;usr&#x2F;share&#x2F;keyrings&#x2F;docker-archive-keyring.gpg
@buntu:~$  sudo apt-get update
@buntu:~$  sudo apt-get install docker-ce docker-ce-cli containerd.io
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="开启路由转发"><a href="#开启路由转发" class="headerlink" title="开启路由转发"></a><strong>开启路由转发</strong></h1><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#查看路由转发是否开启，1 开发 0 未开启
[root@docker ~]# sysctl -a | grep -w net.ipv4.ip_forward
net.ipv4.ip_forward &#x3D; 1
#开启路由转发功能
[root@docker ~]# cat &gt; &#x2F;etc&#x2F;sysctl.d&#x2F;docker.conf &lt;&lt; EOF
net.ipv4.ip_forward &#x3D; 1
net.bridge.bridge-nf-call-ip6tables &#x3D; 1
net.bridge.bridge-nf-call-iptables &#x3D; 1
EOF
#加载并生效（不用重新启动服务器）
[root@docker ~]# sysctl -p &#x2F;etc&#x2F;sysctl.d&#x2F;docker.conf <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="配置docker加速器"><a href="#配置docker加速器" class="headerlink" title="配置docker加速器"></a><strong>配置docker加速器</strong></h1><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">阿里docker镜像加速器地址
https:&#x2F;&#x2F;cr.console.aliyun.com&#x2F;cn-hangzhou&#x2F;instances&#x2F;mirrors 
配置docker镜像加速器文件地址
vim &#x2F;etc&#x2F;docker&#x2F;daemon.json
&#123;
  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;0pnfs8l6.mirror.aliyuncs.com&quot;]
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="docker-命令解释"><a href="#docker-命令解释" class="headerlink" title="docker 命令解释"></a><strong>docker 命令解释</strong></h1><p><img src="https://oss.coydone.com/md/linux/20201027083323.png/change01" class="lazyload placeholder" data-srcset="https://oss.coydone.com/md/linux/20201027083323.png/change01" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Docker命令、镜像及容器卷- coydone的技术小站"></p>
]]></content>
      <categories>
        <category>Container</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>认识Kubernetes</title>
    <url>/blog/2021/11/24/%E8%AE%A4%E8%AF%86Kubernetes/</url>
    <content><![CDATA[<h2 id="一、Kubernetes-基础"><a href="#一、Kubernetes-基础" class="headerlink" title="一、Kubernetes 基础"></a>一、Kubernetes 基础</h2><h3 id="1-1-Kubernetes-概述"><a href="#1-1-Kubernetes-概述" class="headerlink" title="1.1 Kubernetes 概述"></a>1.1 Kubernetes 概述</h3><p><strong>Kubernetes 是什么</strong></p>
<p>Kubernetes(k8s)是Google开源由CNCF基金会管理的容器集群管理系统。为容器化的应用提供部署运行、资源调度、服务发现和动态伸缩等一系列完整功能。Kubernetes 被称为现在化的数据中心操作系统，大家都知道，操作系统是用来管理硬件资源比如 CPU、内存、磁盘、输入输出设备等资源的，并完成对这些资源的调度。而 Kubernetes 是将数据中心里的物理节点作为管理对象，并对物理节点上的资源进行调度完成编排任务。操作系统的另一个特性就是容易扩展，比如，当 GPU 这种硬件出现后，操作系统应该很容扩展去管理这种资源，Kubernetes 作为数据中心操作系统同样也有这样的特性，它也非常容易扩展。</p>
<h3 id="1-2-Kubernetes-架构"><a href="#1-2-Kubernetes-架构" class="headerlink" title="1.2 Kubernetes 架构"></a>1.2 Kubernetes 架构</h3><p>Kubernetes 的架构从宏观层面的来讲分为两个平面，即控制平面和计算平面，控制平面又称为 Master 节点，Master 节点是整个集群的大脑，负责控制、调度集群资源；计算平面又称为 Node 节点，Node 节点负责运行工作负载，是 Master 节点调度的对象。kubectl 作为 Kubernetes 客户端通过和 Master 节点直接进行通信来控制 Kubernetes 集群。</p>
<p><img src="https://static.sitestack.cn/projects/findsec-cn-k101/ff848a52a7f77f9f4497ad60b889bc47.jpeg" class="lazyload placeholder" data-srcset="https://static.sitestack.cn/projects/findsec-cn-k101/ff848a52a7f77f9f4497ad60b889bc47.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Kubernetes 架构"></p>
<h4 id="控制节点"><a href="#控制节点" class="headerlink" title="控制节点"></a><strong>控制节点</strong></h4><p><img src="https://static.sitestack.cn/projects/findsec-cn-k101/107314fa7aada6337a4308e493a9c371.jpeg" class="lazyload placeholder" data-srcset="https://static.sitestack.cn/projects/findsec-cn-k101/107314fa7aada6337a4308e493a9c371.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Kubernetes Master"></p>
<ul>
<li>kube-apiserver 对外暴露 Kubernetes API，所有对集群的操作都是通过这组API完成，包括客户端下达应用编排命令给 Kubernetes 集群；kubelet 上报集群资源使用情况；以及各个组件之间的交互都是通过这套 API 完成的。</li>
<li>kube-controller-manager 负责整个 Kubernetes 的管理工作，保证集群中各种资源处于期望状态，当监控到集群中某个资源状态与期望状态不符时，controller-manager 会触发调度操作。</li>
<li>kube-scheduler 调度器负责 Kubernetes 集群的具体调度工作，接收来自于controller-manager 触发的调度操作请求，然后根据请求规格、调度约束、整体资源情况进行调度计算，最后将任务发送到目标节点由的kubelet组件执行。</li>
<li>etcd 是一个高效KV存储系统。在Kubernetes环境中主要用于存储所有需要持久化的数据。</li>
</ul>
<h4 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a><strong>计算节点</strong></h4><p><img src="https://static.sitestack.cn/projects/findsec-cn-k101/1166470bbbf8663f9d9e01f8af0334ff.jpeg" class="lazyload placeholder" data-srcset="https://static.sitestack.cn/projects/findsec-cn-k101/1166470bbbf8663f9d9e01f8af0334ff.jpeg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Kubernetes Node"></p>
<ul>
<li><p>kubelet 是 Node 节点上核心组件，负责与 docker daemon 进行交互运行 docker 容器；配置网络和数据卷；监控并上报节点资源使用情况。</p>
</li>
<li><p>kube-proxy 主要负责 Service Endpoint 到 POD 实例的请求转发及负载均衡的规则管理。</p>
</li>
</ul>
<h3 id="1-3-Kubernetes-解决了什么问题"><a href="#1-3-Kubernetes-解决了什么问题" class="headerlink" title="1.3 Kubernetes 解决了什么问题"></a>1.3 Kubernetes 解决了什么问题</h3><p>Kubernetes 项目最主要的设计思想是，从更宏观的角度，以统一的方式来定义任务之间的各种关系，更甚至我们可以运用 Kubernetes 扩展能力灵活的自定义任务之间的关系。</p>
<p>比如，Kubernetes 项目对容器间的交互关系进行了分类，首先总结出了一类非常常见的“紧密交互”的关系，即：这些应用之间需要直接通过本地文件进行信息交换。</p>
<p>在常规环境下，这些应用往往会被直接部署在同一台机器上，通过 Localhost 通信，通过本地磁盘上的文件进行交互。而在 Kubernetes 项目中，这些容器则会被划分为一个“Pod”，Pod 里的容器共享同一个 Network Namespace、同一组数据卷，从而达到高效率交换信息的目的。</p>
<p>Pod 是 Kubernetes 项目中最基础的一个对象，下一章中我会重中想你介绍 Pod。</p>
<p>而对于另外一种更为常见的需求，比如 Web 应用与数据库之间的访问关系，Kubernetes 项目则提供了一种叫作“Service”的服务。像这样的两个应用，往往故意不部署在同一台机器上，这样即使 Web 应用所在的机器宕机了，数据库也完全不受影响。可是，我们知道，对于一个容器来说，它的 IP 地址等信息不是固定的，那么 Web 应用又怎么找到数据库容器的 Pod 呢？</p>
<p>所以，Kubernetes 项目的做法是给 Pod 绑定一个 Service 服务，而 Service 服务声明的 IP 地址等信息是“终生不变”的。这个Service 服务的主要作用，就是作为 Pod 的代理入口，从而代替 Pod 对外暴露一个固定的网络地址。</p>
<p>除了 Pod、Service 这些基本资源外，Kubernetes 还为我们提供了 Deployment、StatefulSet、Job 等扩展资源，有了这些资源我们就可以轻松的编排我们的服务了，通过这些资源，Kubernetes 为我们提供了应用的水平扩展、滚动升级、自动扩缩容能力，为服务提供了负责均衡、服务监控、服务发现能力。通过这些高级功能以及其灵活的扩展能力使 Kubernetes 逐渐成为了容器编排领域的翘楚。</p>
<h4 id="Kubernetes-组件"><a href="#Kubernetes-组件" class="headerlink" title="Kubernetes 组件"></a><strong>Kubernetes 组件</strong></h4><p>当你部署完 Kubernetes, 即拥有了一个完整的集群。</p>
<p>一个 Kubernetes 集群由一组被称作节点的机器组成。这些节点上运行 Kubernetes 所管理的容器化应用。集群具有至少一个工作节点。</p>
<p>工作节点托管作为应用负载的组件的 Pod 。控制平面管理集群中的工作节点和 Pod 。 为集群提供故障转移和高可用性，这些控制平面一般跨多主机运行，集群跨多个节点运行。</p>
<p>本文档概述了交付正常运行的 Kubernetes 集群所需的各种组件。</p>
<p>这张图表展示了包含所有相互关联组件的 Kubernetes 集群。</p>
<p><img src="https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg" class="lazyload placeholder" data-srcset="https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="Kubernetes 组件"></p>
<h3 id="1-4-Kubernetes-集群搭建"><a href="#1-4-Kubernetes-集群搭建" class="headerlink" title="1.4 Kubernetes 集群搭建"></a>1.4 Kubernetes 集群搭建</h3><h4 id="1-4-1-使用-Docker-CE-自带的-Kubernetes"><a href="#1-4-1-使用-Docker-CE-自带的-Kubernetes" class="headerlink" title="1.4.1 使用 Docker CE 自带的 Kubernetes"></a>1.4.1 使用 Docker CE 自带的 Kubernetes</h4><p>安装 Docker 参考：<a href="https://docs.docker.com/install/">https://docs.docker.com/install/</a></p>
<ul>
<li>Install Docker for Mac</li>
<li>Install Docker for Windows</li>
</ul>
<h4 id="1-4-2-使用-minikube"><a href="#1-4-2-使用-minikube" class="headerlink" title="1.4.2 使用 minikube"></a>1.4.2 使用 minikube</h4><h5 id="MacOS-安装-minikube"><a href="#MacOS-安装-minikube" class="headerlink" title="MacOS 安装 minikube"></a><strong>MacOS 安装 minikube</strong></h5><ul>
<li><p><strong>安装minikube</strong></p>
<p>brew cask install minikube</p>
</li>
<li><p><strong>安装vm驱动</strong></p>
<p>curl -LO <a href="https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-hyperkit">https://storage.googleapis.com/minikube/releases/latest/docker-machine-driver-hyperkit</a> \n&amp;&amp; sudo install -o root -g wheel -m 4755 docker-machine-driver-hyperkit /usr/local/bin/</p>
</li>
<li><p>启动 minikube(minikube会安装kubernetes需要的组件，这些组件的镜像存储在google的常客中，所有需要能够翻墙才能够安装成功)</p>
<p>minikube start —vm-driver=hyperkit —memory=4096 —insecure-registry=”hub.example.com” —registry-mirror=”<a href="https://m9sl8pb5.mirror.aliyuncs.com/">https://m9sl8pb5.mirror.aliyuncs.com</a>“ —docker-opt=”bip=172.87.0.1/16”</p>
<p>参数介绍: —vm-driver 使用的虚拟机驱动 —memory 给虚拟机的内存大小 —cpu 给虚拟机的cpu核数，默认是2核 —insecure-registry 指定私有仓库地址 —registry-mirror 指定镜像缓存地址，加快镜像下载速度 —docker-opt 指定docker的启动参数，bip 指定 docker 网桥使用的网段</p>
</li>
<li><p><strong>停止 minikube</strong></p>
<p>minikube stop</p>
</li>
<li><p><strong>删除集群</strong></p>
<p>minikube delete</p>
</li>
<li><p><strong>登录虚拟机</strong></p>
<p>minikube ssh</p>
</li>
</ul>
<h5 id="Windows-安装-minikube"><a href="#Windows-安装-minikube" class="headerlink" title="Windows 安装 minikube"></a><strong>Windows 安装 minikube</strong></h5><p>Windows 安装minikube，需要Windows系统支持Hyper-V，目前 Windows 10 Enterprise, Windows 10 Professional, and Windows 10 Education 支持Hyper-V。安装minikube时，最好命令行使用powershell，并且以管理员身份打开并执行。</p>
<h6 id="安装方法-1："><a href="#安装方法-1：" class="headerlink" title="安装方法 1："></a>安装方法 1：</h6><ul>
<li>安装 <a href="https://chocolatey.org/">https://chocolatey.org/</a></li>
<li>choco install minikube kubernetes-cli</li>
</ul>
<h6 id="安装方法-2："><a href="#安装方法-2：" class="headerlink" title="安装方法 2："></a>安装方法 2：</h6><p>下载 minikube-installer.exe （<a href="https://github.com/kubernetes/minikube/releases/latest%EF%BC%89%E5%B9%B6%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%E3%80%82">https://github.com/kubernetes/minikube/releases/latest）并进行安装。</a></p>
<p>启动前准备(重要)</p>
<ul>
<li>配置 MINIKUBE_HOME 环境变量及创建目录</li>
<li>在 Hyper-V 中为minikube添加虚拟交换机</li>
<li>用 chocolatey 安装 OpenSSH（choco install openssh）</li>
</ul>
<h6 id="启动-minikube"><a href="#启动-minikube" class="headerlink" title="启动 minikube"></a>启动 minikube</h6><pre class="line-numbers language-none"><code class="language-none">minikube start --vm-driver&#x3D;hyperv --hyperv-virtual-switch&#x3D;minikube --memory&#x3D;4096 --insecure-registry&#x3D;&quot;hub.example.com&quot; --registry-mirror&#x3D;&quot;https:&#x2F;&#x2F;m9sl8pb5.mirror.aliyuncs.com&quot; --docker-opt&#x3D;&quot;bip&#x3D;172.87.0.1&#x2F;16&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>1.5 访问Kubernetes</p>
]]></content>
      <categories>
        <category>kubernetes系列</category>
      </categories>
      <tags>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>RAID</title>
    <url>/blog/2022/04/03/RAID/RAID/</url>
    <content><![CDATA[<h1 id="RAID磁盘阵列"><a href="#RAID磁盘阵列" class="headerlink" title="RAID磁盘阵列"></a>RAID磁盘阵列</h1><p>早在1978年，美国加州大学伯克利分校就提出了RAID（Redundant Array of Independent DIsk）虚拟存储系统。RAID即独立冗余磁盘阵列；其思想是将多块独立的磁盘按不同的方式组合为一个逻辑磁盘，从而提高存储容量，提升存储性能或提供数据备份功能。RAID存储系统的组合方式根据RAID基本定义。</p>
<p>RAID分为软件RAID和硬件RAID两类。在现有的操作系统中。如windows、Linux、Unix等已经集成了软RAID的功能。软件RAID可以实现与硬件RAID相同的功能，当由于其没有独立的硬件控制设备，所以性能不如硬件RAID，但软件RAID实现简单，不需要额外的硬件设备。硬件RAID通常需要有RAID卡，RAID卡本身会有独立控制部件和内存，所以不会占有系统资源，效率高、性能强。当然目前市面的大部分主板已经继承了RAID卡，具体使用方式可以参考硬件说明书</p>
<h2 id="RAID-级别"><a href="#RAID-级别" class="headerlink" title="RAID 级别"></a>RAID 级别</h2><h3 id="1、-RAID-0-（不含校验与冗余的条带存储）"><a href="#1、-RAID-0-（不含校验与冗余的条带存储）" class="headerlink" title="1、 RAID 0 （不含校验与冗余的条带存储）"></a>1、 RAID 0 （不含校验与冗余的条带存储）</h3><p>在 RAID 0 系统中，数据被分成块，这些块被写入阵列中的所有驱动器。通过同时使用多个磁盘（至少 2 个），这提供了卓越的 I/O 性能。通过使用多个控制器（理想情况下每个磁盘一个控制器）可以进一步增强这种性能。</p>
<p><strong>RAID 0 的优点</strong></p>
<ul>
<li>RAID 0 在读取和写入操作方面都提供了出色的性能。奇偶校验控制不会导致开销。</li>
<li>使用所有存储容量，没有开销。</li>
<li>该技术易于实施。</li>
</ul>
<p><strong>RAID 0 的缺点</strong></p>
<ul>
<li>RAID 0 不是容错的。如果一个驱动器发生故障，RAID 0 阵列中的所有数据都将丢失。它不应用于关键任务系统。</li>
</ul>
<h3 id="2、-RAID-1-（不含校验的镜像存储）"><a href="#2、-RAID-1-（不含校验的镜像存储）" class="headerlink" title="2、 RAID 1 （不含校验的镜像存储）"></a>2、 RAID 1 （不含校验的镜像存储）</h3><p>通过将数据写入数据驱动器（或数据驱动器组）和镜像驱动器（或驱动器组），数据被存储两次。如果驱动器发生故障，控制器将使用数据驱动器或镜像驱动器进行数据恢复和连续操作。RAID 1 阵列至少需要 2 个驱动器。</p>
<p><strong>RAID 1 的优点</strong></p>
<ul>
<li>RAID 1 提供出色的读取速度和与单个驱动器相当的写入速度。</li>
<li>如果驱动器发生故障，则不必重建数据，只需将它们复制到替换驱动器即可。</li>
<li>RAID 1 是一种非常简单的技术。</li>
</ul>
<p><strong>RAID 1 的缺点</strong></p>
<ul>
<li>主要缺点是有效存储容量仅为驱动器总容量的一半，因为所有数据都被写入两次。</li>
<li>软件RAID 1解决方案并不总是允许失败的驱动器的热插拔。这意味着只有在关闭计算机上的计算机下电后才只能替换失败的驱动器。对于许多人同时使用的服务器，这可能是不可接受的。这些系统通常使用支持热插拔的硬件控制器。</li>
</ul>
<h3 id="3、-RAID-3-（字节级别的校验式条带存储）"><a href="#3、-RAID-3-（字节级别的校验式条带存储）" class="headerlink" title="3、 RAID 3 （字节级别的校验式条带存储）"></a>3、 RAID 3 （字节级别的校验式条带存储）</h3><p>该级别的磁盘阵列可以参考RAID 2 的读写原理，仅数据分割的单位为字节。å</p>
<h3 id="4、-RAID-4-（数据块级别的校验式条带存储）"><a href="#4、-RAID-4-（数据块级别的校验式条带存储）" class="headerlink" title="4、 RAID 4 （数据块级别的校验式条带存储）"></a>4、 RAID 4 （数据块级别的校验式条带存储）</h3><p>该级别的磁盘阵列与RAID 2 类似，仅数据分割单位不同。</p>
<h3 id="5、-RAID-5（数据库级别的分布式校验条带存储）"><a href="#5、-RAID-5（数据库级别的分布式校验条带存储）" class="headerlink" title="5、 RAID 5（数据库级别的分布式校验条带存储）"></a>5、 RAID 5（数据库级别的分布式校验条带存储）</h3><p>RAID-5具有和RAID-0相近似的数据读取速度，同时磁盘空间利用率也要比RAID1高。属于是RAID-0和RAID-1的折中方案，是一种存储性能、数据安全和存储成本兼顾的存储解决方案。由于存储成本相对较低，是目前运用较多的一种解决方案。<br>      RAID-5阵列中数据的分布与RAID-0类似，数据也是分布到每块硬盘上，但Raid-5没有独立的奇偶校验盘，他通过将校验的数据循环存储并分散放在所有磁盘上，其中任意N-1块磁盘上都存储完整的数据，也就是说有相当于一块磁盘容量的空间用于存储奇偶校验信息。因此当RAID5能够支持在一块盘离线的情况下保证数据的正常访问，不会影响数据的完整性，从而保证了数据安全。当损坏的磁盘被替换后，RAID还会自动利用剩下奇偶校验信息去重建此磁盘上的数据，来保持RAID5的高可靠性。<br>      RAID-5的组建，至少需要三块或更多的磁盘，并可以使用0块或更多的备用磁盘，其数据安全保障程度要比RAID1低，写入数据的速度比对单个磁盘进行写入速度稍慢。如果有两块或两块以上硬盘同时离线，或者RAID信息出错等原因，阵列便会失效，这时就需要对数据进行重组。并且做raid 5阵列所有磁盘容量必须一样大，当容量不同时，会以最小的容量为准。 同时，最好硬盘转速一样，否则会影响性能。</p>
<h3 id="6、-RAID-10-（镜像与条带存储）"><a href="#6、-RAID-10-（镜像与条带存储）" class="headerlink" title="6、 RAID 10 （镜像与条带存储）"></a>6、 RAID 10 （镜像与条带存储）</h3><p>RAID 1+0也被称为RAID-10标准，实际是将RAID-0和RAID-1标准结合的产物，是先对磁盘先进行RAID-1，然后RAID-0，这种方法即提供了冗余，而且也提升了速度。<br>      在连续地以位或字节为单位分割数据并且并行读/写多个磁盘的同时，为每一块磁盘作磁盘镜像进行冗余。它的优点是同时拥有RAID-0的超凡速度和RAID-1的数据高可靠性，但是CPU占用率同样也更高，而且磁盘的利用率比较低。由于利用了RAID-0极高的读写效率和RAID-1较高的数据保护、恢复能力，使RAID-10成为了一种性价比较高的等级，目前几乎所有的RAID控制卡都支持这一等级。</p>
<table>
<thead>
<tr>
<th align="center">RAID等级</th>
<th align="center">最少硬盘</th>
<th align="center">最大容错</th>
<th align="center">可用容量</th>
<th align="center">读取效能</th>
<th align="right">写入效能</th>
<th align="center">安全性</th>
<th align="center">目的</th>
<th align="center">应用产业</th>
</tr>
</thead>
<tbody><tr>
<td align="center">单一硬盘</td>
<td align="center">(参考)</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="right">1</td>
<td align="center">无</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">JBOD</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">n</td>
<td align="center">1</td>
<td align="right">1</td>
<td align="center">无（同RAID 0）</td>
<td align="center">增加容量</td>
<td align="center">个人（暂时）储存备份</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">0</td>
<td align="center">n</td>
<td align="center">n</td>
<td align="right">n</td>
<td align="center">一个硬盘异常，全部硬盘都会异常</td>
<td align="center">追求最大容量、速度</td>
<td align="center">影片剪接快取用途</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">n-1</td>
<td align="center">1</td>
<td align="center">n</td>
<td align="right">1</td>
<td align="center">高，一个正常即可</td>
<td align="center">追求最大安全性</td>
<td align="center">个人、企业备份</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">n-1</td>
<td align="center">n-1</td>
<td align="right">n-1</td>
<td align="center">中下至中</td>
<td align="center">追求最大容量、最小预算</td>
<td align="center">个人、小型企业备份</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">4</td>
<td align="center">2</td>
<td align="center">n-2</td>
<td align="center">n-2</td>
<td align="right">n-2</td>
<td align="center">中至中高,仅安全性较RAID 5高</td>
<td align="center">同RAID 5，但较安全</td>
<td align="center">个人、企业备份</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">4</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
<td align="center">高</td>
<td align="center">综合RAID 0/1优点，理论速度较快</td>
<td align="center">大型资料库、伺服器</td>
</tr>
<tr>
<td align="center">50</td>
<td align="center">6</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
<td align="center">高</td>
<td align="center">提升资料安全</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">60</td>
<td align="center">8</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
<td align="center">高</td>
<td align="center">提升资料安全</td>
<td align="center"></td>
</tr>
</tbody></table>
<h1 id="创建于管理软RIAD"><a href="#创建于管理软RIAD" class="headerlink" title="创建于管理软RIAD"></a>创建于管理软RIAD</h1><p>1、查看磁盘信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">fdisk -l<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、创建RAID 模式md0 </p>
<ul>
<li><p>命令：mdadm</p>
</li>
<li><p>描述：管理Linux软件RAID设备</p>
</li>
<li><p>用法：mdadm [模式] 选项 &lt;raid 设备&gt;</p>
</li>
<li><p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">—C， # 创建软件RAID
-n, --raid-devices&#x3D;   #指定空闲磁盘
-l  --level&#x3D;          #指定级别 （raid &#123;0, 1 , 5  10 &#125;）
-X, --examine-bitmap  #指定位图<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>示例 ：创建RAID 模式md0 </p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mdadm -C &#x2F;dev&#x2F;md0 -n3 -l5 -x1 &#x2F;dev&#x2F;*d&#123;d,e,f,g&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看raid状态：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cat &#x2F;proc&#x2F;mdstat

mdadm -D &#x2F;dev&#x2F;md0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>格式文件系统</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkfs.ext4 &#x2F;dev&#x2F;md0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>挂载使用：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mount &#x2F;dev&#x2F;md0 &#x2F;****
#开机自动挂载
vim &#x2F;etc&#x2F;fstab  
&#x2F;dev&#x2F;md0   &#x2F;****    ext4   defaulte     0   0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h1 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h1><h2 id="创建raid"><a href="#创建raid" class="headerlink" title="创建raid"></a>创建raid</h2><p>一、安装mdadm命令：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">root@localhost Packages]# yum -y install mdadm*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>命令：mdadm</p>
<p>语法：<strong>mdadm</strong> [mode] <raiddevice> [options] <component-devices></component-devices></raiddevice></p>
<p>示例：创建 RAID 5   <font color="red">注意：创建RAID前需要添加磁盘 4块以上</font></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mdadm 
--create  创建raid  &#x2F;dev&#x2F;md0
--level   创建raid级别 
--raid-devices  表示你要几块磁盘创建raid   设备
[root@localhost ~]# mdadm --create &#x2F;dev&#x2F;md0 --level&#x3D;5 --raid-devices&#x3D;4  &#x2F;dev&#x2F;sd[bcde]
mdadm: Defaulting to version 1.2 metadata
mdadm: array &#x2F;dev&#x2F;md0 started.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>二、格式化挂载使用</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mkfs.ext4 &#x2F;dev&#x2F;md0 
mke2fs 1.42.9 (28-Dec-2013)
Allocating group tables: 完成                            
正在写入inode表: 完成                            
Creating journal (32768 blocks): 完成
Writing superblocks and filesystem accounting information: 完成   

#创建挂载点并且挂载md0并使用
[root@localhost ~]# mkdir &#x2F;raid
[root@localhost ~]# mount &#x2F;dev&#x2F;md0  &#x2F;raid&#x2F;

#开机自动挂载,永久挂载

使用vim编辑&#x2F;etc&#x2F;fstab这个文件里添加一下内容，然后保存并退出
&#x2F;dev&#x2F;md0    &#x2F;raid        ext4     defaults   0 0 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>三、开机自动启动raid</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mdadm  -vDs
ARRAY &#x2F;dev&#x2F;md0 level&#x3D;raid5 num-devices&#x3D;4 metadata&#x3D;1.2 name&#x3D;localhost:0 UUID&#x3D;53ef68dc:4427e09b:c2232fc2:0e76643a
   devices&#x3D;&#x2F;dev&#x2F;sdb,&#x2F;dev&#x2F;sdc,&#x2F;dev&#x2F;sdd,&#x2F;dev&#x2F;sde
[root@localhost ~]# mdadm -vDs &gt; &#x2F;etc&#x2F;mdadm.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>四、重启测试</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">init 6  reboot <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h1 id="RAID-性能测试："><a href="#RAID-性能测试：" class="headerlink" title="RAID 性能测试："></a>RAID 性能测试：</h1><ul>
<li><p>普通磁盘：写入模拟</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">time dd if&#x3D;&#x2F;dev&#x2F;zero  of&#x3D;txt bs&#x3D;1M count&#x3D;1000
if&#x3D;文件名：输入文件名，默认为标准输入。即指定源文件。
of&#x3D;文件名：输出文件名，默认为标准输出。即指定目的文件。
count&#x3D;blocks：仅拷贝blocks个块，块大小等于ibs指定的字节数。
ibs&#x3D;bytes：一次读入bytes个字节，即指定一个块大小为bytes个字节。
obs&#x3D;bytes：一次输出bytes个字节，即指定一个块大小为bytes个字节。
bs&#x3D;bytes：同时设置读入&#x2F;输出的块大小为bytes个字节。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>磁盘管理</tag>
      </tags>
  </entry>
  <entry>
    <title>redis</title>
    <url>/blog/2024/01/10/redis/redis/</url>
    <content><![CDATA[<h1 id="NoSQL-数据库（非关系型数据库）"><a href="#NoSQL-数据库（非关系型数据库）" class="headerlink" title="NoSQL 数据库（非关系型数据库）"></a>NoSQL 数据库（非关系型数据库）</h1><h2 id="NoSQL-常用软件"><a href="#NoSQL-常用软件" class="headerlink" title="NoSQL 常用软件"></a>NoSQL 常用软件</h2><ul>
<li>Redis</li>
<li>MongoDB</li>
<li>Elasticsearch</li>
<li>memcached</li>
</ul>
<h1 id="Redis-数据库"><a href="#Redis-数据库" class="headerlink" title="Redis 数据库"></a>Redis 数据库</h1><h2 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h2><p>Redis  基于内存的非关系型数据库，<br>Redis是一个开源（BSD许可），内存数据结构存储，用作数据库、缓存、消息代理和流引擎。Redis提供数据结构，如字符串、哈希、列表、集合、带有范围查询的排序集、位图、超日志、地理空间索引和流。Redis具有内置的复制、Lua脚本、LRU驱逐、交易和不同级别的磁盘持久性，并通过Redis Sentinel提供高可用性和Redis Cluster的自动分区</p>
<p>Redis 可以通过内部的机制把数据持久化到本地磁盘中<br>Redis 也支持冗余的机制；也是实现高可用和主从架构</p>
<h2 id="NoSQL-的使用场景"><a href="#NoSQL-的使用场景" class="headerlink" title="NoSQL 的使用场景"></a>NoSQL 的使用场景</h2><ol>
<li>实时数据存储</li>
<li>缓存和会话存储<br>缓存   将使用比较频繁调用的数据调到缓存中<br>会话   Cookie —&gt; Session</li>
<li>流媒体和消息传递<br>消息队列： MQ  </li>
</ol>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>现在需要理解的是：</p>
<ol>
<li>什么NoSQL？</li>
<li>为什么要使用NoSQL数据库</li>
<li>分别在什么样场景下什么样的NoSQL</li>
</ol>
<h1 id="官网地址"><a href="#官网地址" class="headerlink" title="官网地址"></a>官网地址</h1><p><a href="https://redis.io/docs/install/install-redis/install-redis-from-source/">https://redis.io/docs/install/install-redis/install-redis-from-source/</a></p>
<h2 id="部署Redis"><a href="#部署Redis" class="headerlink" title="部署Redis"></a>部署Redis</h2><p>一、Redis 支持的平台</p>
<ul>
<li>Linux</li>
<li>MacOS</li>
<li>Windows</li>
<li>docker</li>
</ul>
<p>二、Redhat  8 版本上安装</p>
<p>2.1 源码安装</p>
<ol>
<li>下载源文件</li>
</ol>
<p>Redis源文件可从<a href="https://redis.io/download/">下载</a>页面获得。您可以通过对照redis-hashes git存储库中的摘要检查这些下载的完整性来验证这些下载的完整性。</p>
<p>要从Redis下载网站获取Redis最新稳定版本的源文件，请运行：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">tar xf redis-7.0.14.tar 
cd redis-7.0.14

[root@redis-server redis-7.0.14]# make  MALLOC&#x3D;libc
[root@redis-server redis-7.0.14]# make  install 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>启动Redis server</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@redis-server redis-7.0.14]# src&#x2F;redis-server     #前台启动方式

[root@redis-server redis-7.0.14]# src&#x2F;redis-server   &amp;  #指定后台运行

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><font color="red">默认端口：6379</font></p>
<ol start="3">
<li>连接测试：</li>
</ol>
<p>3.1 通过官方提供客户程序在本机访问<br>    - redis-cli<br>3.2 通过第三工具连接<br>3.3 通过代码实现连接</p>
<ul>
<li>Java</li>
<li>Python</li>
<li>golang</li>
<li>C ….</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#在本机上连接
[root@redis-server redis-7.0.14]# src&#x2F;redis-cli
127.0.0.1:6379&gt; ping   #测试是否连通
PONG
127.0.0.1:6379&gt;

#使用客户端连接
如果没有设置密码，使用客户端程序访问，默认redis是不允许无密码登录，（安全的问题）

#设置redis允许客户端可以无密码登录 临时配置，

127.0.0.1:6379&gt; CONFIG SET protected-mode  no
OK
127.0.0.1:6379&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>小玩一把</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">127.0.0.1:6379&gt; get a
(nil)
127.0.0.1:6379&gt; set a 1
OK
127.0.0.1:6379&gt; get a
&quot;1&quot;
127.0.0.1:6379&gt;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="解析配置文件"><a href="#解析配置文件" class="headerlink" title="解析配置文件"></a>解析配置文件</h1><p>redis.conf</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@data-server redis-7.0.14]# egrep -v &#39;^#|^$&#39; redis.conf
bind 127.0.0.1 -::1    
&gt; bind 指定监听服务器的地址；
&gt; 127.0.0.1 #只允许本地连接 监听127.0.0.1本地回环地址
&gt; 192.168.212.163  #监听服务器的IP地址；所有的client都可以通过服务器IP地址登录|连接redis
&gt; *  #监听所有的IP地址
protected-mode yes    #指定远程连接redis是否使用验证模块
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300
daemonize yes  #启动redis守护进程
pidfile &#x2F;var&#x2F;run&#x2F;redis_6379.pid
loglevel notice    #日志的级别
logfile &quot;&quot;         #日志文件名称
databases 16       #16个库
always-show-logo no
set-proc-title yes
proc-title-template &quot;&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;&quot;
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
rdb-del-sync-files no
dir .&#x2F;
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync yes
repl-diskless-sync-delay 5
repl-diskless-sync-max-replicas 0
repl-diskless-load disabled
repl-disable-tcp-nodelay no
replica-priority 100
acllog-max-len 128
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
lazyfree-lazy-user-del no
lazyfree-lazy-user-flush no
oom-score-adj no
oom-score-adj-values 0 200 800
disable-thp yes
appendonly no
appendfilename &quot;appendonly.aof&quot;
appenddirname &quot;appendonlydir&quot;
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
aof-timestamp-enabled no

slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events &quot;&quot;
hash-max-listpack-entries 512
hash-max-listpack-value 64
list-max-listpack-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-listpack-entries 128
zset-max-listpack-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
jemalloc-bg-thread yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="启动redis-server"><a href="#启动redis-server" class="headerlink" title="启动redis-server"></a>启动redis-server</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@data-server ~]# redis-server  &#x2F;usr&#x2F;local&#x2F;redis-7.0.14&#x2F;redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="redis-基本语法"><a href="#redis-基本语法" class="headerlink" title="redis 基本语法"></a>redis 基本语法</h2><ol>
<li>set  #设置一个key 对应 values</li>
</ol>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">127.0.0.1:6379&gt; SET a 1
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="2">
<li>get #获取key的 values</li>
</ol>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">127.0.0.1:6379&gt; get a
&quot;1&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>NoSQL</category>
      </categories>
      <tags>
        <tag>非关系数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>数据持久化</title>
    <url>/blog/2024/01/10/redis/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    <content><![CDATA[<h1 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>数据持久化，就是将内存中的数据，持久化到本地磁盘中，推荐（SSD 固态硬盘）</p>
<p>数据持久化的方式：</p>
<p><strong>RDB（快照方式）：</strong> RDB方式是一种快照式的持久化方法，将某一时刻的数据持久化到磁盘中。这种方式就是将内存中数据以快照的方式写入到二进制文件中 ，默认的文件名为dump.rdb。</p>
<p><strong>AOF（日志追加）：</strong> AOF方式是将执行过的写指令记录下来，在数据恢复时按照从前到后的顺序再将指令执行一遍。这种方式 redis 会将每一个收到的写命令都通过 write 函数追加到文件中(默认appendonly.aof)。</p>
<p><strong>RDB + AOF：</strong> 您也可以在同一实例中合并AOF和RDB</p>
<h2 id="RDB-优缺点"><a href="#RDB-优缺点" class="headerlink" title="RDB 优缺点"></a>RDB 优缺点</h2><p>优点： 快速和方便<br>缺点： 单服务器出现断电、网络连接不稳定或者服务器出现重启的状态有可能就会丢失数据（数据的不完整性）</p>
<h2 id="AOF-优缺点"><a href="#AOF-优缺点" class="headerlink" title="AOF 优缺点"></a>AOF 优缺点</h2><p>优点： AOF只是追加日志文件，因此对服务器性能影响较小，速度比RDB要快，消耗的内存较少。<br>缺点： AOF方式生成的日志文件太大，即使通过AOF重写，文件体积仍然很大。 恢复数据的速度比RDB慢。</p>
<h2 id="RDB持久化触发机制"><a href="#RDB持久化触发机制" class="headerlink" title="RDB持久化触发机制"></a>RDB持久化触发机制</h2><p>触发RDB持久化过程分为手动触发和自动触发</p>
<h3 id="手动触发"><a href="#手动触发" class="headerlink" title="手动触发"></a>手动触发</h3><p>手动触发持久化的操作有二个:save和bgsave。它们主要区别体现在:是否阻塞 Redis 主线程的执行。</p>
<p>save命令</p>
<p>在客户端中执行 save 命令，就会触发 Redis 的持久化，但同时也是使 Redis 处于阻塞状态，直到 RDB 持久化完<br>成，才会响应其他客户端发来的命令，所以在生产环境一定要慎用</p>


<p>示例：</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">
#检查dump.rdb 的生成时间
[root@data-server ~]# ll
-rw-r--r--  1 root root        99 Dec 21 10:37 dump.rdb

127.0.0.1:6379[1]&gt; save    #登录redis 服务器支持save命令
OK

#再次查看dump.rdb 的生成时间
[root@data-server ~]# ll
-rw-r--r--  1 root root       104 Dec 21 10:38 dump.rdb
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>bgsave命令</p>
<p>bgsave(background save)既后台保存的意思， 它和 save 命令最大的区别就是 bgsave 会 fork() 一个子进程来 执行持久化，整个过程中只有在 fork() 子进程时有短暂的阻塞，当子进程被创建之后，Redis 的主进程就可以响应 其他客户端的请求了，相对于整个流程都阻塞的 save 命令来说，显然 bgsave 命令更适合我们使用</p>


<p>示例：</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">
#执行前
[root@data-server ~]# ll
-rw-r--r--  1 root root       104 Dec 21 10:38 dump.rdb

[root@data-server ~]# redis-cli
127.0.0.1:6379&gt; bgsave

#执行后
[root@data-server ~]# ll
-rw-r--r--  1 root root       104 Dec 21 10:58 dump.rdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="自动触发"><a href="#自动触发" class="headerlink" title="自动触发"></a>自动触发</h3><p>自动触发持久化，本质是 Redis 通过判断，如果满足设置的触发条件，自动执行一次 bgsave 命令。<br>RDB 自动持久化主要来源于以下几种情况:</p>
<p><code>save m n</code></p>
<p>表示的是在 m 秒内，如果有 n 个键发生改变，则自动触发持久化。 如:</p>
<p>配置文件(/usr/local/redis/redis.conf)中的默认配置</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># save 3600 1 300 100 60 10000
# 如果至少进行了 1 次更改，则在 3600 秒（1 小时）后启动持久化
# 如果至少执行了 100 次更改，则在 300 秒（5 分钟）后启动持久化
# 如果至少执行了 10000 次更改，则保存 60 秒后启动持久化<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="RDB持久化配置"><a href="#RDB持久化配置" class="headerlink" title="RDB持久化配置"></a>RDB持久化配置</h3><pre class="line-numbers language-term" data-language="term"><code class="language-term">[root@data-server redis-7.0.14]# cat  redis.conf  | grep save | egrep  &#39;^save&#39;

save  60  5   #定义触发自动RDB持久化的条件 &lt;&#x2F;br&gt;
stop-writes-on-bgsave-error yes   #如果执行bgsave的时候，出现错误是否定义执行备份，yes|no  yes：表示停止备份，no:不停止
#rdb文件是否压缩
rdbcompression yes  
#写入文件和读取文件时是否开启rdb文件检查，检查是否有无损坏，如果在启动是检查发现损坏，则停止启动
rdbchecksum yes
#rdb持久化后存放的文件名
dbfilename dump_test.rdb
rdb-del-sync-files no
#rdb持久化后文件的存放路径
dir &#x2F;data&#x2F;redis_backup&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><pre class="line-numbers language-term" data-language="term"><code class="language-term">[root@data-server redis-7.0.14]# redis-server  redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>触发自动备份的条件</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">[root@data-server ~]# redis-cli
127.0.0.1:6379&gt; SELECT  2
OK
127.0.0.1:6379[2]&gt; set name1 &quot;Xl&quot;
OK
127.0.0.1:6379[2]&gt; SET name2 &quot;xw&quot;
OK
127.0.0.1:6379[2]&gt; SET name3 &quot;xh&quot;
OK
127.0.0.1:6379[2]&gt; SET name4 &quot;xs&quot;
OK
127.0.0.1:6379[2]&gt; SET name5 &quot;xs&quot;
OK
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>检查是否可以实现自动备份</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">[root@data-server redis-7.0.14]# ll &#x2F;data&#x2F;redis-backup&#x2F;
total 4
-rw-r--r-- 1 root root 144 Dec 21 11:47 dump_test.rdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="恢复数据"><a href="#恢复数据" class="headerlink" title="恢复数据"></a>恢复数据</h3><ol>
<li>清除缓存（redis）</li>
</ol>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="AOF-持久化"><a href="#AOF-持久化" class="headerlink" title="AOF  持久化"></a>AOF  持久化</h1><p>AOF方式在使用Redis存储非临时数据时，一般都需要打开AOF持久化来降低进程终止导致的数据丢失，AOF可以将 Redis执行的每一条写命令追加到硬盘文件中，这一过程显然会降低Redis的性能，但是大部分情况下这个影响是可 以接受的，另外，使用较快的硬盘能提高AOF的性能。</p>
<h2 id="AOF-工作方式"><a href="#AOF-工作方式" class="headerlink" title="AOF 工作方式"></a>AOF 工作方式</h2><p>命令写入 (append)、文件同步(sync)、文件重写(rewrite)、重启加载 (load)</p>
<h2 id="AOF特点"><a href="#AOF特点" class="headerlink" title="AOF特点"></a>AOF特点</h2><p>默认文件名是 appendonly.aof。保存的位置由配置中 dir 来配置目录。</p>
<p>AOF 每次都会保存写命令，数据实时性更高。</p>
<p>AOF 需要使用“重写机制”来优化，每次记录写命令，文件会很大的问题。<br>AOF 根据不同的“缓冲区同步策略”将我们缓冲区中写入的命令，同步到磁盘。、</p>
<h2 id="缓冲区同步策略"><a href="#缓冲区同步策略" class="headerlink" title="缓冲区同步策略"></a>缓冲区同步策略</h2><p>设置appendfsync 控制，一共3种:</p>
<p>always:客户端的每一个写操作都保存到aof文件当中，这种策略很安全，但是每个写都会有IO操作，所以也很<br>慢。</p>
<p>everysec:每秒写入一次aof文件，因此，最多可能会丢失1s的数据。 推荐使用这种方式。</p>
<p>no: 交由操作系统来处理什么时候写入aof文件。更快，但也是最不安全的选择，不推荐使用。</p>
<h2 id="开启AOF持久化"><a href="#开启AOF持久化" class="headerlink" title="开启AOF持久化"></a>开启AOF持久化</h2><blockquote>
<p>redis.conf AOF 持久化默认配置文件</p>
</blockquote>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">appendonly no     #默认不开启AOF日志备份， NO不开启 yes 开启AOF日志机制
appendfilename &quot;appendonly.aof&quot;  #AOF持久化文件名
appenddirname &quot;appendonlydir&quot;    #存放持久化文件的所在目录
appendfsync everysec            #缓冲同步策略，默认值
no-appendfsync-on-rewrite no    #是否重写，默认不重写<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>案例：</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">
[root@gitbook-server ~]# redis-cli -h 192.168.212.163
192.168.212.163:6379&gt; SELECT 1
OK
192.168.212.163:6379[1]&gt; set name   xiaosan
OK
192.168.212.163:6379[1]&gt; set name   xiaosi


[root@data-server appendonlydir]# cat appendonly_test.aof.1.incr.aof
*2
$6
SELECT
$1
1
*3
$3
set
$4
name
$7
xiaosan
*3
$3
set
$4
name
$6
xiaosi
*3
$3
SET
$5
name2
$7
xiaobai
*3
$3
set
$5
name3
$6
xiaosi
*3
$3
set
$5
name4
$6
xiaowu
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="恢复过程"><a href="#恢复过程" class="headerlink" title="恢复过程"></a>恢复过程</h2>

<h2 id="AOF-重写"><a href="#AOF-重写" class="headerlink" title="AOF 重写"></a>AOF 重写</h2><p>7.1、为什么要重写 随着aof文件越来越大，需要定期对aof文件进行重写，达到压缩的目的。</p>
<p>7.2、重写aof改变</p>
<p>进程内已经超时的数据不再写入文件。<br>旧的aof有无效命令(如:set k1 hello ex 10000)，新的aof文件只保留最终数据的写入命令。</p>
<p>多条写命令可以合并为一个(如:lpush list a、lpush list b、lpush list c可以转化为:lpush list a b c)。但也不 能将整个lpush生成的元素全部写在一起，所以对于list、set、hash、zset等类型操作，以64个元素为界拆分为多 条。来防止客户端缓冲区溢出。</p>
<p>AOF重写降低了文件占用空间，更小的aof 文件启动redis时，加载更快。</p>
<p>7.3、重写方式 AOF重写过程可以手动触发和自动触发:</p>
<p>手动触发:直接调用bgrewriteaof命令。</p>
<p>自动触发:根据auto-aof-rewrite-min-size和auto-aof-rewrite-percentage参数确定自动触发时机</p>
<p>7.3.1 配置文件 修改配置文件/usr/local/redis/redis.conf</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">auto-aof-rewrite-percentage100#AOF文件增⻓率(当前AOF文件大小超过上一次重写的AOF文件大小的 百分之多少才会重写)
auto-aof-rewrite-min-size64mb#表示运行AOF重写时文件最小体积，默认为64MB。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注意:</p>
<p>aof_current_size: aof当前尺寸(单位:字节)</p>
<p>aof_base_size: aof上次启动和重写的尺寸(单位:字节)</p>
<p>7.5.2、自动触发时机</p>
<p>当前 AOF 文件大小超过最小重写尺寸</p>
<p>当前 AOF 文件大小超过上次重写完的 AOF 尺寸的百分之多少(auto-aof-rewrite-percentage)</p>
<p>换算:</p>
<p>自动触发时机=aof_current_size&gt;auto-aof-rewrite-min-size&amp;&amp;(aof_current_size- aof_base_size)/aof_base_size&gt;=auto-aof-rewrite-percentage</p>
<p>查看aof_current_size和aof_base_size的值<br>Redis</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">192.168.212.163:6379[1]&gt; info persistence
# Persistence
loading:0
async_loading:0
current_cow_peak:0
current_cow_size:0
current_cow_size_age:0
current_fork_perc:0.00
current_save_keys_processed:0
current_save_keys_total:0
rdb_changes_since_last_save:0
rdb_bgsave_in_progress:0
rdb_last_save_time:1703213843
rdb_last_bgsave_status:ok
rdb_last_bgsave_time_sec:0
rdb_current_bgsave_time_sec:-1
rdb_saves:4
rdb_last_cow_size:286720
rdb_last_load_keys_expired:0
rdb_last_load_keys_loaded:0
aof_enabled:1
aof_rewrite_in_progress:0
aof_rewrite_scheduled:0
aof_last_rewrite_time_sec:0
aof_current_rewrite_time_sec:-1
aof_last_bgrewrite_status:ok
aof_rewrites:1
aof_rewrites_consecutive_failures:0
aof_last_write_status:ok
aof_last_cow_size:339968
module_fork_in_progress:0
module_fork_last_cow_size:0
aof_current_size:385
aof_base_size:192
aof_pending_rewrite:0
aof_buffer_length:0
aof_pending_bio_fsync:0
aof_delayed_fsync:0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1 auto-aof-rewrite-percentage100#AOF文件增⻓率(当前AOF文件大小超过上一次重写的AOF文件大小的 百分之多少才会重写)<br>2 auto-aof-rewrite-min-size64mb#表示运行AOF重写时文件最小体积，默认为64MB。</p>
<p>295&gt;64M &amp;&amp;(295-211)/211&gt;=100</p>
<p>只有当这二个条件同时成立，我们才会去触发我们的重写AOF 7.6、aof文件恢复</p>
<h1 id="AOF-恢复"><a href="#AOF-恢复" class="headerlink" title="AOF 恢复"></a>AOF 恢复</h1><p>在写入aof日志文件时，如果Redis服务器宕机，则aof日志文件文件会出格式错误，在重启Redis服务器时，Redis 服务器会拒绝载入这个aof文件，可以通过以下步骤修复aof并恢复数据。<br>备份现在aof文件，以防万一。</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">* Reading RDB preamble from AOF file...
* Reading the remaining AOF tail...
# !!! Warning: short read while loading the AOF file !!!
# !!! Truncating the AOF at offset 439 !!!
# AOF loaded anyway because aof-load-truncated is enabled<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以通过redis自带工具redis-check-aof工具修复原始文件</p>
<pre class="line-numbers language-term" data-language="term"><code class="language-term">redis-check-aof --fix &#123;filename&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="开启redis密码验证"><a href="#开启redis密码验证" class="headerlink" title="开启redis密码验证"></a>开启redis密码验证</h1><pre class="line-numbers language-term" data-language="term"><code class="language-term">
protected-mode  yes
requirepass 123456   #设置密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="客户端登录"><a href="#客户端登录" class="headerlink" title="客户端登录"></a>客户端登录</h2><pre class="line-numbers language-none"><code class="language-none">[root@gitbook-server ~]# redis-cli -h 192.168.212.163 -a 123456
Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.

192.168.212.163:6379&gt; KEYS *   #获取所在库里的所有的key
(empty array)
192.168.212.163:6379&gt; SELECT 1
OK
192.168.212.163:6379[1]&gt; KEYS *
 1) &quot;name4&quot;
 2) &quot;a8&quot;
 3) &quot;a3&quot;
 4) &quot;a4&quot;
 5) &quot;a9&quot;
 6) &quot;name&quot;
 7) &quot;a5&quot;
 8) &quot;name2&quot;
 9) &quot;a11&quot;
10) &quot;a7&quot;
11) &quot;a10&quot;
12) &quot;a2&quot;
13) &quot;a1&quot;
14) &quot;a6&quot;
15) &quot;name3&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>NoSQL</category>
      </categories>
      <tags>
        <tag>非关系数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>磁盘管理</title>
    <url>/blog/2022/04/01/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="Linux磁盘基本管理"><a href="#Linux磁盘基本管理" class="headerlink" title="Linux磁盘基本管理"></a>Linux磁盘基本管理</h1><p>在Linux系统中，如何有效地对磁盘存储空间加以使用和管理，是一项非常重要的技术，本章节从四个方面介绍磁盘的使用和管理技巧，首先讲述关于磁盘管理的基本概念以及如何合理划分磁盘分区</p>
<h2 id="磁盘的介绍"><a href="#磁盘的介绍" class="headerlink" title="磁盘的介绍"></a><strong>磁盘的介绍</strong></h2><h3 id="磁盘的管理基本概念"><a href="#磁盘的管理基本概念" class="headerlink" title="磁盘的管理基本概念"></a><strong>磁盘的管理基本概念</strong></h3><p>Linux系统中所有的硬件设备都是通过文件的方式来表现和使用的，我们将这些文件称为设备文件。在Linux下的/dev 目录中有大量的设备文件，根据设备文件的不同，又分为字符设备文件和块设备文件。</p>
<p>字符设备文件的存取是以字符流的方式进行的，一次传送一个字符。常见的有打印机、终端（TTY）、绘图仪和磁带设备等，字符设备文件有时也称为”raw“设备文件。</p>
<p>块设备文件是以数据块方式存取的，最常见的设备就是磁盘。</p>
<h3 id="1、-磁盘设备在Linux下写表示方法"><a href="#1、-磁盘设备在Linux下写表示方法" class="headerlink" title="1、 磁盘设备在Linux下写表示方法"></a>1、 磁盘设备在Linux下写表示方法</h3><p>现在常见的磁盘类型有IDE并口硬盘、SATA 串口硬盘以及SCSI硬盘。不同类型的硬盘在linux下对应的设备文件名称不尽相同。Linux下磁盘设备常见的表示方案如下两种。</p>
<p><strong>方案1：</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">主设备好+次设备+磁盘分区编号
对于IDE硬盘：表示为hd[a~z]x
对于SCSI硬盘：表示为sd[a~z]x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>方案2：</strong></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">主设备号+[0~n],y
对于IDE硬盘：表示为hd[0~n],y
对于SCSI硬盘：表示为sd[0~n],y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>主设备号代表设备的类型，可以唯一地确定设备的驱动程序和界面。主设备号相同的设备是同类型设备，即，使用同一个驱动程序，比如：hd表示IDE硬盘，sd表示SCSI硬盘，TTY表示终端设备等。</p>
<p>次设备号代表同类设备中的序列号，”a~z“就表示设备的序列号。如：/dev/sda 表示第一块SCSI硬盘。/dev/sdb 则表示第二块SCSI硬盘。</p>
<h3 id="2、-磁盘分区的划分标准"><a href="#2、-磁盘分区的划分标准" class="headerlink" title="2、 磁盘分区的划分标准"></a>2、 磁盘分区的划分标准</h3><p>磁盘的分区对于linux系统的稳定和安全非常重要，合理地划分磁盘分区有助于系统的稳定运行和保障数据的安全。</p>
<p>磁盘的分区由主分区、扩展分区和逻辑分区组成。在一块硬盘上，主分区的最大个数是4个，其中扩展分区也算一个主分区，在扩展分区下可以建立很多个逻辑分区，所以主分区（包括扩展分区）范围是1~4，逻辑分区从5开始。对于逻辑分区，linux规定必须建立在扩展分区上，而不是建立在主分区上。</p>
<p>主分区的作用是用来启动操作系统的，它主要存放操作系统的启动或引导程序，因此建议操作系统的引导程序都放在主分区上，比如Linux的/boot分区，最好放在主分区上。</p>
<p>通过fdsik -l 命令可以显示当前系统分区的所有信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# fdisk  -l

Disk &#x2F;dev&#x2F;sda: 107.4 GB, 107374182400 bytes, 209715200 sectors
Units &#x3D; sectors of 1 * 512 &#x3D; 512 bytes
Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes
I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes
Disk label type: dos
Disk identifier: 0x000d3ee0

   Device Boot      Start         End      Blocks   Id  System
&#x2F;dev&#x2F;sda1   *        2048    41945087    20971520   83  Linux
&#x2F;dev&#x2F;sda2        41945088   209715199    83885056   8e  Linux LVM


# 详情：
Device  #显示磁盘分区对应的设备文件名
Boot    #显示那个分区是引导分区
Start   #表示每个磁盘分区的起始位置，以柱面为计算单位
End     #表示每个磁盘分区的终止位置，以柱面为计算单位
Blocks  #显示磁盘分区的容量，以KB为单位
 Id     #显示磁盘分区对应的ID。根据不同的分区，则对应的ID也不同
system  #与ID基本相同，都表示不同分区类型<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>磁盘管理</tag>
      </tags>
  </entry>
  <entry>
    <title>逻辑卷管理</title>
    <url>/blog/2022/04/03/%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="逻辑卷管理"><a href="#逻辑卷管理" class="headerlink" title="逻辑卷管理"></a><strong>逻辑卷管理</strong></h1><h2 id="LVM"><a href="#LVM" class="headerlink" title="LVM"></a>LVM</h2><h2 id="一、-LVM-的基本概念"><a href="#一、-LVM-的基本概念" class="headerlink" title="一、 LVM 的基本概念"></a>一、 LVM 的基本概念</h2><p>在对磁盘进行分区大小规划时，有时往往不能确定这个分区要使用的总空间大小，而用fdisk对磁盘分区后，每个分区的大小已经固定了，如果分区设置得过大，就白白浪费了磁盘空间，而分区设置得过小，就会导致空间不够用的情形。此时最常见的方法是重新规划磁盘分区，或者通过软链接的方式将此分区的目录链接到另一个分区，虽然这能临时解决问题，但是给管理带来了麻烦。如何解决这写问题呢？LVM是一个错的方法。</p>
<p>LVM（Logical Volume Manager,逻辑卷管理器）是Linux下对磁盘分区进行管理的一种机制。LVM建立在磁盘分区和文件系统之间的一个逻辑层，管理员利用LVM可以在磁盘不用重新分区的情况下动态调整分区的大小。如果系统新增一块硬盘。通过LVM就可以将新增的硬盘空间直接扩展到原来的磁盘分区上。</p>
<h2 id="二、LVM中的术语"><a href="#二、LVM中的术语" class="headerlink" title="二、LVM中的术语"></a>二、LVM中的术语</h2><p>通过LVM，屏蔽了磁盘分区的底层差异，在逻辑上给文件系统提供了一个卷的概念，然后再这些卷上建立相应的文件系统。在认识LVM之前，先熟悉LVM中几个常用的术语，即在LVM中涉及的几个概念。</p>
<ul>
<li>物理存储设备（physical media）: 指系统的存储设备文件，如/dev/sda、/dev/hdb等；</li>
<li>物理卷（Physical Volume, PV ）：指硬盘分区或者从逻辑上看和硬盘分区类似的设备（如：RAID设备）</li>
<li>卷组（Volume Group， VG）：类似于非LVM 系统中的物理硬盘，一个LVM卷组由一个或多个物理卷组成。</li>
<li>逻辑卷（Logical Volume，LV1）：类似于LVM系统中的硬盘分区，LV建立在VG上，可以在LV上创建文件系统。</li>
<li>PE （Physical Extent ,PE )：PV中可以分配的最小存储单元称为PE。PE的大小是可以指定的，默认为4MB。</li>
<li>LE （Logical Extent， LE）：LV 中可以分配的最小单元称为LE。在同一卷组中，LE的大小和PE是一样的，且一一对应。</li>
</ul>
<p>下面是LVM各个组成部分之间的对应关系</p>
<p><img src="/source/_posts/%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/images/LVM.jpg" class="lazyload placeholder" data-srcset="/source/_posts/%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86/images/LVM.jpg" srcset="https://img2.baidu.com/it/u=2037979560,2772131037&fm=26&fmt=auto&gp=0.jpg" alt="LVM"></p>
<h2 id="三、LVM的创建与管理"><a href="#三、LVM的创建与管理" class="headerlink" title="三、LVM的创建与管理"></a>三、LVM的创建与管理</h2><p>1、创建物理分区</p>
<p>在使用LVM之前，需要首先划分磁盘分区，也就是用fdisk命令划分磁盘分区，划分的方法在之前已经讲解过，稍微不同的是，在创建分区的时候，需要指定分区类型为 Linux LVM，对应的ID为8e（其实LVM也能识别Linux默认的分区类型83）。分区如下。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、创建物理卷</p>
<p>创建物理卷（PV）的命令是pvcreate</p>
<p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pvcreate 磁盘分区或整个磁盘<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>示例：将划分的所有磁盘分区创建为物理卷</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pvcreate &#x2F;dev&#x2F;sdb1 &#x2F;dev&#x2F;sdb2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、创建卷组</p>
<p>创建卷组（VG）的命令是vgcreate</p>
<p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgcreate myvgl &#x2F;dev&#x2F;sdb1 &#x2F;dev&#x2F;sdb2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4、激活卷组</p>
<p>卷组（VG）创建完毕后，可以通过vgchange命令激活卷组，而无线重启系统。</p>
<ul>
<li><p>命令：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgchange<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgchange -a y 卷组名   #激活卷组
vgchange -a n 卷组名   #停用卷组<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>激活卷组myvg1</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgchang -a y myvg1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>5、显示卷组、物理卷属性信息</p>
<p>vgdisplay 用户显示创建的卷组信息，同理pvdisplay 命令用户显示物理卷组信息。</p>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgdisplay 卷组名
pvdisplay 物理卷名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>示例：查看创建的卷组</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgdisplay myvg1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>6、创建逻辑卷</p>
<p>创建逻辑卷（LV）命令是lvcreate</p>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lvcreate [-L 逻辑卷大小 | -l PE数] -n 逻辑卷名称   所属的卷组名

-L 后面接逻辑卷的大小，可以用K、M、G表示。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>示例：在myvg1下创建两个逻辑卷mylv1 和mylv2</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lvcreate -L 4G -n mylv1 myvgl
#检查卷组myvg1 中可用的卷组空间
vgdisplay myvg1 | grep &quot;Free PE&quot;   
#再次分<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>7、格式化逻辑卷，创建文件系统</p>
<p>文件系统是创建在逻辑卷上的。这里假定使用linux默认的xfs文件系统。</p>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mkfs.xfs &#x2F;dev&#x2F;myvg1&#x2F;mylv1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>8、添加新的物理卷到卷组</p>
<p>添加新的物理卷到卷组的命令为vgextend.</p>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">vgextend 卷组名 新加入的物理卷<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pvcreate &#x2F;dev&#x2F;sd3    #先将分区转换为物理卷
vgextend   myvg1 &#x2F;dev&#x2F;sdb3           #将新增物理卷添加到卷组中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li></li>
</ul>
<p>9、修改逻辑卷的大小</p>
<p>LVM 最主要的功能就是能动态调整分区的大小，其实也就是修改逻辑卷的大小。</p>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lvextend     #扩展逻辑卷
lvreduce     #缩减逻辑卷
ext2resize   #修改文件系统大小

#语法
lvextend [-L (+size) -l [+PE数]] 逻辑卷名称
lvreduce [-L (-size) -l [-PE数]] 逻辑卷名称<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>修改逻辑卷分为扩充逻辑卷大小和减少逻辑卷大小两种情况。</p>
</blockquote>
</li>
<li><p>选项：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">-l:与-L 用法相同，不同的是 -l 选项用PE数来表示逻辑卷的大小<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>示例1：以文件系统是ext2/ext3/ext4，可以通过resize2fs来扩充文件系统</p>
<ol>
<li><p>扩充逻辑卷 </p>
<ul>
<li><p>命令：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">利用扩展逻辑卷命令lvextend扩展逻辑空间
利用resize2fs命令扩展文件系统<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lvextend  -L +2G &#x2F;dev&#x2F;myvg1&#x2F;myvg
resiza2fs &#x2F;dev&#x2F;myvg1&#x2F;myvg  #更新逻辑卷大小<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>验证:</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">df -h<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
<li><p>减少逻辑卷</p>
<blockquote>
<ol>
<li>卸载已经挂载的逻辑卷分区</li>
<li>利用resize2fs指令修改文件系统大小以实现空间缩减。</li>
<li>利用减少逻辑卷命令lvreduce减少逻辑卷空间。</li>
<li>挂载缩减后的逻辑分区。</li>
</ol>
</blockquote>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">resize2fs &#x2F;dev&#x2F;myvg1&#x2F;myvg 5G    #缩减逻辑卷大小
e2fsck -f &#x2F;dev&#x2F;myvg1&#x2F;myvg       #检查逻辑卷
resize2fs &#x2F;dev&#x2F;myvg1&#x2F;myvg 5G    #再次执行缩减命令
lvreduce -L -2G  &#x2F;dev&#x2F;myvg1&#x2F;myvg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
</li>
<li><p>示例2：以xfs 文件系统为例</p>
<ol>
<li><p>扩充逻辑卷空间</p>
<blockquote>
<p>利用扩展逻辑卷命令lvextend扩展逻辑卷空间</p>
<p>利用xfs_growfs指令修改xfs文件系统大小以实现空间扩充</p>
</blockquote>
<ul>
<li><p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">lvextend -l +1023 &#x2F;dev&#x2F;myvg1&#x2F;myvg     # -l:选项是扩充PE数， 或者使用 -L 选项 +4G
xfs_growfs &#x2F;myvg      #执行xfs_growfs命令，是扩充的大小生效<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
</li>
</ul>
<p>10、如何删除物理卷、卷组和逻辑卷</p>
<ul>
<li><p>删除物理卷</p>
<p>命令：pvremove</p>
</li>
<li><p>将物理卷从卷组移出</p>
<p>命令：vgreduce</p>
</li>
<li><p>删除卷组</p>
<p>命令：vgremove</p>
</li>
<li><p>删除逻辑卷</p>
<p>命令： lvremove </p>
</li>
</ul>
<p>删除的步骤：</p>
<blockquote>
<p>卸载逻辑卷分区—&gt; 删除卷组上所有的逻辑卷—&gt;删除卷组</p>
</blockquote>
<p>命令语法：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">umount     #卸载逻辑卷对应的分区
lvremove   &#x2F;dev&#x2F;myvg1&#x2F;myvg   #删除逻辑卷
vgreduce   myvg1 &#x2F;dev&#x2F;sdb1   #从卷组中移出一个物理卷
pvgremove  &#x2F;dev&#x2F;sdb1         #删除物理卷
vgremove   myvg1 #删除卷组<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h1 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h1><p>创建LVM  （新添加两块磁盘）</p>
<p>1、 分区修改为linux lvm </p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# fdisk &#x2F;dev&#x2F;sdc 
欢迎使用 fdisk (util-linux 2.23.2)。
&#96;&#96;&#96;略过。。。。
#修改为LVM
命令(输入 m 获取帮助)：t 
分区号 (1-3，默认 3)：
Hex 代码(输入 L 列出所有代码)：8e
已将分区“Linux”的类型更改为“Linux LVM”
#查看磁盘分区详细信息
命令(输入 m 获取帮助)：p

磁盘 &#x2F;dev&#x2F;sdc：21.5 GB, 21474836480 字节，41943040 个扇区
Units &#x3D; 扇区 of 1 * 512 &#x3D; 512 bytes
扇区大小(逻辑&#x2F;物理)：512 字节 &#x2F; 512 字节
I&#x2F;O 大小(最小&#x2F;最佳)：512 字节 &#x2F; 512 字节
磁盘标签类型：dos
磁盘标识符：0xdbe8ffae

   设备 Boot      Start         End      Blocks   Id  System
&#x2F;dev&#x2F;sdc1            2048    10487807     5242880   8e  Linux LVM
&#x2F;dev&#x2F;sdc2        10487808    20973567     5242880   8e  Linux LVM
&#x2F;dev&#x2F;sdc3        20973568    31459327     5242880   8e  Linux LVM

命令(输入 m 获取帮助)：w
The partition table has been altered!

Calling ioctl() to re-read partition table.
正在同步磁盘。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2、创建物理卷</p>
<ul>
<li>命令：pvcreate</li>
<li>语法:  pvcreate  物理分区或者整个磁盘</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# pvcreate &#x2F;dev&#x2F;sdb1 &#x2F;dev&#x2F;sdb2 &#x2F;dev&#x2F;sdb3 &#x2F;dev&#x2F;sdc1 &#x2F;dev&#x2F;sdc2 &#x2F;dev&#x2F;sdc3
  Physical volume &quot;&#x2F;dev&#x2F;sdb1&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdb2&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdb3&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdc1&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdc2&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdc3&quot; successfully created.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3、创建卷组</p>
<ul>
<li><p>命令：vgcreate </p>
</li>
<li><p>语法： <strong>vgcreate</strong> <strong>myvg</strong> <strong>/dev/sdk1</strong> <strong>/dev/sdl1</strong></p>
</li>
<li><p>示例：创建两个VG 组名myvg1| myvg2</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# vgcreate myvg1 &#x2F;dev&#x2F;sdb1 &#x2F;dev&#x2F;sdb2 &#x2F;dev&#x2F;sdc1
  Volume group &quot;myvg1&quot; successfully created
[root@localhost ~]# vgcreate myvg2 &#x2F;dev&#x2F;sdb3 &#x2F;dev&#x2F;sdc2 &#x2F;dev&#x2F;sdc3
  Volume group &quot;myvg2&quot; successfully created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>4、激活卷组</p>
<ul>
<li><p>命令：vgchange </p>
</li>
<li><p>语法：<strong>vgchange -a y</strong></p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# vgchange -a y myvg1
  0 logical volume(s) in volume group &quot;myvg1&quot; now active
[root@localhost ~]# vgchange -a y myvg2
  0 logical volume(s) in volume group &quot;myvg2&quot; now active
[root@localhost ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>5、查看卷组及物理卷信息</p>
<ul>
<li><p>命令：  vgdisplay  #查看卷组的信息   pvdisplay #显示物理卷的信息</p>
</li>
<li><p>语法：  vgdisplay   卷组的名称         pvdisplay   物理卷的名称</p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# vgdisplay myvg1
[root@localhost ~]# vgdisplay myvg2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>查看物理卷信息</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# pvdisplay &#x2F;dev&#x2F;sdb1  &#x2F;dev&#x2F;sdb2 &#x2F;dev&#x2F;sdb3
  --- Physical volume ---
  PV Name               &#x2F;dev&#x2F;sdb3   
  VG Name               myvg2
  PV Size               5.00 GiB &#x2F; not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               1279
  Allocated PE          0
  PV UUID               aCuebD-0oDi-zxrA-2qvg-dCTX-NHWX-SiiEY4
   
  --- Physical volume ---
  PV Name               &#x2F;dev&#x2F;sdb1
  VG Name               myvg1
  PV Size               5.00 GiB &#x2F; not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               1279
  Allocated PE          0
  PV UUID               lvPyQG-SVeg-AhXx-El9W-txHQ-2DbT-7v9gBm
   
  --- Physical volume ---
  PV Name               &#x2F;dev&#x2F;sdb2
  VG Name               myvg1
  PV Size               5.00 GiB &#x2F; not usable 4.00 MiB
  Allocatable           yes 
  PE Size               4.00 MiB
  Total PE              1279
  Free PE               1279
  Allocated PE          0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>6、创建逻辑卷</p>
<ul>
<li><p>命令    lvcreate </p>
</li>
<li><p>语法：lvcreate [-L 逻辑卷大小 | -l PE数] -n  逻辑卷名称  所属的卷组名 </p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# lvcreate -L 4G -n myvg myvg1
  Logical volume &quot;myvg&quot; created.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>7、初始化文件系统</p>
<ul>
<li><p>命令：mkfs.ext4  xfs </p>
</li>
<li><p>语法：mkfs.ext4   逻辑卷名称</p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mkfs.ext4 &#x2F;dev&#x2F;myvg1&#x2F;myvg <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<p>8、挂载并使用</p>
<ul>
<li><p>命令：mount </p>
</li>
<li><p>语法： mount      设备文件</p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# mkdir &#x2F;testlvm
[root@localhost ~]# mount &#x2F;dev&#x2F;myvg1&#x2F;myvg &#x2F;testlvm&#x2F;
[root@localhost ~]# df -h
文件系统                 容量  已用  可用 已用% 挂载点
&#x2F;dev&#x2F;mapper&#x2F;myvg1-myvg   3.9G   16M  3.6G    1% &#x2F;testlvm
#验证
[root@localhost ~]# cd &#x2F;testlvm&#x2F;
[root@localhost testlvm]# ls
lost+found
[root@localhost testlvm]# touch  gblw
[root@localhost testlvm]# ls
gblw  lost+found
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>9、填加新物理卷到卷组</p>
<ul>
<li><p>命令： vgextend</p>
</li>
<li><p>语法： vgextend   卷组名     物理卷</p>
</li>
<li><p>步骤：</p>
<blockquote>
<p>1、分区 fdisk </p>
<p>2、创建物理卷</p>
<p>3、把物理卷加入卷组</p>
</blockquote>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# pvcreate &#x2F;dev&#x2F;sdd1 &#x2F;dev&#x2F;sdd2   
  Physical volume &quot;&#x2F;dev&#x2F;sdd1&quot; successfully created.
  Physical volume &quot;&#x2F;dev&#x2F;sdd2&quot; successfully created.
[root@localhost ~]# vgdisplay myvg1  | grep &quot;VG Size&quot;
  VG Size               14.98 GiB
[root@localhost ~]# vgextend myvg1 &#x2F;dev&#x2F;sdd1 
  Volume group &quot;myvg1&quot; successfully extended
[root@localhost ~]# vgdisplay myvg1  | grep &quot;VG Size&quot;
  VG Size               16.98 GiB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>10、对逻辑卷的扩容</p>
<ul>
<li><p>命令： lvextend</p>
</li>
<li><p>语法：lvextend [-L +size   | -l PE数]   逻辑卷名称</p>
</li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@localhost ~]# lvdisplay myvg1
[root@localhost ~]# lvextend -L +2G &#x2F;dev&#x2F;myvg1&#x2F;myvg 
#e2fsck  检查逻辑卷
[root@localhost ~]# e2fsck -f &#x2F;dev&#x2F;myvg1&#x2F;myvg 
#刷新逻辑卷
[root@localhost ~]# resize2fs &#x2F;dev&#x2F;myvg1&#x2F;myvg <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>11、 删除lvm</p>
<ul>
<li><p>步骤：</p>
<blockquote>
<p>![image-20220330105821101](/Users/abbott/Library/Application Support/typora-user-images/image-20220330105821101.png)</p>
</blockquote>
</li>
<li><p>命令语法：</p>
<pre class="line-numbers language-shll" data-language="shll"><code class="language-shll">umount 
lvremove
vgreduce 
pvremove 
vgremove <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>示例：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#卸载已经挂载逻辑卷 LV
[root@localhost ~]# umount &#x2F;dev&#x2F;myvg1&#x2F;myvg
#删除逻辑卷
[root@localhost ~]# lvremove &#x2F;dev&#x2F;myvg1&#x2F;myvg 
Do you really want to remove active logical volume myvg1&#x2F;myvg? [y&#x2F;n]: y
  Logical volume &quot;myvg&quot; successfully removed
#把卷组里面的物理卷移除
[root@localhost ~]# vgreduce -a myvg1
  Removed &quot;&#x2F;dev&#x2F;sdb1&quot; from volume group &quot;myvg1&quot;
  Removed &quot;&#x2F;dev&#x2F;sdb2&quot; from volume group &quot;myvg1&quot;
  Removed &quot;&#x2F;dev&#x2F;sdc1&quot; from volume group &quot;myvg1&quot;
  Can&#39;t remove final physical volume &quot;&#x2F;dev&#x2F;sdd1&quot; from volume group &quot;myvg1&quot;
  
#删除卷组  
[root@localhost ~]# vgremove myvg1
  Volume group &quot;myvg1&quot; successfully removed
  
#查看所有卷组 
vgdisplay 
#查看所有逻辑卷
lvdisplay <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
]]></content>
      <categories>
        <category>Linux系列</category>
      </categories>
      <tags>
        <tag>磁盘管理</tag>
      </tags>
  </entry>
</search>
